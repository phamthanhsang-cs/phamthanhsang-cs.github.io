---
title: Boss of the SOC version 3 Write-ups
date: 2025-6-7 00:00:00 + 0700
categories: [siem, blue-teaming, soc, ctf-challenge]
tags: [splunk, threat-hunting, log-analysis, write-ups]    
author: <author_id>   
description: Frothly Beer is moving their infrastructure to the cloud using a multi-cloud strategy. Let's help them detect suspicious activities while their business evolves significantly. 
# toc: false - uncomment to turn off Table of Contents which is use for display content in right-panel 
#comments: false # uncomment to turn on comment 
image: /assets/images/preview/botsv3.png
---
# Introduction

Hi Splunkers! Welcome back to my **Boss of the SOC (BOTS)** series on my blog.

If you haven’t read my previous [BOTSv1 Write-ups](https://phamthanhsang-cs.site/posts/BOTSV1/) and [BOTSv2 Write-ups](https://phamthanhsang-cs.site/posts/BOTSV2/) yet, I highly recommend checking them out first. They’ll give you a solid understanding of [Boss of the SOC – the Blue Team CTF Challenge created by Splunk](https://www.splunk.com/en_us/blog/security/what-you-need-to-know-about-boss-of-the-soc.html). I’d really appreciate it!


### About Boss of the SOC Version 3

**Boss of the SOC Version 3** is the latest publicly available BOTS CTF Challenge created by Splunk. In this version, we step into the shoes of **Alice Bluebird** - a quirky cybersecurity analyst to help organizations uncover the root causes of their digital chaos.

In the previous version (BOTSv2), we helped **Frothly**, a fictional craft beer company, detect hidden threats in their environment. From insiders using Tor to hide their activities, to external APTs attempting to exfiltrate intellectual property - it was intense.

Now, in BOTSv3, Frothly has grown rapidly and their traditional infrastructure can no longer keep up. As part of their technological evolution, they’ve migrated their environment to the cloud — utilizing both **AWS** and **Azure** for different business needs.

But as we know, for hackers, there’s nowhere to hide. As security analysts, it’s our job to help Frothly identify suspicious activity and trace the **root cause of digital chaos** in their expanded cloud infrastructure.

> **Fun Fact about my Boss of the SOC series:**  
> BOTSv3 was actually the **first version I completed**, even before versions 1 and 2!  
> It all started back in **April 2024**, with a Splunk instance running on a Linux VM inside my VirtualBox.  
> Revisiting this version now not only helps **refresh the knowledge** I’ve gained, but also sharpens the **analytical skills** I’ve developed since then.
{: .prompt-info }

# Environment Setup

- **Pre-requisites:**  
  Participating in **Boss of the SOC (BOTS)** is easier than ever thanks to its availability on various platforms:
  - [TryHackMe](https://tryhackme.com/)
  - [CyberDefenders](https://cyberdefenders.org/)

  Unfortunately, **Boss of the SOC v3** doesn’t appear on Splunk’s official website, but they have made the dataset [public on GitHub](https://github.com/splunk/botsv3) for anyone who wants to download it and give it a try.

  > *However, all walkthroughs in this guide are based on a **self-hosted setup**, including an approximation of what the CTF scoreboard looks like.*
  > *If you'd like to follow along or set up your own environment, check out this [detailed setup guide](https://phamthanhsang-cs.github.io/posts/BOTS-setup/) where we walk through everything step-by-step. Thanks!*

- **Dataset Information:**  
  Unlike BOTSv1 and BOTSv2, the third version only includes a **pre-indexed dataset** (~320MB), with a total of around **2 million events**.

  ![pic1](assets/images/botsv3/pic1.png)

# Walkthrough 
### Let's Splunking !
Same as both previous versions. before deep diving into answer BOTS questions, i would like to prepare some SPL searches to help us easier to hunting threats: 
- First is `|metadata index="botsv1" type=sourcetypes | stats values(sourcetype)`, the following SPL command helps me quickly identify the sourcetypes present in the dataset. This gives me a clear idea of the types of data we should focus on during investigation:
- The second one is `|metasearch index="botsv1" sourcetype=<specific_sourcetype> <keyword>`.
- The third one is `|fieldsummary` with [marcro](https://docs.splunk.com/Splexicon:Searchmacro) setup. My search will look like this:

```sql
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
```
*And i'd set this search with marcro named `spog` (single pane of glass), you will see why those searches helped me so much in this walkthrough.*

![pic2](assets/images/botsv3/pic2.png)
_WELCOME BACK TO MY BOSS OF THE SOC SERIES_

### Series 200

#### Question 1 (200): List out the IAM users that accessed an AWS service (successfully or unsuccessfully) in Frothly's AWS environment? Answer guidance: Comma separated without spaces, in alphabetical order. (Example: ajackson,mjones,tmiller)

> And like with the previous versions, I always recommend spending a little time to get a bird's-eye view of the `index` and its associated `sourcetypes` before jumping into the logs.  
> This will give you a better understanding of the data and where to begin your hunt.
>
> ```sql
> | metadata index=botsv3 type=sourcetypes 
> | stats values(sourcetype)
> ```
{: .prompt-info }


Before diving into the logs, it's important to understand a few foundational concepts and services in the world-leading cloud computing platform — **Amazon Web Services (AWS)**.

> I’m a big fan of F1 racing, and it’s fascinating that AWS is a key partner of the competition.  
> They provide a service called **F1® Insights**, transforming a traditional sport into a data-driven one. 

When discussing cloud computing, people often think of most common services like:

- **Compute** (e.g., EC2 for AWS, Azure Virtual Machines, OCI VMs for Oracle)
- **Storage** (e.g., AWS S3, Azure Blob Storage, Google Cloud Storage)
- **Serverless** (e.g., AWS Lambda, Azure Functions)

For this question, we're focusing on **Identity and Access Management (IAM)** - like **AWS IAM** or **Microsoft Entra ID** - to track which users accessed services.


**High-Level Overview of Relevant AWS Services:**

**Logging & Activity Tracking**
- **`aws:cloudtrail`**: Records API activity and management events.  
   *Primary service for auditing user activity (e.g., starting EC2 instances, creating S3 buckets).*

**Monitoring & Alerts**
- **`aws:cloudwatch`**: Monitors resources/applications, collects metrics, sets alarms, and builds dashboards.
- **`aws:cloudwatchlogs`**: Core log storage backend for services like EC2, Lambda, Route53.
- **`aws:cloudwatchlogs:vpcflow`**: Captures IP traffic to/from network interfaces in your **VPC** (Virtual Private Cloud).
- **`aws:cloudwatch:guardduty`**: Threat detection using ML to identify and alert on suspicious activity.

**Configuration & Compliance**
- **`aws:config:rule`**: Continuously checks resources against compliance rules (e.g., tagging, encryption, instance types).

**Storage & Access**
- **`aws:s3:accesslogs`**: Provides detailed records of requests to S3 buckets.

**Load Balancing**
- **`aws:elb:accesslogs`**: Tracks all traffic sent to Elastic Load Balancers (ELB).

**Relational Databases (RDS)**
- **`aws:rds:audit`**: Tracks database activities for engines like PostgreSQL, MySQL, Oracle.
- **`aws:rds:error`**: Logs engine errors for RDS services.

**Metadata**
- **`aws:description`**: Contains descriptive metadata about various AWS services (e.g., names, tags, IDs).

This understanding will help guide our log searches, especially focusing on **CloudTrail** and **CloudWatch** logs to identify IAM users and their interactions with AWS services.

The **CloudTrail** service records most user activity, and AWS provides detailed documentation about the fields used in these API tracking logs, which is extremely helpful.

[CloudTrail record contents for management, data, and network activity events](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html)

![pic3](assets/images/botsv3/pic3.png)

This information gives us a clear idea of where to begin when analyzing the logs.

```sql
index=botsv3 sourcetype=aws:cloudtrail AND eventType=AwsConsoleSignIn
```

Only 4 events were returned. Below is an example of one of these logs:

```json
{
  "requestParameters": null,
  "additionalEventData": {
    "MobileVersion": "No",
    "MFAUsed": "No",
    "LoginTo": "https://console.aws.amazon.com/console/home?state=hashArgs%23&isauthcode=true"
  },
  "eventTime": "2018-08-20T15:04:44Z",
  "eventID": "6ae589cc-9b68-4a08-a3c2-c29c9cd59b9b",
  "eventVersion": "1.05",
  "awsRegion": "us-east-1",
  "eventType": "AwsConsoleSignIn",
  "eventSource": "signin.amazonaws.com",
  "userIdentity": {
    "principalId": "AIDAJUFKXZ44LV4EN4MGK",
    "arn": "arn:aws:iam::622676721278:user/bstoll",
    "type": "IAMUser",
    "userName": "bstoll",
    "accountId": "622676721278"
  },
  "eventName": "ConsoleLogin",
  "recipientAccountId": "622676721278",
  "responseElements": {
    "ConsoleLogin": "Success"
  },
  "sourceIPAddress": "107.77.212.175",
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"
}
```

The `userIdentity` field contains useful information we can extract to identify all IAM users active in Frothly’s AWS environment:

```sql
index=botsv3 sourcetype=aws:cloudtrail | spath "userIdentity.type" | search "userIdentity.type"=IAMUser| spath "userIdentity.userName" 
|table userIdentity.userName userIdentity.type
|stats count by userIdentity.userName userIdentity.type
|sort - userIdentity.userName
```

![pic4](assets/images/botsv3/pic4.png)

There were four users identified: `bstoll,btun,splunk_access,web_admin`.

> ANSWER: `bstoll,btun,splunk_access,web_admin`
{: .prompt-info }

#### Question 2 (201): What field would you use to alert that AWS API activity have occurred without MFA (multi-factor authentication)? Answer guidance: Provide the full JSON path. (Example: iceCream.flavors.traditional)

This question isn’t just about filling in the blank with the correct answer - it’s more about understanding how to **optimize** the approach and **choose the right fields** to make your detection logic effective. In this case, we’ll gradually narrow down events in CloudTrail to find a useful field for alerting.

The idea is to gather as many **relevant** logs as possible - the more targeted and consistent the field, the more effective and noise-free your alert will be.

I will filter only for `eventType=AwsApiCall` and then run a bird’s eye view using the `spog` macro (or similar approach) to audit the fields. We’re specifically looking for fields that:
- Appear in the logs.
- Have 3 or fewer unique values (easy to evaluate conditions).
- Are related to **MFA** (multi-factor authentication).

```sql
index=botsv3 sourcetype=aws:cloudtrail eventType=AwsApiCall
|search *mfa*
|fieldsummary
|fields field values
|rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
|mvexpand value
|stats dc(value) as value_count values(value) as values by field
|where value_count <= 3
```

![pic5](assets/images/botsv3/pic5.png)
_The search results would look like thiThe search results above show various fields; we're looking for those relevant to MFA with few value variations_

Among the results, a promising field appeared: `userIdentity.sessionContext.attributes.mfaAuthenticated` - This field consistently reflects whether an AWS API activity was authenticated using MFA.

![pic6](assets/images/botsv3/pic6.png)

Upon deeper inspection, this field is populated in various eventName and eventSource combinations, making it ideal for a wide coverage alert that detects AWS API activity without MFA.

![pic7](assets/images/botsv3/pic7.png)

> ANSWER: `userIdentity.sessionContext.attributes.mfaAuthenticated`
{: .prompt-info }

#### Question 3 (202): What is the processor number used on the web servers? Answer guidance: Include any special characters/punctuation. (Example: The processor number for Intel Core i7-8650U is i7-8650U.)

Going back to the `metadata` of sourcetypes, there was only one sourcetype relevant to this type of question: `hardware`. Querying this sourcetype returned only 3 events, all containing the same logs.

```sql
index=botsv2 sourcetype=hardware
```

![pic8](assets/images/botsv3/pic8.png)
_But is this really the correct answer ?_

To confirm, I looked up the host associated with the hardware logs: `gacrux.i-09cbc261e84259b54` - and checked if it was truly a web server.

```sql
|metasearch index=botsv3 sourcetype=* host="gacrux.i-09cbc261e84259b54"
|table sourcetype
|stats count by sourcetype
```

The result returned 45 sourcetypes, and among them was one that clearly indicated the host was a web server: `apache_error` (with 7 events).

Diving into that sourcetype confirmed the server was running Apache/2.2.34.

![pic9](assets/images/botsv3/pic9.png)

> ANSWER: E5-2676
{: .prompt-info }

#### Question 4 (203): Bud accidentally makes an S3 bucket publicly accessible. What is the event ID of the API call that enabled public access? Answer guidance: Include any special characters/punctuation.

This seems to mark the beginning of a serious security incident. It reminds me of a real case at my previous company, where an **AWS secret key** was accidentally exposed. A threat actor discovered it, gained access to our cloud environment, deployed crypto miners, and caused **significant financial loss.**

In this scenario, public access to an S3 bucket was likely the attacker's entry point into Frothly’s AWS environment.

In earlier questions, we saw that almost all services had **MFA disabled**. So I started by filtering CloudTrail logs for `eventSource=s3.amazonaws.com` where MFA was not used:

```sql
index=botsv3 sourcetype=aws:cloudtrail 
AND userIdentity.sessionContext.attributes.mfaAuthenticated=false AND eventSource=s3.amazonaws.com
```

![pic10](/assets/images/botsv3/pic10.png)

I got 15 unique eventName results. I then referred to [AWS S3 Documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html) which explained that S3 bucket permissions are controlled through ACLs. The `PutBucketAcl` API is used to change these permissions.

Only two events matched `PutBucketAcl`, so I focused on those:

```sql
index=botsv3 sourcetype=aws:cloudtrail 
AND userIdentity.sessionContext.attributes.mfaAuthenticated=false AND eventSource=s3.amazonaws.com AND eventName=PutBucketAcl
```

```json
{
  "eventTime": "2018-08-20T13:01:46Z",
  "eventName": "PutBucketAcl",
  "userIdentity": {
    "accountId": "622676721278",
    "userName": "bstoll",
    "arn": "arn:aws:iam::622676721278:user/bstoll",
    "sessionContext": {
      "attributes": {
        "mfaAuthenticated": "false",
        "creationDate": "2018-08-20T12:19:44Z"
      }
    },
    "type": "IAMUser",
    "invokedBy": "signin.amazonaws.com",
    "accessKeyId": "ASIAZB6TMXZ7OA2RDK5X",
    "principalId": "AIDAJUFKXZ44LV4EN4MGK"
  },
  "sourceIPAddress": "107.77.212.175",
  "eventSource": "s3.amazonaws.com",
  "eventVersion": "1.05",
  "requestID": "487488D003569438",
  "responseElements": null,
  "awsRegion": "us-west-1",
  "userAgent": "signin.amazonaws.com",
  "eventID": "ab45689d-69cd-41e7-8705-5350402cf7ac",
  "requestParameters": {
    "acl": [
      ""
    ],
    "AccessControlPolicy": {
      "AccessControlList": {
        "Grant": [
          {
            "Grantee": {
              "DisplayName": "bstoll",
              "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "CanonicalUser"
            },
            "Permission": "FULL_CONTROL"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "WRITE"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ_ACP"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ"
          },
          {
            "Grantee": {
              "DisplayName": "bstoll",
              "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "CanonicalUser"
            },
            "Permission": "FULL_CONTROL"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/global/AllUsers",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/global/AllUsers",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "WRITE"
          }
        ]
      },
      "Owner": {
        "DisplayName": "bstoll",
        "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d"
      },
      "xmlns": "http://s3.amazonaws.com/doc/2006-03-01/"
    },
    "bucketName": "frothlywebcode"
  },
  "recipientAccountId": "622676721278",
  "eventType": "AwsApiCall"
}
```

Oh well ! Bud granted READ and WRITE access to `AllUsers`, meaning anyone on the internet could access this bucket:

```json
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/global/AllUsers",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/global/AllUsers",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "WRITE"
          }
```

How about the second one ?

```json
{
  "eventTime": "2018-08-20T13:57:54Z",
  "eventName": "PutBucketAcl",
  "userIdentity": {
    "accountId": "622676721278",
    "userName": "bstoll",
    "arn": "arn:aws:iam::622676721278:user/bstoll",
    "sessionContext": {
      "attributes": {
        "mfaAuthenticated": "false",
        "creationDate": "2018-08-20T13:57:22Z"
      }
    },
    "type": "IAMUser",
    "invokedBy": "signin.amazonaws.com",
    "accessKeyId": "ASIAZB6TMXZ7FWTIS4NJ",
    "principalId": "AIDAJUFKXZ44LV4EN4MGK"
  },
  "sourceIPAddress": "107.77.212.175",
  "eventSource": "s3.amazonaws.com",
  "eventVersion": "1.05",
  "requestID": "6A18BDBBC85C6E81",
  "responseElements": null,
  "awsRegion": "us-west-1",
  "userAgent": "signin.amazonaws.com",
  "eventID": "9a33d8df-1e16-4d58-b36d-8e80ce68f8a3",
  "requestParameters": {
    "acl": [
      ""
    ],
    "AccessControlPolicy": {
      "AccessControlList": {
        "Grant": [
          {
            "Grantee": {
              "DisplayName": "bstoll",
              "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "CanonicalUser"
            },
            "Permission": "FULL_CONTROL"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "WRITE"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ_ACP"
          },
          {
            "Grantee": {
              "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "Group"
            },
            "Permission": "READ"
          },
          {
            "Grantee": {
              "DisplayName": "bstoll",
              "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d",
              "xmlns:xsi": "http://www.w3.org/2001/XMLSchema-instance",
              "xsi:type": "CanonicalUser"
            },
            "Permission": "FULL_CONTROL"
          }
        ]
      },
      "Owner": {
        "DisplayName": "bstoll",
        "ID": "4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d"
      },
      "xmlns": "http://s3.amazonaws.com/doc/2006-03-01/"
    },
    "bucketName": "frothlywebcode"
  },
  "recipientAccountId": "622676721278",
  "eventType": "AwsApiCall"
}
```

In this second event, Bud appears to have tried fixing his mistake by removing public access and only assigning permissions to internal groups. Unfortunately, it was too late. There was a 56-minute window between the first and second event - more than enough time for an attacker to gain a foothold.

Worse still, the bucket in question was `frothlywebcode`, which could contain sensitive source code or configurations. An attacker could exploit this in unpredictable and damaging ways.

**Victim**
- `"bucketName": "frothlywebcode"`

**MITRE Tactics / Techniques**
- **Initial Access (TA0001)**
  - Valid Accounts: Cloud Accounts (T1078.004)

> ANSWER: `ab45689d-69cd-41e7-8705-5350402cf7ac`
{: .prompt-info }

#### Question 5 (204): What is the name of the S3 bucket that was made publicly accessible?

I won't explain anything in this following question ! We've seem like confirm the initial access vector from the adversary.

> ANSWER: frothlywebcode
{: .prompt-info }

#### Question 6 (205): What is the name of the text file that was successfully uploaded into the S3 bucket while it was publicly accessible? Answer guidance: Provide just the file name and extension, not the full path. (Example: filename.docx instead of /mylogs/web/filename.docx)

Now that we’ve built the timeline, let’s dive into some timeline analysis.

```sql
index=botsv3 sourcetype="aws:s3:accesslogs" earliest="08/20/2018:20:01:46" AND latest="08/20/2018:20:57:54" AND bucket_name=frothlywebcode
|reverse
```
After extracting some key fields, we can see a few interesting events logged in the frothlywebcode S3 bucket.

```sql
index=botsv3 sourcetype="aws:s3:accesslogs" earliest="08/20/2018:20:01:46" AND latest="08/20/2018:20:57:54" AND bucket_name=frothlywebcode
|reverse
|table _time remote_ip user_agent action http_method operation request_uri object_size
```

![pic11](assets/images/botsv3/pic11.png)

We already know that the IP `107.77.212.175` belongs to `bstoll` who was accidentally misconfiged Frothy's private bucket, so let’s focus on the other entries.

From the logs:
- IP `52.66.146.128` uploaded a text file named `OPEN_BUCKET_PLEASE_FIX.txt`
- IP `35.182.246.222` uploaded a zipped file named `frothly_html_memcached.tar.gz`, which is about 3 MB in size

After these uploads, we also see some enumeration activity in the logs:

![pic12](assets/images/botsv3/pic12.png)

Toward the end of the timeline, the IP that uploaded the zipped file (`35.182.246.222`) appears to enumerate the entire S3 bucket:

![pic13](assets/images/botsv3/pic13.png)

It looks like the text file `OPEN_BUCKET_PLEASE_FIX.txt` was uploaded as a warning to Frothly about their bucket being publicly accessible. On the other hand, the zipped file seems more suspicious and worth further investigation.

**Victim**
- `"bucketName": "frothlywebcode"`

**Possible Malicious contents**
- `52.66.146.128` 
- `35.182.246.222`
- `OPEN_BUCKET_PLEASE_FIX.txt`
- `frothly_html_memcached.tar.gz`


> ANSWER: `OPEN_BUCKET_PLEASE_FIX.txt`
{: .prompt-info}

#### Question 7 (206): What is the size (in megabytes) of the .tar.gz file that was successfully uploaded into the S3 bucket while it was publicly accessible? Answer guidance: Round to two decimal places without the unit of measure. Use 1024 for the byte conversion. Use a period (not a comma) as the radix character.

This question is straightforward, so we won’t go into too much detail here. We'll dig deeper into the threat actor’s TTPs in the next questions.

To calculate the size of the uploaded file, and based on previous question, we can use the following Splunk query, the key was using `round`:

```sql
index=botsv3 sourcetype="aws:s3:accesslogs" earliest="08/20/2018:20:01:46" latest="08/20/2018:20:57:54" bucket_name=frothlywebcode remote_ip!=107.77.212.175 AND http_method=PUT
|reverse
|eval object_size_MB=round(object_size/1024/1024, 2)
|table _time remote_ip user_agent action http_method operation request_uri object_size object_size_MB
```

![pic14](assets/images/botsv3/pic14.png)
_From the results, the file `frothly_html_memcached.tar.gz` had a size of 2.93 MB_

> ANSWER: `2.93`
{: .prompt-info}

#### Question 8 (208): A Frothly endpoint exhibits signs of coin mining activity. What is the name of the first process to reach 100 percent CPU processor utilization time from this activity on this endpoint? Answer guidance: Include any special characters/punctuation.

This question was more difficult to answer due to the small size and lack of contextual depth in the BOTSv3 dataset. Unlike BOTSv2's, even "attack-only" dataset has the size about 3.2 GB, correlating between multiple data sources here is more limited. Nevertheless, we’ll work with what’s available.

In the previous question, we identified several suspicious files (`OPEN_BUCKET_PLEASE_FIX.txt`, `frothly_html_memcached.tar.gz`) across multiple endpoints. To begin the investigation, I ran the following search:

```sql
index=botsv3 sourcetype=* AND sourcetype!=aws:s3:accesslogs AND earliest="08/20/2018:20:01:46" 
AND (*OPEN_BUCKET_PLEASE_FIX.txt* OR *frothly_html_memcached.tar.gz*)
|reverse
```
This search revealed six endpoints interacting with suspicious files:

- BSTOLL-L – Source types: `xmlwineventlog`, `wineventlog`
- `gacrux.i-09cbc261e84259b54` – Apache web server
- Two more similar EC2 instances – Source type: c`loud-init-output`
- `mars.i-08e52f8b5a034012d` – Source types: `osquery:results`, `bash_history`
- `console.us.code42.com` – Possibly Code42 security monitoring/assessment platform

![pic15](assets/images/botsv3/pic15.png)

Logs from Code42 clearly show BudStoll downloading and opening the file using `chrome.exe`:

```sql
index=botsv3 sourcetype=* AND sourcetype!=aws:s3:accesslogs AND earliest="08/20/2018:20:01:46" 
AND (*OPEN_BUCKET_PLEASE_FIX.txt* OR *frothly_html_memcached.tar.gz*)
AND host=console.us.code42.com:443
|reverse
```

```json
{
  "formattedTimestamp": "2018-08-20T14:04:12.962Z",
  "timestamp": 1534773852,
  "processName": "\\Device\\HarddiskVolume4\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe",
  "version": "1.0",
  "fileStats": {
    "uploadedBytes": null,
    "modifiedNum": null,
    "openedBytes": null,
    "openedNum": null,
    "downloadedBytes": 9229596,
    "downloadedNum": 3,
    "totalNum": 3,
    "addedBytes": null,
    "uploadedNum": null,
    "addedNum": null,
    "deletedNum": null,
    "deletedBytes": null,
    "totalBytes": 9229596,
    "modifiedBytes": null
  },
  "modular_input_consumption_time": "Mon, 20 Aug 2018 14:07:46 +0000",
  "userUid": "858527737266971219",
  "deviceRemoteAddress": "12.196.122.127",
  "eventType": "FILE_OPENED",
  "processOwner": "BudStoll",
  "eventUid": "2683198308419395342",
  "deviceGuid": "858528515276632730",
  "deviceAddress": "0.0.0.0",
  "files": [
    {
      "fileType": "FILE",
      "mimeType": "application/gzip",
      "lastModified": 1534773625695,
      "fileEventType": "DOWNLOAD",
      "restoreSuccessful": null,
      "md5": "218dd64994af34fdd8a96d99529ee30f",
      "length": 3076532,
      "fileName": "frothly_html_memcached.txt",
      "fullPath": "c:\\users\\budstoll\\downloads\\frothly_html_memcached.txt",
      "detectionTimestamp": 1534773633332
    },
    {
      "fileType": "FILE",
      "mimeType": "application/gzip",
      "lastModified": 1534773563726,
      "fileEventType": "DOWNLOAD",
      "restoreSuccessful": null,
      "md5": "218dd64994af34fdd8a96d99529ee30f",
      "length": 3076532,
      "fileName": "frothly_html_memcached.tar.gz",
      "fullPath": "c:\\users\\budstoll\\downloads\\frothly_html_memcached.tar.gz",
      "detectionTimestamp": 1534773565175
    },
    {
      "fileType": "FILE",
      "mimeType": "application/gzip",
      "lastModified": 1534773852391,
      "fileEventType": "DOWNLOAD",
      "restoreSuccessful": null,
      "md5": "218dd64994af34fdd8a96d99529ee30f",
      "length": 3076532,
      "fileName": "frothly_html_memcached.tar.gz",
      "fullPath": "c:\\users\\budstoll\\downloads\\frothly_html_memcached.tar.gz",
      "detectionTimestamp": 1534773853800
    }
  ]
}
```

This a strong indicator that BudStoll had downloaded file and opened it, actived process `chrome.exe`.

Next was those 3 Web Server, minimal events from these hosts. However, logs show downloads from s3://frothlywebcode, indicating this is part of Frothly’s internal CI/CD deployment infrastructure. The malicious file was also fetched during the setup, but there's no sign it was executed here.

```sql
index=botsv3 sourcetype=* AND sourcetype!=aws:s3:accesslogs AND earliest="08/20/2018:20:01:46" 
AND (*OPEN_BUCKET_PLEASE_FIX.txt* OR *frothly_html_memcached.tar.gz*)
AND host=gacrux.i*
```

```log
Complete!
Completed 4.2 KiB/4.2 KiB (11.8 KiB/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/osquery.conf to ./osquery.conf
Completed 256.0 KiB/2.9 MiB (654.7 KiB/s) with 1 file(s) remaining
Completed 512.0 KiB/2.9 MiB (1.3 MiB/s) with 1 file(s) remaining  
Completed 768.0 KiB/2.9 MiB (1.9 MiB/s) with 1 file(s) remaining  
Completed 1.0 MiB/2.9 MiB (2.5 MiB/s) with 1 file(s) remaining    
Completed 1.2 MiB/2.9 MiB (3.1 MiB/s) with 1 file(s) remaining    
Completed 1.5 MiB/2.9 MiB (3.7 MiB/s) with 1 file(s) remaining    
Completed 1.8 MiB/2.9 MiB (4.2 MiB/s) with 1 file(s) remaining    
Completed 2.0 MiB/2.9 MiB (4.8 MiB/s) with 1 file(s) remaining    
Completed 2.2 MiB/2.9 MiB (5.3 MiB/s) with 1 file(s) remaining    
Completed 2.5 MiB/2.9 MiB (5.9 MiB/s) with 1 file(s) remaining    
Completed 2.8 MiB/2.9 MiB (6.5 MiB/s) with 1 file(s) remaining    
Completed 2.9 MiB/2.9 MiB (6.8 MiB/s) with 1 file(s) remaining    
download: s3://frothlywebcode/frothly_html_memcached.tar.gz to ./frothly_html_memcached.tar.gz
Completed 17.1 KiB/17.1 KiB (45.9 KiB/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/http_conf.tar.gz to ./http_conf.tar.gz
Completed 3.6 KiB/3.6 KiB (4.2 KiB/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/uf_deployment.sh to ./uf_deployment.sh
Completed 79 Bytes/79 Bytes (211 Bytes/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/sysconfig_memcached to ./sysconfig_memcached
Completed 2.9 KiB/2.9 KiB (8.3 KiB/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/config.php to ./config.php  
Completed 204.8 KiB/204.8 KiB (558.2 KiB/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/Splunk_TA_nix.tgz to ./Splunk_TA_nix.tgz
Completed 119 Bytes/119 Bytes (361 Bytes/s) with 1 file(s) remaining
download: s3://frothlyweb/configs/process-monitoring.conf to ./process-monitoring.conf
accepting defaults
downloading splunkstreamfwd-7.1.2-157.linux64.tar.bz2 package from https://splunk.froth.ly/en-us/custom/splunk_app_stream/install_streamfwd/linux64 ..
```

Last but not least, the last host, the `bash_history` and `osquery:results` logs suggest this instance was used for scripting and automation, including uploading the file:.

```sql
index=botsv3 sourcetype=* AND sourcetype!=aws:s3:accesslogs AND earliest="08/20/2018:20:01:46" 
AND (*OPEN_BUCKET_PLEASE_FIX.txt* OR *frothly_html_memcached.tar.gz*)
AND host=mars.i-08e52f8b5a034012d
```

```bash
python /home/ec2-user/tools/s3-upload.py --bucket frothlywebcode --file frothly_web_memcaced.tar.gz --folder ‘’ --target frothly_html_memcached.tar.gz <---- Logs from bash_history
```

Despite limited indicators of compromise (IOCs) on BSTOLL-L, this endpoint is our strongest lead based on:
- The user (BudStoll) downloading and opening the file
- Associated Windows event logs being available

To detect coin mining activity, I focused on performance monitoring logs. Three relevant sourcetypes surfaced:
- top
- cpu
- PerfmonMk:Process

Out of these, `PerfmonMk:Process` is particularly important—it logs CPU usage per process and was only seen from `BSTOLL-L`.

Using `PerfmonMk:Process`, I looked for the first process that spiked to 100% CPU usage. After sorting the data chronologically, the first process to hit this threshold was revealed.

```sql
index=botsv3 sourcetype="PerfmonMk:Process" AND process_cpu_used_percent=100 AND earliest="08/20/2018:20:01:46"
|reverse
|table _time process_name ID_Process
```

![pic16](assets/images/botsv3/pic16.png)

A bunch of chrome processes reach 100% cpu usage, start with `chrome#5`

Trace back with the process id of 3400.

![pic17](assets/images/botsv3/pic17.png)

There were not much indicators that we could pull out from the sourcetypes. 

> ANSWER: `chrome#5`
{: .prompt-info }

#### Question 9 (209): When a Frothly web server EC2 instance is launched via auto scaling, it performs automated configuration tasks after the instance starts. How many packages and dependent packages are installed by the cloud initialization script? Answer guidance: Provide the number of installed packages then number of dependent packages, comma separated without spaces.

In earlier steps, we identified that three Frothly web servers were involved in deploying and possibly executing a suspicious payload (`frothly_html_memcached.tar.gz`). During startup, these EC2 instances run a cloud initialization script, which installs various packages necessary for the web server environment.

To find the exact number of installed packages, I reviewed the logs from the relevant cloud-init output. Here's a snippet of the relevant transaction summary:

```log
Dependencies Resolved
================================================================================
 Package            Arch   Version                    Repository           Size
================================================================================
Installing:
 httpd              x86_64 2.2.34-1.16.amzn1          amzn-main           1.2 M
 libmemcached       x86_64 1.0.16-5.8.amzn1           amzn-main           271 k
 memcached          x86_64 1.4.15-10.15.amzn1         amzn-main            88 k
 osquery            x86_64 3.2.6-1.linux              osquery-s3-rpm-repo 8.0 M
 php                x86_64 5.3.29-1.8.amzn1           amzn-main           2.8 M
 php-mysql          x86_64 5.3.29-1.8.amzn1           amzn-main           178 k
 php-pecl-memcached x86_64 2.1.0-3.5.amzn1            amzn-main            45 k
Installing for dependencies:
 apr                x86_64 1.5.2-5.13.amzn1           amzn-main           118 k
 apr-util           x86_64 1.5.4-6.18.amzn1           amzn-main            99 k
 apr-util-ldap      x86_64 1.5.4-6.18.amzn1           amzn-main            19 k
 compat-gmp4        x86_64 4.3.2-1.14.amzn1           amzn-main           302 k
 httpd-tools        x86_64 2.2.34-1.16.amzn1          amzn-main            80 k
 mysql55-libs       x86_64 5.5.60-1.21.amzn1          amzn-updates        816 k
 php-cli            x86_64 5.3.29-1.8.amzn1           amzn-main           2.6 M
 php-common         x86_64 5.3.29-1.8.amzn1           amzn-main           1.0 M
 php-pdo            x86_64 5.3.29-1.8.amzn1           amzn-main           170 k
 php-pear           noarch 1:1.10.1-1.19.amzn1        amzn-main           413 k
 php-pecl-igbinary  x86_64 1.1.2-0.2.git3b8ab7e.3.amzn1
                                                      amzn-main            30 k
 php-process        x86_64 5.3.29-1.8.amzn1           amzn-main            66 k
 php-xml            x86_64 5.3.29-1.8.amzn1           amzn-main           234 k
Transaction Summary
================================================================================
Install  7 Packages (+13 Dependent packages)
```

> ANSWER: `7,13`
{: .prompt-info }

#### Question 10 (210): What is the short hostname of the only Frothly endpoint to actually mine Monero cryptocurrency? (Example: ahamilton instead of ahamilton.mycompany.com)

This question directly follows the CPU-based analysis from Question 8. As previously established, the only endpoint to run `chrome.exe` and hit 100% CPU usage was: `BSTOLL-L` - BudStoll's endpoint.

This matches the behavior of Monero mining, and no other endpoint demonstrated similar behavior. But question revealed several questions:
- Why CPU but not GPU or even Asics, because that's Monero.
- A tons of chrome processes use for crypto mining but no indicator of compromise in host machine really triggerd an alert about browser-based crypto mining
- Assume that `.txt` extracted suspicious zipped contain information of

> ANSWER: `BSTOLL-L`
{: .prompt-info }

> **A THOUGHT FROM QUESTIONS 208–210:**  
> After reading write-ups from others, it seems most people approached these questions like a simple "find the answer and fill in the blank" task. That’s totally fine-no judgment on how anyone tackles this kind of CTF.  
>  
> However, I came across a blog post by [clo.ng](https://clo.ng/blog/bots-part2/), and I was genuinely excited to see someone else struggling with these questions-not because they were technically difficult, but because of the **lack of context and the vague structure of the questions**. It’s reassuring to know the confusion wasn’t just on my end.
{: .prompt-warning }


#### Mid-Series Recap

Before continuing this series, let’s take a moment to slow down and chain together what we've uncovered so far.

I have to admit, I got a bit lost in the previous questions. It became difficult to map some of the activities to the MITRE ATT&CK kill chain due to the lack of context. Here's a breakdown of what we observed:

- The adversary gained a foothold in the Frothly environment via a publicly exposed S3 bucket.
- They injected a malicious ZIP file into the bucket.
- A web server fetched the contents of the bucket through an automated script (`s3update.py`). However, there was no clear evidence that the web server actually executed the contents of the ZIP.
- Bud Stoll downloaded and opened the file, which had a `.txt` extension.
- There was no obvious malicious execution on `BSTOLL-L` (possibly Bud Stoll's laptop).
- Despite that, the endpoint showed signs of cryptojacking-specifically, multiple `chrome.exe` processes consuming 100% CPU.

**Unanswered Questions**

There are several aspects I couldn’t make sense of:

- How could a `.txt` file lead to a cryptojacking incident? There was no associated process or command line activity (as seen in the timeline) to indicate execution.
- How did a legitimate process like `chrome.exe` hit 100% CPU? There were no signs of process injection, hollowing, or hijacking.

At this point, the only clear indicator of compromise was the malicious ZIP file (Initial Access). Without evidence of execution, it was hard to move forward meaningfully. Simply finding flags to answer questions doesn’t help us *learn* anything.

After spent several hours researching and finally came across something that blew my mind, and potentially unlocks the whole series.

Let’s talk briefly about cryptocurrency:

- **Bitcoin** is the most well-known cryptocurrency. We’ve all seen giant mining farms built with custom hardware-**ASICs**-designed for nothing but complex math. They're powerful but expensive and have no resale value once obsolete.
- Bitcoin’s blockchain ledger is also public, you can trace who sent what to whom and how much.

In contrast:

- **Monero (XMR)** is a **privacy-focused** cryptocurrency. It can be mined efficiently using **CPUs**, and transactions are untraceable.
- Monero mining happens in two primary ways:
  1. Installing dedicated software to run mining operations.
  2. **Browser-based mining**, users visit a website and unknowingly contribute CPU resources via JavaScript APIs. Once they leave the site, mining stops.

**Coinhive**

One of the most infamous browser-based mining platforms was **Coinhive**, popular around 2017–2018.

Coinhive was marketed as a **win-win** model:
- Website owners could earn revenue from visitors **without ads**.
- Visitors contributed a small amount of CPU power (often throttled) and enjoyed an ad-free experience.

Unfortunately, adversaries **abused** this model:
- They embedded Coinhive scripts **without CPU throttling**, **without notice**, and **without user consent**, resulting in cryptojacking.

**Connecting the kill-chain**

This revelation tied a lot of loose ends together:

- The `.txt` file Bud Stoll opened may have contained an embedded **malicious link** or **hidden redirection**.
- Once opened, it may have triggered the browser (`chrome.exe`) to **visit a cryptojacking website** running Coinhive or a similar script.
- That's why `chrome.exe` spiked to 100% CPU—without any clear malware or injected payload.

**Useful Resources**

Below are some resouces i used to clear the picture:

- [How and Why to Mine Monero](https://www.youtube.com/watch?v=lu0k59y5z3E&t=561s) by Mental Outlaw  
- [A Look into the Global Drive-by Cryptocurrency Mining Phenomenon](https://www.malwarebytes.com/blog/news/2017/11/a-look-into-the-global-drive-by-cryptocurrency-mining-phenomenon) by Malwarebytes  
- [Who and What Is Coinhive?](https://krebsonsecurity.com/2018/03/who-and-what-is-coinhive/) by Krebs on Security

**Victim:**  
- Bud Stoll

**Malicious Content:**  
- `frothly_html_memcached.txt` (Used to lure the user into a drive-by cryptojacking site)

**Tactics/Techniques (MITRE ATT&CK):**
- **Execution (TA0002)**
  - T1204.001 - User Execution: Malicious Link
- **Impact (TA0040)**
  - T1496 - Resource Hijacking

#### Question 11 (211): How many cryptocurrency mining destinations are visited by Frothly endpoints?
Since we've already identified that `chrome.ex`e is the process responsible for cryptomining activity, and we know Bud Stoll’s computer was compromised via drive-by cryptojacking, the next step is to determine which websites he visited that could have triggered the attack.

First, I traced all the websites Bud Stoll accessed during the infection window — the timeframe between the first and last appearance of `chrome.exe` consuming 100% CPU:

```sql
index=botsv3 sourcetype=wineventlog host="BSTOLL-L" *chrome* Outbound 
earliest="08/20/2018:20:37:50" latest="08/20/2018:21:04:11"
AND (Destination_Port=443 OR Destination_Port=80)
|dedup Destination_Address
|table Destination_Address
```

![pic18](https://krebsonsecurity.com/2018/03/who-and-what-is-coinhive/)
_42 distinct IP addresses that Bud’s machine communicated with during that period._

To get more context, I correlated this data with DNS queries to identify actual domain names. This query pulled DNS resolutions linked to the identified destination IPs.

```sql
index=botsv3 sourcetype=stream:dns 
[search index=botsv3 sourcetype=wineventlog host="BSTOLL-L" *chrome* Outbound 
earliest="08/20/2018:20:37:50" latest="08/20/2018:21:04:11"
AND (Destination_Port=443 OR Destination_Port=80)
|dedup Destination_Address
|fields Destination_Address 
|rename Destination_Address as host_addr{}
|format
]
|table query{}
|stats count by query{}
```

Surprisingly, one of the resolved domains was `coinhive.com` - a well-known browser-based Monero mining platform.

![pic19](assets/images/botsv3/pic19.png)

Wanting to see how widespread this was, I broadened the search across all Frothly endpoints, removing the time constraint and filtering for any connection to `coinhive.com`.

```sql
index=botsv3 sourcetype=stream:dns 
[search index=botsv3 sourcetype=wineventlog host=* *chrome* Outbound 
AND (Destination_Port=443 OR Destination_Port=80)
|dedup Destination_Address
|fields Destination_Address 
|rename Destination_Address as host_addr{}
|format
]
AND *coinhive.com
|table query{}
|stats count by query{}
```

![pic20](assets/images/botsv3/pic20.png)

This revealed that six distinct Coinhive-related domains were visited by Frothly endpoints, there were 2 endpoints contacted to those domain:
- BSTOLL-L
- MKRAEUS-L

**Victim**
- BSTOLL-L
- MKRAEUS-L

**Malicous Contents**
- coinhive.com - 104.20.209.59
- ws001.coinhive.com - 217.182.164.14
- ws005.coinhive.com - 37.187.165.41
- ws011.coinhive.com - 37.187.166.108
- ws014.coinhive.com - 37.187.167.21
- ws019.coinhive.com - 37.187.167.47
  
> ANSWER: `6`
{: .prompt-info }

#### Question 12 (212): Using Splunk's event order functions, what is the first seen signature ID of the coin miner threat according to Frothly's Symantec Endpoint Protection (SEP) data?

Since there were no obvious indicators carried over from previous questions, I started with a broad search in the EDR platform for any events mentioning coin mining activity. This returned 46 events:

```sql
index=botsv3 sourcetype=symantec* AND *coin*
|reverse
|table _time user Host_Name Remote_Host_IP Intrusion_URL file_name Event_Description
|rename user as victim, Host_Name as victim_host, Remote_Host_IP as malicous_ip
```
![pic21](assets/images/botsv3/pic21.png)

The earliest relevant log:

```bash
2018 - 08 - 20 13:37:40, Major, BTUN - L, SHA - 256: 42D2F666AFD8A350A3F3BBCD736D7E35543D9DD9753B211C9F03C4F7E669ACE3, MD - 5:, [SID: 30358] Web Attack: JSCoinminer Download 8 attack blocked. Traffic has been blocked for this application: C:\WINDOWS\SYSTEMAPPS\MICROSOFT.MICROSOFTEDGE_8WEKYB3D8BBWE\MICROSOFTEDGECP.EXE, Local: 192.168.3.130, Local: 000000000000, Remote:, Remote: 54.67.127.227, Remote: 000000000000, Inbound, TCP, Intrusion ID: 0, Begin: 2018 - 08 - 18 20:51:14, End: 2018 - 08 - 18 20:51:14, Occurrences: 1, Application: C:/WINDOWS/SYSTEMAPPS/MICROSOFT.MICROSOFTEDGE_8WEKYB3D8BBWE/MICROSOFTEDGECP.EXE, Location: Default, User: BillyTun, Domain: AzureAD, Local Port 63140, Remote Port 80, CIDS Signature ID: 30358, CIDS Signature string: Web Attack: JSCoinminer Download 8, CIDS Signature SubID: 70481, Intrusion URL: www.brewertalk.com / forumdisplay.php?fid = 9, Intrusion Payload URL:
```

Interestingly, the IP address blocked for the JavaScript Coinminer attack is tied to Frothly’s own web infrastructure, specifically an AWS Elastic Load Balancer. All three of Frothly's web servers were redundantly configured and fetched a malicious zip file at some earlier stage.

Unfortunately, despite this connection, I could not find a `.js` file or any conclusive artifacts proving that the zipped contents led to direct cryptojacking via JavaScript. Still, the first seen signature ID remains clear.

> ANSWER: `30358`
{: .prompt-info }

#### Question 13 (213): According to Symantec's website, what is the severity of this specific coin miner threat?	

This is a follow-up to Question 12. The severity rating for this signature ID (30358) is listed on Broadcom's Security Center:

[Web Attack: JSCoinminer Download 8](https://www.broadcom.com/support/security-center/attacksignatures/detail?asid=30358)

> ANSWER: `Medium`
{: .prompt-info }

#### Question 14 (214): What is the short hostname of the only Frothly endpoint to show evidence of defeating the cryptocurrency threat? (Example: ahamilton instead of ahamilton.mycompany.com)

All alerts related to the coin miner activity—including those indicating successful blocking-were observed on a single endpoint: `BTUN-L`, which belongs to Billy Tun.

> ANSWER: `BTUN-L`
{: .prompt-info }

#### Question 15 (215): What is the FQDN of the endpoint that is running a different Windows operating system edition than the others?

This question feels like a classic CTF-style prompt, possibly with some hidden hints. From experience in previous Boss of the SOC (BOTS) scenarios, we know that the `WinHostMon` sourcetype includes detailed Windows host metadata.

To start, I searched for all host information that contains OS data:

```sql
index=botsv3 sourcetype=WinHostMon (OS AND *Win*)
```

![pic23](assets/images/botsv3/pic23.png)

Since I wanted a higher-level summary, I used the Bird's Eye View approach to see which fields might reveal OS version data:

```sql
index=botsv3 sourcetype=WinHostMon (OS AND *Win*)
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
| where isnotnull(value)
```

![pic24](assets/images/botsv3/pic24.png)

As expected, there was a field that reliably includes OS details. Using a focused query, I filtered by host and OS:

```sql
index=botsv3 sourcetype=WinHostMon (OS AND *Win*)
|table OS host 
|stats count by OS host
```
Output:

| OS                              | host      | count |
| ------------------------------- | --------- | ----- |
| Microsoft Windows 10 Enterprise | BSTOLL-L  | 30    |
| Microsoft Windows 10 Pro        | ABUNGST-L | 16    |
| Microsoft Windows 10 Pro        | BGIST-L   | 23    |
| Microsoft Windows 10 Pro        | BTUN-L    | 29    |
| Microsoft Windows 10 Pro        | FYODOR-L  | 23    |
| Microsoft Windows 10 Pro        | JWORTOS-L | 30    |
| Microsoft Windows 10 Pro        | MKRAEUS-L | 25    |
| Microsoft Windows 10 Pro        | PCERF-L   | 28    |

From the output, it's clear that only one machine - `BSTOLL-L` is running Microsoft Windows 10 Enterprise, while all others are using the Pro edition:

To find the FQDN of `BSTOLL-L`, I queried the `wineventlog` sourcetype using common logon Event Codes (4624 for successful logon, 4625 for failure):

```sql
index=botsv3 sourcetype=wineventlog AND host=BSTOLL-L AND EventCode=4624 OR EventCode=4625
```

```log
08/20/2018 03:16:37 AM
LogName=Security
SourceName=Microsoft Windows security auditing.
EventCode=4624
EventType=0
Type=Information
ComputerName=BSTOLL-L.froth.ly <---- This confirms the full hostname.
TaskCategory=Logon
OpCode=Info
RecordNumber=989781
Keywords=Audit Success
Message=An account was successfully logged on.

Subject:
	Security ID:		NT AUTHORITY\SYSTEM
	Account Name:		BSTOLL-L$
	Account Domain:		WORKGROUP
	Logon ID:		0x3E7
```

> ANSWER: `BSTOLL-L.froth.ly`
{: .prompt-info }

#### Question 16 (216): According to the Cisco NVM flow logs, for how many seconds does the endpoint generate Monero cryptocurrency? Answer guidance: Round to the nearest second without the unit of measure.
