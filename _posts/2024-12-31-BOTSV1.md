---
title: Boss of the SOC version 1 Write-ups
date: 2024-12-31 16:20:00 + 0700
categories: [siem, blue-teaming, soc, ctf-challenge]
tags: [splunk, threat-hunting, log-analysis, write-ups]    
author: <author_id>   
description: Help Batman and his company - Wayne Corp as the Alice Bluebird - a quirky security analyst !
# toc: false - uncomment to turn off Table of Contents which is use for display content in right-panel 
#comments: false # uncomment to turn on comment 
image: /assets/images/preview/botsv1.png
pin: true
---
# Introduction 
### What is Boss of the SOC (BOTS) ?
- **Overview:** BOTS (Boss of the SOC) is a **[blue-team](https://en.wikipedia.org/wiki/Blue_team_(computer_security))** Capture the Flag (CTF) challenge created by **[Splunk](https://www.splunk.com/)**. It gives participants the chance to dive into realistic **security incidents** within enterprise environments, using Splunk as the main platform along with other tools. The challenge involves **analyzing** data, **investigating** threats, and answering questions based on **real-world** scenarios.
- **Purpose:** You could see easily while most CTF challenges are designed for **[red teams](https://en.wikipedia.org/wiki/Red_team)**, BOTS stands out by focusing on blue teams. It provides a dedicated platform for defenders like us to sharpen our skills. It’s a great way to improve our ability to **detect**, **analyze**, and **identify** incidents in a competitive yet collaborative setting.
- **Tools and techniques:** 
  - **Primary Tool**: Splunk (ofc!) as the core SIEM.
  - **Supporting Skills:** Skills like utilize OSINT, networking fundamentals, cloud computing with AWS and Azure (especially in BOTSv3), web application security, and operating system knowledges all come into play.
  - **Mindset:** Most importantly, success depends on having a **threat-hunting** mindset, thinking beyond the "Splunk box" to creatively identify and analyze threats.
  
### Why i write this walkthrough ?
As I write this in December 2024, i reflect on my experience participating in Boss of the SOC (BOTS) earlier this year, starting in late April 2024. This walkthrough serves two key purposes:
- **Sharing Knowledge:**  BOTS provided me with invaluable insights into real-world incident response and threat hunting. By documenting my experience, i aim to share the strategies and lessons i’ve learned to help others succeed in this unique challenge - all from my **personal perspective**.
- **Self-Reflection:** Revisiting the challenges from BOTS helps me consolidate what I’ve learned and identify areas for improvement. This walkthrough is not only a guide for others but also a personal milestone in my cybersecurity journey (I never imagined I’d be able to write something like this, to be honest).


### About Boss of the SOC version 1
- **BOTSv1** is the **first-ever** Boss of the SOC (BOTS) event debuted at Splunk **.conf2016**. This initial challenge introduced participants to an engaging and immersive storyline centered around Wayne Enterprise - one of the largest and most influential companies in the world, famously associated with Batman (In imagination, ofc xD).

- The scenario begins with a security incident: the **defacement** of the Wayne Corporation website. As participants, we step into the role of Alice Bluebird' persona, **a security analyst** tasked with conducting a **root cause analysis**. Our mission is to **investigate** the incident, uncover the series of events that led to the attack, and answer a series of questions designed to guide us through the forensic investigation.

# Enviroment setup
- **Pre-requisites:** Participating in Boss of the SOC (BOTS) is easier than ever, thanks to it's availability on various platforms:
  - [Splunk Officially](https://bots.splunk.com/login?redirect=/)
  - [TryHackMe](https://tryhackme.com/)
  - [CyberDefenders](https://cyberdefenders.org/)
  
*However, all the walkthroughs in this guide are based on **self-hosted setup**, including more or less what's CTF scoreboard look like. If you'd like to follow along or set up your own CTF environment, check out this [detailed post](https://phamthanhsang-cs.github.io/posts/BOTS-setup/) where we’ll walk through everything step-by-step together, thank you.*

- **Dataset Information:** For this walkthrough, I’m using the complete dataset from BOTSv1, which includes approximately 33 million event records. This dataset is notably challenging due to the mix of **legitimate activity**, **noisy data**, and **attack events**. While it adds complexity, it also provides an excellent opportunity to hone our search and analysis skills, making the experience both rewarding and comprehensive.

# Walkthrough 
### Let's Splunking !
Before deep diving into answer BOTS questions, i would like to prepare some SPL searches to make my life easier since me and you are going to "Black box hunting", right ?
- First is `|metadata index="botsv1" type=sourcetypes | stats values(sourcetype)`, the following SPL command helps me quickly identify the sourcetypes present in the dataset. This gives me a clear idea of the types of data we should focus on during investigation:
- The second one is `|metasearch index="botsv1" sourcetype=<specific_sourcetype> <keyword>`, this command helps me pinpoint specific data sources based on your investigation's context and keywords. For example, if the challenge involves a web application security question, and have some sort of keywords like "injection" or "spoofing." While this could involve multiple sourcetypes such as HTTP logs, firewall logs, or IDS/IPS logs, this command helps narrow the scope. It provides a starting point for which sourcetypes are most likely to contain the relevant information.
- The third one is `|fieldsummary` with [marcro](https://docs.splunk.com/Splexicon:Searchmacro) setup. My search will look like this:

```sql
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
```
*And i'd set this search with marcro named `spog` (single pane of glass), you will see why those searches helped me so much in this walkthrough.*


#### Question 1 (101): What is the likely IP address of someone from the Po1s0n1vy group scanning imreallynotbatman.com for web application vulnerabilities?

![pic1](assets/images/botsv1/pic1.png){: w="250" h="50" }{: .right }

Firstly, let's take a look at our sourcetypes by using `|metadata index="botsv1" type=sourcetypes | stats values(sourcetype)` to see if there are any relevant types of data we could start with. Since the question is about an external IP address related to Po1s0n1vy scanning a website, we could start with these sourcetypes:
 - fortigate_*
 - stream:http
 - suricata 
<br>
<br>
<br>
<br>

Let's start with `fortigate_*` sourcetypes, use this SPL search with keyword is "imreallynotbatman.com":
```sql
index="botsv1" sourcetype=fortigate_* imreallynotbatman.com 
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
or do `spog` instead
```
![pic2](/assets/images/botsv1/pic2.png){: w="270" h="100" }{: .right }
Seems like we found something here, dive diving into that by using this SPL search:

```log
index="botsv1" sourcetype=fortigate_* imreallynotbatman.com attack="Acunetix.Web.Vulnerability.Scanner"
|table srcip dstip
|stats count by srcip dstip
```

You could see the IP Address of the external IP was trying to scan the Web Server:
```shell
srcip           dstip             count
40.80.148.42    192.168.250.40    1
40.80.148.42    192.168.250.70    4144
```
> ANSWER: 40.80.148.42
{: .prompt-info }

#### Question 2 (102): What company created the web vulnerability scanner used by Po1s0n1vy? Type the company name. (For example "Microsoft" or "Oracle")
Based on previous question and googling, we already know that the advesary is using [Acunetix](https://www.acunetix.com/) by Invicti - A Web Application and API Security Scanner.
> ANSWER: Acunetix
{: .prompt-info }

#### Question 3 (103): What content management system is imreallynotbatman.com likely using?(Please do not include punctuation such as . , ! ? in your answer. We are looking for alpha characters only.)

First thing, what's CMS ? Content management system is a web application or software that manages digital content, allowing multiple contributors to create, edit and publish from a single dashboard. Content in a CMS is typically stored in a database and displayed in a presentation layer based on a set of templates like a website.

Some of the best and most popular CMS providers that we might see in Internet are:
- Wordpress (this one has a lot of security issues tbh)
- Hubspot
- Joomla
- Magento
...etc

So, which one is using by Wayne Corp ? We already knew that 192.168.250.70 is the internal IP Address of the Web Server, so let's use that clue to investigate. Let's start with this search, we will looking for the most interesting fields that we want to focus on:
```sql
index="botsv1" sourcetype="stream:http" 192.168.250.70
| head 1000
| fieldsummary 
| fields field
```
That's a lot of fields (99 fields) we have to looking to, so i deciced to do some research "How to detect CMS of a Website", and got this answer:
`A website's content management system (CMS) can be identified by examining the URL that links to the website's administration panel. If adding /wp-admin/ to the end of a domain name in the address bar took you to a page with a login and password entry.`

With that information, let's go back to Splunk and focus on three fields that i think are the most relevant: `uri` , `uri_path` and `uri_query`. Let's search using these fields:
```sql
index="botsv1" sourcetype="stream:http" 192.168.250.70 
| head 10000
| table uri uri_path uri_query
| stats count by uri
| sort - count
```
![pic3](/assets/images/botsv1/pic3.png)
_Well, look what we got here, and also notice the one uri that looks really really suspicious_
> ANSWER: joomla
{: .prompt-info }

#### Question 4 (104): What is the name of the file that defaced the imreallynotbatman.com website? Please submit only the name of the file with extension (For example "notepad.exe" or "favicon.ico") 

The first thought I had when encountering this question was: "It has to be an image and is likely represented on the front-end side of an application". According to Trend Micro, "Website defacement is similar to drawing graffiti on a wall, only it happens virtually. A website’s appearance changes, with pictures and/or words scrawled across the defaced site."

We already know that we found a suspicious file named `poisonivy-is-coming-for-you-batman.jpeg` in Question 3 (103). Now, let's analyze what happened.
```sql
index="botsv1" sourcetype=* poisonivy-is-coming-for-you-batman.jpeg
```
Only 10 events, great! We're optimizing our search capabilities from the beginning until now.

I found this log in `suricata`, so we can assume that Wayne Corp's web server was compromised and requested a resource from an unknown external server named `prankglassinebracket.jumpingcrab.com:1337` for an image.

```log
{ [-]
   dest_ip: 23.22.63.114
   dest_port: 1337
   event_type: http
   flow_id: 2457936270
   http: { [-]
     hostname: prankglassinebracket.jumpingcrab.com
     http_method: GET
     length: 0
     protocol: HTTP/1.0
     url: /poisonivy-is-coming-for-you-batman.jpeg
   }
   in_iface: eth1
   proto: TCP
   src_ip: 192.168.250.70
   src_port: 56504
   timestamp: 2016-08-10T16:10:21.601458-0600
   tx_id: 0
}
```
Fortigate Unified Threat Management - `fortigate_utm` also flaged it as `Malicous Websites`.
```log
Aug 10 16:13:46 192.168.250.1 date=2016-08-10 time=16:13:46 devname=gotham-fortigate devid=FGT60D4614044725 logid=0317013312 type=utm subtype=webfilter eventtype=ftgd_allow level=notice vd="root" policyid=10 sessionid=930693 user="" srcip=192.168.250.70 srcport=63139 srcintf="internal3" dstip=23.22.63.114 dstport=1337 proto=6 service=HTTP hostname="prankglassinebracket.jumpingcrab.com:1337" profile="monitor-all" action=passthrough reqtype=direct url="/poisonivy-is-coming-for-you-batman.jpeg" sentbyte=106 rcvdbyte=0 direction=N/A msg="URL belongs to an allowed category in policy" method=domain cat=26 catdesc="Malicious Websites" crscore=30 crlevel=high
```
> ANSWER: poisonivy-is-coming-for-you-batman.jpeg
{: .prompt-info }

#### Question 5 (105): This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?
First, let's ask ourselves "What's dynamic DNS" and "What's FQDN ?"
- Dynamic DNS or DDNS: "Dynamic DNS (DDNS) is a service that keeps the DNS updated with a web property's correct IP address, even if that IP address is constantly being updated." - Cloudflare. *I previously configured DDNS for my company on a Mikrotik router and Fortigate firewall, tracking their IP addresses every minute. This helped maintain their VPN site-to-site connection and minimized disruption. However, the company later switched to using a static IP to simplify the process and eliminate downtime.*  
  
- Fully qualified domain name or FQDN: A fully qualified domain name (FQDN) is a complete domain name that specifies the exact location of a computer or a host on the internet. It consists of a hostname and a domain name. You can see picture below to get the idea what FQDN is.
![pic4](/assets/images/botsv1/pic4.png)
_cre:hostinger_

Based on Question 4 (104) investigation, we will get the right answer for this question.
> ANSWER: prankglassinebracket.jumpingcrab.com
{: .prompt-info }

#### Question 6 (106): What IP address has Po1s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?

Alright, from the first question, we already know that 40.80.148.42 is the external IP address that performed reconnaissance, and 23.22.63.114 is the IP address of the server that transferred the image used to deface the imreallynotbatman.com website, which has already been compromised. We also know that Po1s0n1vy used DDNS to resolve to the malicious IP.

So, what could be the IP address pre-staged to attack Wayne Enterprises?
```text
After detected the vulnerabilities in Jooma CMS, Po1s0n1vy used their infrastructure to exploit that vulnerable Web Server

This could involve techniques such as injection, path traversal, XSS, brute forcing, etc., followed by an HTTP GET request to the server hosting the defaced image.  

The domain or server transferring the suspicious image is likely a pre-staged setup.
```
> ANSWER: 23.22.63.114
{: .prompt-info }

#### Question 7 (107): Based on the data gathered from this attack and common open source intelligence sources for domain names, what is the email address that is most likely associated with Po1s0n1vy APT group?

Based on MITRE ATT&CK, the adversary used T1491.002 - Defacement: External Defacement to compromise Batman's website `(71.39.18.126)`. But how did the attacker achieve this?

We can assume that Po1s0n1vy successfully conducted a web scan on Wayne Corp's public IP address, which was used to NAT imreallynotbatman.com (192.168.250.70) to the internet. They likely exploited a vulnerability in the Joomla CMS and subsequently defaced the website.

![pic5](/assets/images/botsv1/pic5.png)

First, let’s use one of my favorite OSINT tools - VirusTotal. When I searched for the malicious domain `prankglassinebracket.jumpingcrab.com`, we identified the associated IP address: `23.22.63.114` which is pre-staged setup to attack the website. Continuing the investigation with this IP address, I found the following relationships:

```bash
Date resolved           Detections          Resolver         Domain
2019-12-01              0 / 94              VirusTotal       waynecorinc.com
.... 
....
2018-07-18              0 / 94              VirusTotal       www.po1s0n1vy.com
```
The domain `www.po1s0n1vy.com` seemed promising for the investigation, but after exploring [VirusTotal](https://www.virustotal.com/gui/domain/www.po1s0n1vy.com), i still got no chance to find the email of the adversary. So, i moved to the second tool - [AlienVault](https://otx.alienvault.com/indicator/hostname/www.po1s0n1vy.com). Using the same method - put the `23.22.63.114` on it and clicked on the same domain `www.po1s0n1vy.com`. Look what i got here:

| Record          | Value                        |
| --------------- | ---------------------------- |
| Emails          | domainabuse@tucows.com       |
| Name            | Lillian Rose                 |
| Name Servers    | NS1.ABAC.COM                 |
| Org             | Toxicodendron Inc.           |
| Address         | 1 Edge Forrest Lane          |
| City            | Springfield                  |
| Country         | US                           |
| Creation Date   | 2016-07-21T00:00:00          |
| Creation Date   | 2016-07-21T18:07:13          |
| Dnssec          | unsigned                     |
| Domain Name     | PO1S0N1VY.COM                |
| Emails          | lillian.rose@po1s0n1vy.com   |
| Emails          | hostmaster@retsiger.com      |
| Expiration Date | 2017-07-21T00:00:00          |
| Expiration Date | 2017-07-21T18:07:13          |
| Name Servers    | NS2.ABAC.COM                 |
| Referral Url    | http://www.tucowsdomains.com |
| Registrar       | TUCOWS, INC.                 |
| State           | MO                           |
| Status          | ok https://icann.org/epp#ok  |
| Updated Date    | 2016-08-29T00:00:00          |
| Updated Date    | 2016-09-06T23:19:07          |
| Whois Server    | whois.tucows.com             |
| Zipcode         | 65803                        |

> ANSWER: lillian.rose@po1s0n1vy.com
{: .prompt-info }

#### Question 8 (108): What IP address is likely attempting a brute force password attack against imreallynotbatman.com?
Based on the previous questions and the keyword `brute force`, we can assume that the adversary discovered that Joomla or the website lacked Layer 7 protections such as a WAF, input validation, or an account lockout policy. Without an IPS in place and only IDS, they likely attempted a brute-force password attack against the website. To carry out this attack, Po1s0n1vy would have likely sent `GET` and `POST` requests to the server. And which account would typically be the most targeted by default? Yes, it's the `admin` or `administrator` account.

"A brute force attack can manifest in many different ways, but it primarily involves an attacker configuring predetermined values, making requests to a server using those values, and then analyzing the response. To improve efficiency, the attacker may use a dictionary attack (with or without mutations) or a traditional brute-force attack (using predefined character classes such as alphanumeric, special characters, or case sensitivity). Given the method, number of attempts, and efficiency of both the attacking and defending systems, the attacker can estimate how long it will take to submit all chosen predetermined values." — OWASP

Let's dive into the event with the SPL search:
```sql
index="botsv1" sourcetype=stream:http src_ip=23.22.63.114 OR src_ip=40.80.148.42 AND "admin" OR "administrator"
`spog`
```
Well, only 458 events, let's start investigating. 

We found something ! 
```log
src_content
<!DOCTYPE html PUBLIC \
<!DOCTYPE html PUBLIC \
acunetix test
GET  HTTP/1.1\r\nHost: imreallynotbatman.com\r\nConnection: Keep-alive\r\nAccept-Encoding: gzip,deflate\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21\r\nAcunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition)\r\nAcunetix-Scanning-agreement: Third Party Scanning PROHIBITED\r\nAcunetix-User-agreement: http://www.acunetix.com/wvs/disc.htm\r\nAccept: */*\r\n\r\n
username=admin&0960d493674eb04861bd64da9b662118=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=arthur
username=admin&0edae02d7478dfb41641700ef384807a=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=bigdaddy
username=admin&115c3aa6072f4b02b4354909431510f6=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=blazer
username=admin&12c709bcc2e14d5a015f054d18d36537=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=fire
username=admin&2a2ddf97716c1d1e9da21cdaf82b231e=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=777777
username=admin&2c340c4e46444ba249ff7e599e6dfa52=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=flower
username=admin&32c15329bc3f78039869bb3bf17c28a6=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=zzzzzz
username=admin&33fb6e7c85dfd116036c59ddf617d2f1=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=cowboys
username=admin&390008ce70ac91daf869c4965fd49686=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=cameron
username=admin&428a29ccedb710b177316835086f03e6=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=badboy
username=admin&462a0006d3b8398ba84d11967ceecec0=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=baseball
username=admin&4a1c8a2df40c25ed5ff9e1fc04066a7f=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=winter
....
```

Let’s see which IP address is responsible for these "nasty" activities.
```sql
index="botsv1" sourcetype=stream:http "admin" src_content=username*
|table src_ip dest_ip
|stats count by src_ip dest_ip
```
![pic6](/assets/images/botsv1/pic6.png)

> ANSWER: 23.22.63.114
{: .prompt-info }

#### Question 9 (109): What is the name of the executable uploaded by Po1s0n1vy? Please include file extension. (For example, "notepad.exe" or "favicon.ico")

Based on previous SPL searches, we not only know which IP address was used to brute-force the attack on the website, but we also know that imreallynotbatman.com was running Microsoft IIS version 8.5
```log
dest_header
HTTP/1.1 303 See other\r\nContent-Type: text/html; charset=UTF-8\r\nLocation: http://imreallynotbatman.com/joomla/administrator/index.php\r\nServer: Microsoft-IIS/8.5\r\nX-Powered-By: PHP/5.5.38\r\nDate: Wed, 10 Aug 2016 21:46:15 GMT\r\nConnection: close\r\nContent-Length: 182\r\n\r\n
```
What do you think when you get this information? Yup, the executable uploaded by Po1s0n1vy could be any .exe or .ps1 file. Let’s search using the clues we have.
```sql
index="botsv1" sourcetype=fortigate_* *.exe OR *.ps1
`spog`
```

We got those field - value after that we could looking into.
```log
category        Unrated
                W32/Swrort.C!tr
```
```log
file_name       cmd.exe
                3791.exe
                ZAk5LbgaGf.exe
                le_check_v3.exe
                shtml.exe
```
Did some researches, i got this information: 
"W32/Swrort.C!tr is classified as a Trojan.
Trojan has the capabilities to remote access connection handling, perform Denial of Service (DoS) or Distributed DoS (DDoS), capture keyboard inputs, delete file or object, or terminate process.
The Fortinet Anti-Virus Analyst Team is currently in the process of creating a detailed description for this virus." - Fortiguard

So let's start with that IoC first.
```sql
index="botsv1" sourcetype=fortigate_* category="W32/Swrort.C!tr"
``` 
We only got 1 event from the search
```log
Aug 10 15:52:45 192.168.250.1 date=2016-08-10 time=15:52:45 devname=gotham-fortigate devid=FGT60D4614044725 logid=0211008193 type=utm subtype=virus eventtype=infected level=notice vd="root" msg="File is infected." action=monitored service=HTTP sessionid=923537 srcip=40.80.148.42 dstip=192.168.250.70 srcport=49490 dstport=80 dstintf="internal3" policyid=26 proto=6 direction=outgoing filename="3791.exe" quarskip=No-skip virus="W32/Swrort.C!tr" dtype="Virus" ref="http://www.fortinet.com/ve?vn=W32%2FSwrort.C%21tr" virusid=1706341 url="http://imreallynotbatman.com/joomla/administrator/index.php" profile="Honeypot-Access" user="" agent="Mozilla/5.0" analyticscksum="ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d" analyticssubmit=false crscore=50 crlevel=critical
```
We got :
- `srcip=40.80.148.42` which is belong to Po1s0n1vy's infrastructure
- `dstip=192.168.250.70` - imreallynotbatman.com 
- `filename="3791.exe" ` - the malicious excutable file
- `dtype="Virus"`
- `analyticscksum="ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d"` - file checksum, i will do OSINT base on that SHA256.

![pic7](/assets/images/botsv1/pic7.png)
_Damn!_

> ANSWER: 3791.exe
{: .prompt-info }

#### Question 10 (110): What is the MD5 hash of the executable uploaded?
Based on previous analyzed, we also got this MD5 hash. 

![pic8](/assets/images/botsv1/pic8.png)

> ANSWER: aae3f5a29935e6abcc2c2754d12a9af0
{: .prompt-info }

#### Question 11 (111): GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the Po1s0n1vy APT group, if initial compromise fails, is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to Po1s0n1vys initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware.

If you guys don't know what's GCPD ? Well, GCPD stands for [Gotham City Police Department](https://dc.fandom.com/wiki/Gotham_City_Police_Department) which is a municipal police force of Gotham City in DC Comics. 

Alright, let's revisit the scenario and build on my earlier hypothesis, but this time consider a different situation where Po1s0n1vy failed to compromise the web server. In this case, they might attempt a phishing attack using the email address `lillian.rose@po1s0n1vy.com` to target Wayne Corp employees, exploiting the system through "human error" We already know that this email is associated with the IP address `23.22.63.114`.

Updated Hypothesis:
```text
After detected the vulnerabilities in Jooma CMS, Po1s0n1vy used their infrastructure to exploit that vulnerable Web Server.

This could involve techniques such as injection, path traversal, XSS, brute forcing, etc., followed by an HTTP GET request to the server hosting the defaced image.  

If Po1s0n1vy failed to compromise the web server. In this case, they might attempt a phishing attack using the email address `lillian.rose@po1s0n1vy.com` to target Wayne Corp employees, exploiting the system through "human error".
```

This type of situation typically calls for OSINT (Open Source Intelligence) tools to gather information. After exploring resources like VirusTotal, Abuse.ch, AlienVault, and AbuseIPDB, i uncovered some interesting findings using Hybrid Analysis—a free malware analysis service.

![pic10](/assets/images/botsv1/pic10.png)
_But which one ?_

Scrolling down to the File Details section, we find something particularly noteworthy:

The first one file name `MirandaTateScreensaver.scr.exe`
![pic11](/assets/images/botsv1/pic11.png)

The second one file name `ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d` shares the same MD5 and SHA256 hash values as `3791.exe`, which we identified earlier as the malware the adversary uploaded to the imreallynotbatman.com web server. 
![pic12](/assets/images/botsv1/pic12.png)

![pic17](/assets/images/botsv1/pic17.png){: .right}{: w="150" h="100" }

I also found something very interesing while using `spog` marcro with SPL search: 

```log
index="botsv1" sourcetype="fortigate_utm"
```

![pic18](/assets/images/botsv1/pic18.png){: .left}{: w="530" h="600" }
<br>
<br>
<br>
This IoC is the final "key" lead us to the correct answer.

> ANSWER: 9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8
{: .prompt-info }

#### Question 12 (112): What special hex code is associated with the customized malware discussed in question 111? (Hint: It's not in Splunk)

From previous question, we'd gathered IoCs below: 
- Filename: `MirandaTateScreensaver.scr.exe`
- Type: `peexe`, `excutable`
- SHA256: `9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8`
- MD5: `c99131e0169171935c5ac32615ed6261`
- SHA1: `bc927ff06263351f43db8dec88e4b08485e07996`
- Contacted Host: `23.22.63.114:80` (UDP)

![pic13](/assets/images/botsv1/pic13.png)

Dump that SHA256 to VirusTotal and i got this:
![pic14](/assets/images/botsv1/pic14.png)

> ANSWER: 53 74 65 76 65 20 42 72 61 6e 74 27 73 20 42 65 61 72 64 20 69 73 20 61 20 70 6f 77 65 72 66 75 6c 20 74 68 69 6e 67 2e 20 46 69 6e 64 20 74 68 69 73 20 6d 65 73 73 61 67 65 20 61 6e 64 20 61 73 6b 20 68 69 6d 20 74 6f 20 62 75 79 20 79 6f 75 20 61 20 62 65 65 72 21 21 21
{: .prompt-info }

...But, what the heck that means ? 
From [CyberChef](https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')&input=NTMgNzQgNjUgNzYgNjUgMjAgNDIgNzIgNjEgNmUgNzQgMjcgNzMgMjAgNDIgNjUgNjEgNzIgNjQgMjAgNjkgNzMgMjAgNjEgMjAgNzAgNmYgNzcgNjUgNzIgNjYgNzUgNmMgMjAgNzQgNjggNjkgNmUgNjcgMmUgMjAgNDYgNjkgNmUgNjQgMjAgNzQgNjggNjkgNzMgMjAgNmQgNjUgNzMgNzMgNjEgNjcgNjUgMjAgNjEgNmUgNjQgMjAgNjEgNzMgNmIgMjAgNjggNjkgNmQgMjAgNzQgNmYgMjAgNjIgNzUgNzkgMjAgNzkgNmYgNzUgMjAgNjEgMjAgNjIgNjUgNjUgNzIgMjEgMjEgMjE)

![pic15](/assets/images/botsv1/pic15.png)
_:)_

#### Question 13 (113): One of Po1s0n1vy's staged domains has some disjointed "unique" whois information. Concatenate the two codes together and submit as a single answer.
This question might be the toughest so far, in my opinion. It not only teaches us how to find the right OSINT tools for an investigation but also challenges us to use them effectively.

*Honestly, this question made me feel like the worst Alice Bluebird Analyst ever. It’s clear I still have so much to improve, haha.*

The first thought that came to mind was to spin up some Whois lookups to gather information about the domain. I decided to start with AlienVault, as it’s one of my favorite tools. Let’s see if it reveals any clues.

![pic19](/assets/images/botsv1/pic19.png)

In addition to common adversary domains like `*.po1s0n1vy.com` and `prankglassinebracket.jumpingcrab.com`, I noticed something interesting: a lot of mistyped domains resembling Wayne Corp’s legitimate site (possibly waynecorpinc.com).

This observation led to an update in my hypothesis:

The adversary likely set up **fake domains** mimicking Wayne Corp’s official website. These domains could be used to:
- Lure users into visiting the fake site.
- Deliver malware directly to unsuspecting visitors.

<p id="hypothesis">Our hypothesis so far:</p>
> - After detected the vulnerabilities in Jooma CMS, Po1s0n1vy used their infrastructure to exploit that vulnerable Web Server.
- This could involve techniques such as injection, path traversal, XSS, brute forcing, etc., followed by an HTTP GET request to the server hosting the defaced image.  
- If Po1s0n1vy failed to compromise the web server. In this case, they might attempt a phishing attack using the email address `lillian.rose@po1s0n1vy.com` to target Wayne Corp employees, exploiting the system through "human error".
- The adversary also set up **fake domains** mimicking Wayne Corp’s official website. These domains could be used to:
  - Lure users into visiting the fake site for sensitive credential / information harvesting.
  - Deliver malware directly to unsuspecting visitors.
{: .prompt-info }


*Well we now know we are encounter against an APT Group - [Hacktivism](https://en.wikipedia.org/wiki/Hacktivism#:~:text=Hacktivism%20(or%20hactivism%3B%20a%20portmanteau,political%20agenda%20or%20social%20change.)) with sophisticated cyberattacks*<br><br>

Below are MITRE ATT&CK techniques you could use to get more information about that:
- [Acquire Infrastructure: Domains](https://attack.mitre.org/techniques/T1583/001/) - T1583.001 - Resource Development
- [Drive-by Compromise](https://attack.mitre.org/techniques/T1189/) - T1189 - Initial Access

The challenge, however, asked a specific question:

Which staged domains have disjointed and “unique” Whois information?

I tried several tools, including VirusTotal, AlienVault, WhoIsFreak, Abuse.ch, and WhoisDomain Lookup, but couldn’t find a clear lead.. So i use the 2nd hint and got this suggestion:

*""Use a high quality whois site like www.domaintools.com to perform whois lookups against these domains until you see a hex code where you were expecting text. Warning not all whois sites show you all fields!""*

After researching (Well i mean, took me an entire day), i found a way to get more advanced informations about a domain - use whois api tools and get `Json` or `xml` format data. 

One tool stood out: [WhoisJson API](https://whoisjson.com) - a service that provides real-time domain registration data by performing queries on WHOIS servers.

Start with the first staged domains that lists on AlienVault scanned: `waynecorinc.com`. Using Postman, I queried the domain with my WhoisJson API key and, finally...

FOUND IT !!!

![pic20](/assets/images/botsv1/pic20.png)
_'1st2findgetsfreebeerfromryanfindhimtoget'_

> ANSWER: 31 73 74 32 66 69 6e 64 67 65 74 73 66 72 65 65 62 65 65 72 66 72 6f 6d 72 79 61 6e 66 69 6e 64 68 69 6d 74 6f 67 65 74
{: .prompt-info }

#### Question 14 (114): What was the first brute force password used?

Based on Question 8 (108), we just to need add `|reverse` to our SPL search to find which is the first password adversary was used to brute force.
```sql
index="botsv1" sourcetype=stream:http "admin" src_content=username*
|reverse
|table _time src_content
```
![pic9](/assets/images/botsv1/pic9.png)

> ANSWER: 12345678
{: .prompt-info }

#### Question 15 (115): One of the passwords in the brute force attack is James Brodsky's favorite Coldplay song. Hint: we are looking for a six character word on this one. Which is it?
This one’s a bit tricky! Looking back at the previous question, we already have a field value that gives us part of the answer:

```log
username=admin&863349a657c211fbfeb90ebe9427654c=1&task=login&return=aW5kZXgucGhw&option=com_login&passwd=letmein
```
Now, let’s take it a step further with an advanced search using the `rex` command. The goal is to extract only the `username` and `passwd` fields (e.g., username=admin ; passwd=letmein) and then filter the results to list only passwords that are exactly six characters long.

```sql
index="botsv1" sourcetype=stream:http src_content=username*
| reverse
| table src_content
| rex field=src_content "username=(?<username>[^&]+).*?passwd=(?<passwd>[^&]+)"
| where len(passwd) == 6
| stats values(passwd)
```
Meanwhile, let’s do a bit of “OSINT” on Coldplay’s songs using Wikipedia, focusing specifically on their singles.

I’ll create a table with two columns: one for `value(passwd)` and another for `Coldplay’s Songs`.

```log                                    
             value(passwd)                      Coldplay's Songs
000000	birdie	freddy	maggie	secret	        "Brothers&Sisters"
111111	biteme	fucker	marine	sexsex	        "Shiver"
112233	blazer	fuckme	martin	shadow        	"Yellow"
121212	blowme	gators	master	sierra	        "Trouble"
123123	bonnie	gemini	matrix	silver        	"Don'tPanic"
123456	booboo	george	member	skippy        	"InMyPlace"
131313	booger	giants	merlin	slayer        	"TheScientist"
222222	boomer	ginger	mickey	smokey	        "Clocks"
232323	boston	golden	miller	snoopy        	"GodPutaSmileuponYourFace"
555555	brandy	golfer	monica	soccer          "SpeedofSound"
654321	braves	gordon	monkey	sophie        	"FixYou"
666666	buster	guitar	morgan	spanky        	"Talk"
696969	butter	gunner	mother	sparky	        "TheHardestPart"
777777	calvin	hammer	muffin	spider        	"VioletHill"
987654	camaro	hannah	murphy	steven	        "VivalaVida"
aaaaaa	canada	harley	nascar	stupid        	"Lost!"
abc123	carlos	heaven	nathan	suckit        	"LifeinTechnicolorII"
access	casper	helpme	nicole	summer         	"StrawberrySwing"
alexis	cheese	hockey	oliver	sydney        	"ChristmasLights"
amanda	coffee	hotdog	orange	taylor	        "EveryTeardropIsaWaterfall"
andrea	compaq	hunter	parker	tennis	        "Paradise"
andrew	cookie	iceman	peanut	tester        	"CharlieBrown"
angela	cooper	iwantu	pepper	theman        	"PrincessofChina"
angels	cowboy	jackie	player	thomas	        "HurtsLikeHeaven"
animal	dakota	jaguar	please	tigers        	"Atlas"
apollo	dallas	jasper	pookie	tigger        	"Magic"
apples	daniel	jeremy	prince	tomcat	        "ASkyFullofStars"
arthur	debbie	johnny	purple	topgun	        "TrueLove"
asdfgh	dennis	jordan	qazwsx	toyota	        "AdventureofaLifetime"
ashley	diablo	joseph	qwerty	travis	        "HymnfortheWeekend"
august	doctor	joshua	rabbit	tucker	        "Up&Up"
austin	doggie	junior	rachel	turtle	        "AHeadFullofDreams"
badboy	donald	justin	ranger	united	        "Everglow"
bailey	dragon	killer	red123	victor	        "SomethingJustLikeThis"
banana	driver	knight	redsox	viking	        "Orphans"/"Arabesque"
barney	eagles	lakers	robert	voodoo	        "HigherPower"
batman	edward	lauren	rocket	walter	        "MyUniverse"
beaver	falcon	legend	runner	willie	        "LetSomebodyGo"
beavis	fender	london	samson	wilson	        "Feelslikeimfallinginlove"
bigboy	flower	lovers	sandra	winner	        "WePray"
bigdog	flyers	maddog	scooby	winter	        "AllMyLove"
```

As you can see, "Shiver" and "Yellow" are 2 songs that have six characters, look into the value(passwd), we now are able to find the correct one ! 

> ANSWER: yellow
{: .prompt-info }

Anyway, you should give a chance for "Adventure of a Lifetime" which is my fav back then.

"Turn your magic on,<br>
To me she'd say<br>
Everything you want's a dream away<br>
Under this pressure under this weight<br>
We are diamonds"

#### Question 16 (116): What was the correct password for admin access to the content management system running "imreallynotbatman.com"?
Building on our previous questions and SPL searches, we used the following query to extract the usernames and passwords from brute force attempts targeting the Joomla CMS Administrator credentials:
```sql
index=botsv1 sourtype=suricata src_content=username*
| _time table src_content
| rex field=src_content "username=(?<username>[^&]+).*?passwd=(?<passwd>[^&]+)"
| table _time username passwd
```

_The search resulted in 413 event records, providing a list of username-password combinations used during the brute force attack._

The immediate thought came to me is that the **last password** used in the brute force sequence is the one that successfully compromised the CMS. Why?

- Evidence of Compromised:
  - Alerts from Fortigate UTM and Suricata confirm that imreallynotbatman.com has already been compromised.
- Adversary’s Methodology:
 - The attack was conducted via HTTP GET and POST requests, using a combination of usernames and passwords against the Joomla administrator at `/joomla/administrator/index.php`.

But, that’s too simplistic and doesn’t guarantee accuracy. Instead, me and you need to dig deeper and hunt for **Indicators of Compromised** (IoCs) that validate the successful login.

Before diving back into the hunt, I want to share a fantastic resource with you: [PEAK Threat Hunting](https://github.com/splunk/PEAK?tab=readme-ov-file) - PEAK, an acronym for "Prepare, Execute, and Act with Knowledge," brings a fresh perspective to threat hunting. It incorporates three distinct types of hunts: 
1. Hypothesis-Driven
2. Baseline (AKA Exploratory Data Analysis or EDA)
3. Model-Assisted Threat Hunts (M-ATH)

As I mentioned earlier: 
> *"Most importantly, success depends on having a **threat-hunting** mindset, thinking beyond the "Splunk box" to creatively identify and analyze threats."*

Throughout this walkthrough, we’ve been working to create [hypothesis](#hypothesis) to guide our investigation. So, rely on PEAK Threat Hunting model, we decided to use 1st hunt type - Hypothesis-Driven

![pic22](/assets/images/botsv1/pic22.png)
_Hypothesis-driven threat hunting method_

With this hunting method, we working around our above assume - that is the **last password** used in the brute force sequence is the one that successfully compromised the CMS.

First, go back to `stream:http` sourcetype, we are now looking for worthy fields that could give us potential indicators.

```sql
index=botsv1 sourcetype=stream:http imreallynotbatman.com 
```
Look into field `src_header`, this field looks interesting to me.

![pic24](/assets/images/botsv1/pic24.png)

```sql
index=botsv1 sourcetype=stream:http imreallynotbatman.com src_content=username* 
| table _time src_ip dest_ip src_headers src_content
| sort -_time
```

![pic25](/assets/images/botsv1/pid25.png)
_Seems like we found something different here_

> ANSWER: batman
{: .prompt-info }

#### Question 17 (117): What was the average password length used in the password brute forcing attempt? (Round to closest whole integer. For example "5" not "5.23213")
This question challenge you know how to use SPL commands, to solve this question we need to know length of all password brute forcing attempts and then calculate the average password length.

```sql
index="botsv1" sourcetype=stream:http src_content=username*
| reverse
| table src_content
| rex field=src_content "username=(?<username>[^&]+).*?passwd=(?<passwd>[^&]+)" # you already knew what these command is use for based on previous questions
| eval passwd_length = len(passwd) # We create a new field name `passwd_length` that contains the length of password using `len` command
| table passwd passwd_length # list all needed fields
| where passwd_length > 0 # (optional) in case adversaries might start with non-password login 
| stats avg(passwd_length) # Returns the average of the values which is `passwd_length`

Result: 6.174334140435835
```
> ANSWER: 6
{: .prompt-info }

#### Question 18 (118): How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login? Round to 2 decimal places.

From the previous question, we confirmed that after the Joomla Administrator credentials were compromised (through a brute force attack via a **Python script** originating from IP Address `23.22.63.114`), the adversary successfully logged in using the stolen credentials (admin / batman). This activity was observed coming from a different IP address, `40.80.148.42`.

Both IP addresses have been flagged as **malicious** based on our analysis, allowing us to efficiently query the data for further insights by focusing on relevant keywords.

```sql
index=botsv1 sourcetype=stream:http imreallynotbatman.com src_content=username* AND src_content=*batman*
| table _time src_ip dest_ip src_headers src_content
| sort -_time
| delta _time #i'd used 2nd Hint and get this SPL command recommendation for calculate elapsed time

result=-92.169084
```
![pic27](/assets/images/botsv1/pic27.png)

> ANSWER: 92.17
{: .prompt-info }

#### Question 19 (119): How many unique passwords were attempted in the brute force attempt?
For this question, we have to remove the duplicated value in those password brute force attempts. We are going to use [dedup](https://docs.splunk.com/Documentation/SplunkCloud/latest/SearchReference/Dedup) for remove duplicate values of the `passwd` field, leaving only the first occurrence of each unique value.

```sql
index="botsv1" sourcetype=stream:http src_content=username* 
| reverse
| table src_content
| rex field=src_content "username=(?<username>[^&]+).*?passwd=(?<passwd>[^&]+)" 
| dedup passwd
| table passwd
```
![pic23](/assets/images/botsv1/pic23.png)

> ANSWER: 412
{: .prompt-info }

*But, which password has more than 1 time attempt ?* 
```sql
index="botsv1" sourcetype=stream:http src_content=username* 
| reverse
| table src_content
| rex field=src_content "username=(?<username>[^&]+).*?passwd=(?<passwd>[^&]+)" 
| stats count by passwd
| where count > 1
| table passwd
```
*Well, it's `batman` which is the password they cracked successfully to gain Joomla Administrator access*

<!---#### Scenario #1 Debrief
![pic26](/assets/images/botsv1/pic26.png)--->


#### Question 20 (200): What was the most likely IP address of we8105desk on 24AUG2016?
Remember one of the SPL searches I shared earlier? By using "24AUG2016" as the 'keytime' and "we8105desk" as the 'keyword,' we can leverage the powerful `metasearch` command to take a bird’s-eye view of event data and pinpoint where to begin our hunt. Let’s fricking go!

```sql
|metasearch index=botsv1 sourcetype=* we8105desk

// Don't forget to configure the time range properly
```
![pic28](/assets/images/botsv1/pic28.png)
_`metasearch` command helps us with a bird's eye view of event data, quickly identify where should we start hunting_

From this query, we identified:
- ~70,000 events tied to "we8105desk" on 08/24/2016.
- These events span 8 sourcetypes. 

Looking at the sourcetypes, which one catches your attention the most?

For me, the `nessus:scan` sourcetype stands out as the most interesting. Why?
- We all know that both the **[MITRE ATT&CK Framework](https://attack.mitre.org/)** and the **[Lockheed Martin Cyber Kill Chain](https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html)** emphasize the importance of reconnaissance as the starting point of most attack scenarios.
- In prior scenario, we identified the use of **[Acunetix](https://www.acunetix.com/vulnerability-scanner/)** as a scanning tool employed by the adversary to detect vulnerabilities in the **imreallynotbatman.com** webserver.
- Based on this, it’s reasonable to hypothesize that, in this scenario, the attacker or Wayne Corp used **[Nessus](https://www.tenable.com/products/nessus)** as their vulnerability scanning tool for vulnerabilities assessment to Wayne Enterprise employee' machines.
- Only 24 events generated from the sourcetype which is reduce our workloads on investigation.

Let's investigate the sourcetype and see could we find the answer base on our hypothesis.   

```sql
index=botsv1 sourcetype=nessus:scan we8105desk
```
![pic29](/assets/images/botsv1/pic29.png)

> ANSWER: 192.168.250.100
{: .prompt-info }

#### Question 21 (201): Amongst the Suricata signatures that detected the Cerber malware, which one alerted the fewest number of times? Submit ONLY the signature ID value as the answer. (No punctuation, just 7 integers.)
The question gave us "Cerber" as the keyword and Suricata for the sourcetype, with `spog` marcro search, we could identify relevant fields for an investigation easily.

```sql
index=botsv1 sourcetype="suricata" cerber OR Cerber `spog`

//we got 2 fields that's we could looking into:
signature                                 ETPRO TROJAN Ransomware/Cerber Checkin Error ICMP Response
                                          ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup
                                          ETPRO TROJAN Ransomware/Cerber Checkin 2


signature_id                              2816764
                                          2820156     
                                          2816763
```

So, we got 3 signature relate to Cerber ransomware associate with 3 signature ID, let's see which one alerted the fewest number of times.
```sql
index=botsv1 sourcetype="suricata" cerber OR Cerber
|table alert.signature alert.signature_id

//result:
alert.signature                                                alert.signature_id
ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup             2820156
ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup             2820156
ETPRO TROJAN Ransomware/Cerber Checkin Error ICMP Response     2816764    
ETPRO TROJAN Ransomware/Cerber Checkin Error ICMP Response     2816764
ETPRO TROJAN Ransomware/Cerber Checkin 2                       2816763 <---- this alert only triggerd one time
```
> ANSWER: 2816763
{: .prompt-info }

#### Question 22 (202): What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?
Before diving into Splunk to answer next set of questions, let’s take a step back and spend 5 minutes learning about Cerber ransomware. Instead of jumping straight into hunting, I explored [this blog from Fortinet on Cerber Ransomware.](https://www.fortinet.com/blog/threat-research/cerber-ransomware-marks-its-presence-in-the-wild-catches-up-with-cryptowall-and-locky) - We work smarter not harder, right ? 

This blog provides a wealth of IoCs that are extremely useful for our hunt. By incorporating these details, we can approach the problem much more effectively, especially by leveraging the Hypothesis-Driven Threat Hunting method from the PEAK Hunting Framework.

Indicators of Compromise (IoCs):
- Added files:
  - %AppData%{GUID}{ranom}.exe
  - %Desktop%# DECRYPT MY FILES #.html
  - %Desktop%# DECRYPT MY FILES #.txt
  - %Desktop%# DECRYPT MY FILES #.vbs
  - {Affected folder}# DECRYPT MY FILES #.html
  - {Affected folder}# DECRYPT MY FILES #.vbs
  - {Affected folder}# DECRYPT MY FILES #.txt
  - {Affected folder}{random characters}.cerber

- Added registries:
  - HKEY_CURRENT_USERControl PanelDesktop
  - SCRNSAVE.EXE = "%AppData%{GUID}{random}.exe"

  - HKEY_CURRENT_USERSoftwareMicrosoftCommand Processor
  - AutoRun = "%AppData%{GUID}{random}.exe"

  - HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionPoliciesExplorer
  - Run = "%AppData%{GUID}{random}.exe"

  - HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRun
  - {random} = "%AppData%{GUID}{random}.exe"

  - HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRunOnce
  - {random} = "%AppData%{GUID}{random}.exe"

From the previous question, we noticed that Suricata generated two alerts with the signature: `ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup`.
```
{ [-]
   alert: { [-]
     action: allowed
     category: A Network Trojan was detected
     gid: 1
     rev: 1
     severity: 1
     signature: ETPRO TROJAN Ransomware/Cerber Onion Domain Lookup
     signature_id: 2820156
   }
   dest_ip: 192.168.250.20
   dest_port: 53
   event_type: alert
   flow_id: 4097325782
   in_iface: eth1
   proto: UDP
   src_ip: 192.168.250.100
   src_port: 49456
   timestamp: 2016-08-24T11:15:12.668498-0600
}
```
This log suggests that the host `192.168.250.100` queried a Cerber-related domain using the DNS server `192.168.250.20:53` - this is also the one who did nessus scan on we1805desk. Based on this observation, let's investigate further.

```sql
index=botsv1 sourcetype=*  192.168.250.20 cerber* OR Cerber*
```
![pic30](/assets/images/botsv1/pic30.png)

From the results, the `stream:dns` sourcetype is particularly interesting, and also only 4 events which is help us easily get insight to the log.

One of those DNS Query Log:
```json
{
  "endtime": "2016-08-24T17:15:12.816534Z",
  "timestamp": "2016-08-24T17:15:12.816528Z",
  "message_type": [
    "QUERY",
    "QUERY"
  ],
  "query": [
    "cerberhhyed5frqa.xmfir0.win",
    "cerberhhyed5frqa.xmfir0.win"
  ],
  "query_type": [
    "A",
    "A"
  ],
  "transaction_id": 48436,
  "ttl": [
    32768,
    32768
  ],
  "bytes": 112,
  "src_ip": "192.168.250.20",
  "src_mac": "00:0C:29:C3:C4:00",
  "src_port": 54251,
  "bytes_in": 112,
  "dest_ip": "192.228.79.201",
  "dest_mac": "08:5B:0E:93:92:AF",
  "dest_port": 53,
  "bytes_out": 0,
  "time_taken": 6,
  "transport": "udp"
}
```
Well, seems like we found Cerber's presence in Wayne Enterprise network

> ANSWER: cerberhhyed5frqa.xmfir0.win
{: .prompt-info }

#### Question 23 (203): What was the first suspicious domain visited by we8105desk on 24AUG2016?
To be honest, this question really threw me off at first, I had no clue what the right answer was, even though I was able to search for data successfully.

Well, it's kinda easy to look at the question and search for relevant data base on keyword:
```sql
index=botsv1 sourcetype=stream:dns 192.168.250.20

///Do not forget to adjust the time range to 08/24/2016 to capture the relevant events.
```

There were approximately 5,000 DNS events recorded for `we8105desk IP Address` on 08/24/2016 - well, a lot to sift through. To narrow this down, I focused on filtering events with the following query types:
- query.type{} = "A"
- query.type{} = "AAAA"

Why ? This means the Wayne Enterprises employee was visiting a website, and the DNS queries attempted to resolve the domain to either an IPv4 **(A record)** or IPv6 address **(AAAA record)**. By focusing on these query types, we can pinpoint the most relevant DNS activity.

To make it more readable for us, I decided to create a table summarizing all domains the employee visited that day. Here's the query I used:

```sql
index=botsv1 sourcetype=stream:dns 192.168.250.20 query_type{}=A OR query_type{}=AAAA
| reverse
| stats values(query{}) as query
| table query
```
![pic31](/assets/images/botsv1/pic31.png)

At this point, I was stuck. The table provided a list of domains, but they all looked legitimate. I started exploring other sourcetypes such as:
- `suricata`
- `fortigate_utm`
- `fortigate_events`
- `stream:http`

I hoped to find an alert, suspicious behavior, or obfuscated code in HTTP traffic, but nothing seemed to point me in the right direction.

You might think: "You donkey, just 'brute force' those domains to VirusTotal, AbuseIPDB, AlienVault,..." - I did ! But still had no clue lead me to the right one.

So i had to 'brute force' those domains to Boss of the SOC answer section **(WHAT A SHAME!)**

> ANSWER: solidaritedeproximite.org
{: .prompt-info }

While I felt a bit defeated for not solving it in the way it should be, there’s a **silver lining**. During my research those domains after answered the question, i stumbled upon an **incredible resource** that acts as an **"endgame"** for this scenario.

I really want us to understand the full picture of how Cerber Ransomware operates, so please take 10 minutes with me to read this detailed article: [Anatomy of a Ransomware Attack – Cerber Uses Steganography to Hide in Plain Sight.](https://www.netskope.com/blog/anatomy-ransomware-attack-cerber-uses-steganography-hide-plain-sight)

This blog breaks down the TTPs and IoCs for Cerber in great detail, making it an invaluable resource for anyone tackling this scenario.

#### Question 24 (204): During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length in character of the value of this field?

"The attacks use a decoy document loaded with malicious macro code that downloads Cerber malware files to users’ machines. When the decoy document is opened, it drops a VBScript file (.vbs) with a random name in the format **“%APPDATA%\%RANDOM%.vbs.”**" - From [Anatomy of a Ransomware Attack – Cerber Uses Steganography to Hide in Plain Sight.](https://www.netskope.com/blog/anatomy-ransomware-attack-cerber-uses-steganography-hide-plain-sight)

This indicator of compromise (IoC) is crucial to finding the right answer. Our next step is to investigate process creation logs to uncover how the ransomware executes.

For such investigations, you need detailed process tracking data. There are two great sources for this:
[SYSMON](https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon) ! or EventID 4688 from Windows-Security log (but you need to config audit-log in your machine to see it). If you’re unfamiliar with Sysmon, I highly recommend learning and setting it up. It’s an essential tool for deep endpoint monitoring.

If you know how to setup your sysmon on your machine and then config [Splunk UF](https://www.splunk.com/en_us/blog/learn/splunk-universal-forwarder.html) to forward [Sysmon log to Splunk Enterprise](https://www.splunk.com/en_us/blog/tips-and-tricks/monitoring-network-traffic-with-sysmon-and-splunk.html?301=/blog/2014/11/24/monitoring-network-traffic-with-sysmon-and-splunk.html&_gl=1*1vt99go*_gcl_au*MTc5NTU3MzczOS4xNzM1MjM0NzMw*FPAU*MTc5NTU3MzczOS4xNzM1MjM0NzMw*_ga*MTk5NTU4Njg5My4xNzM1MjM0NzMw*_ga_5EPM2P39FV*MTczNjk5NzQ0NS41OS4xLjE3MzY5OTc1MTkuMC4wLjIwNjcxNzA0MzY.*_fplc*TVlJMENxajMybDRTT1pkMmZ3MWpVakVuaXVqYmtCQXNzc1J3azU3eWR4bUtFcFVtTWlLaU4xY2ZaYmlwYXV6SnlxTzlvOGFHYSUyRmI3UEV4Wks4N1dxN3dFY0d5Tm5wQU9mNjJmU2RrM0xJRnpHSlFyUW5WVXIxNzRGVEJHZ2clM0QlM0Q.), you will know which sourcetype that you need to use for investigate ! 

Based on these informations, now let’s dive into the search query:
```sql
index=botsv1 sourcetype="xmlwineventlog" EventID=1 APPDATA we8105desk AND .vbs 
|reverse     <--- Use reverse to trace the ransomware’s initial actions.
```
![pic32](/assets/images/botsv1/pic32.png)
_This output gives us the process creation logs related to the VBScript file_

Damn, we really out of "Splunk" box for this type of questions, since we found the logs that's contain the answer we need to know, let's this SPL search to calculate the length in character of the value.
```sql
index=botsv1 sourcetype="xmlwineventlog" EventID=1 APPDATA we8105desk AND .vbs
|reverse
|table _time CommandLine
|eval command_len = len(CommandLine)
|table _time CommandLine command_len
```
![pic33](/assets/images/botsv1/pic33.png)

> ANSWER: 4490
{: .prompt-info }

#### Question 25 (205): What is the name of the USB key inserted by Bob Smith?
This question isn’t directly about the technical infection processes of Cerber ransomware, but rather about the beginning of the story: **how `we8105desk` got infected.**

It turns out that a Wayne Enterprise employee inserted a random USB device into their workstation, setting the stage for the ransomware attack.

When I approached this question, my thoughts immediately turned to the [Windows Registry](https://learn.microsoft.com/en-us/troubleshoot/windows-server/performance/windows-registry-advanced-users). For those unfamiliar, the Windows Registry functions as a database that stores system-wide and user-specific information, such as:
- Installed applications and their settings.
- User profiles and preferences.
- Hardware configurations and ports in use.

So, my goal was to investigate what actually happens in the Registry when a USB device is inserted into my Laptop.

To better understand this, I dove into some research. These two resources give me the right way-where to start:
- [Tracking USB First insertion in Event logs](https://www.swiftforensics.com/2012/08/tracking-usb-first-insertion-in-event.html)
- [Difference between regedit usb&usbstore](https://learn.microsoft.com/en-us/answers/questions/1160465/difference-between-regedit-usb-usbstore)

![pic34](/assets/images/botsv1/pic34.png)
_This is what registry look like_

Yub, that's `friendly name`, base on that information, we answered the questions: which sourcetype we need to start? what information we need to look into? And how to investigate and find the answer for this question.
```sql
index=botsv1 sourcetype=winregistry "hklm\\*usb*"
```

This search give 511 events at total, i narrowed it down by add `action=created` since this is when we8105desk plugged that deadly USB to the workstation and get 78 events back.
![pic35](/assets/images/botsv1/pic35.png)

The `key_path` and `registry_key_name` are the most attrative fields for me.
```sql
index="botsv1" sourcetype=winregistry "HKLM\\*usb*" action=created
|table _time key_path registry_key_name
```
![pic36](/assets/images/botsv1/pic36.png)

Right after performed SPL search, we got this value that looks familiar to us, ill put these 2 down below so you could compare these:

```log
My Registry
Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USBSTOR\Disk&Ven_TOSHIBA&Prod_TransMemory&Rev_1.00\0022CFF653ECC141273202B6&0

BOTSV1
wpdbusenumroot#umb#2&37c186b&0&storage#volume#_??_usbstor#disk&ven_generic&prod_flash_disk&rev_8.07#7d961196&0#
```
Seems like USB Vendor and Product were hidden, but we got the gold: unique ID - `7d961196&0`, within this unique id definitely has `friendly name` field which is the value that we need to find.

Let's settle this question by our last SPL search:
```sql
index="botsv1" sourcetype=winregistry "HKLM\\*usb*" 7d961196&0 friendlyname
```
![pic37](/assets/images/botsv1/pic37.png)


> ANSWER: MIRANDA_PRI
{: .prompt-info }

#### Question 26 (206): Bob Smith's workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IP address of the file server?
Keep using previous unique ID of that USB device, i investigated with this search: `index=botsv1 sourcetype=* 7d961196&0 `and found a single relevant event in `wineventlog`.

```text
08/24/2016 11:02:36 AM
LogName=System
SourceName=Microsoft-Windows-UserPnp
EventCode=20011
EventType=4
Type=Information
ComputerName=we8105desk.waynecorpinc.local
User=NOT_TRANSLATED
Sid=S-1-5-18
SidType=0
TaskCategory=None
OpCode=Info
RecordNumber=3283
Keywords=None
Message=Device action request for device 'USB\VID_058F&PID_6387\7D961196' was vetoed by 'STORAGE\Volume\_??_USBSTOR#Disk&Ven_Generic&Prod_Flash_Disk&Rev_8.07#7D961196&0#{53f56307-b6bf-11d0-94f2-00a0c91efb8b}' with veto type 6.
```
So, we knew VID and PID of that device which USB mass storage, with that clue, i was able to find another IoC on Bob Smith machine
```sql
index=botsv1 sourcetype=* VID_058F&PID_6387
```
![pic39](/assets/images/botsv1/pic39.png)

```text
LogName=System
SourceName=Microsoft-Windows-Kernel-PnP
EventCode=225
EventType=3
Type=Warning
ComputerName=we8105desk.waynecorpinc.local
User=NOT_TRANSLATED
Sid=S-1-5-18
SidType=0
TaskCategory=None
OpCode=Info
RecordNumber=3282
Keywords=None
Message=The application \Device\HarddiskVolume4\Users\bob.smith.WAYNECORPINC\AppData\Roaming\{35ACA89F-933F-6A5D-2776-A3589FB99832}\osk.exe with process id 3588 stopped the removal or ejection for the device USB\VID_058F&PID_6387\7D961196.
```
"In the next stage of the attack, a random name .exe binary is dropped in %APPDATA% in a hidden folder. In our observation, it was EFSUI.EXE as shown in Figure 6. This is detected by majority of the security vendors as referenced from the VirusTotal page." - [Anatomy of a Ransomware Attack: Cerber Uses Steganography to “Hide in Plain Sight”](https://www.netskope.com/blog/anatomy-ransomware-attack-cerber-uses-steganography-hide-plain-sight)

In this case is `osk.exe` which is a legitimate Microsoft software component - Microsoft's On-Screen Keyboard.

But how did i know this is malicious process ?
- The true osk.exe file is a safe Microsoft Windows system process, called "Accessibility On-Screen Keyboard".
- It's did not from C:\Windows\System32.
![pic38](/assets/images/botsv1/pic38.png)
_`osk.exe` on my machine_

With this Indicator of Compromised, let's see if we could analysis further and find the answer.
```sql
index="botsv1" sourcetype=* osk.exe 192.168.250.100
```
I've seen a bunch of connection to `85.93.x.x:6892` udp, after research, i found another post about Cerber ransomware: 
- [CryptXXX and Cerber Ransomware Get Major Updates](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/cryptxxx-and-cerber-ransomware-get-major-updates) - "First, it is a typical ransomware binary that encrypts the user’s file system and files while displaying a ransom note.  Second, the binary could also be used to carry out a DDoS attack. The observed network traffic looks to be flooding the subnet with UDP packets over port 6892."
  
![pic40](/assets/images/botsv1/pic40.png)

The malware's behavior doesn't stop at encrypting the victim's files, it also launches a DDoS attack against the system. However, this isn't the complete picture we're looking for. To gain more insights, I decided to step back and examine the sourcetype using the `|metadata` command.

Initially, I considered `stream:ip` as it provides information about connections between IP addresses. However, it lacked the port field, which is crucial for identifying file transfer indicators. Therefore, I switched to the `suricata` sourcetype. 

The idea is list all IP addresses and ports interacting with Bob Smith's workstation to identify interesting connections for further investigation.

```sql
index="botsv1" sourcetype="suricata" src_ip=192.168.250.100
| stats values(dest_port) AS "Target Ports" dc(dest_port) AS "Port Count" by src_ip dest_ip
| rename src_ip AS "Bob Smith Workstation" dest_ip AS "Target IP Address"
| sort - "Port Count"
| table "Bob Smith Workstation" "Target IP Address" "Target Ports" "Port Count"
```
![pic42](/assets/images/botsv1/pic42.png)

- Most connections use common ports like 443 (HTTPS), 80 (HTTP), and a significant number on 6892 which i mentioned above.
- Three IP Addresses stand out:
  - 192.168.250.20 (This one is the most noteworthy not because it has most number of distinct port count but also this the one call for cerber domain in Question 22)
  - 192.168.2.50
  - 192.168.250.40

Based on the analysis, `192.168.250.20` becomes the primary focus. It's likely involved in file-sharing activities over SMB (port 445). To confirm, I pivoted to the stream:smb sourcetype for detailed `SMB` traffic analysis
```sql
index=botsv1 sourcetype=stream:smb 192.168.250.20 AND 192.168.250.100
```
![pic41](/assets/images/botsv1/pic41.png)
_hmmm_

Also, [base on Anatomy of a Ransomware Attack: Cerber Uses Steganography to “Hide in Plain Sight”](https://www.netskope.com/blog/anatomy-ransomware-attack-cerber-uses-steganography-hide-plain-sight):

"Finally, it encrypts files with the following 444 extensions that are likely to be associated with high-value business files:

```log
“Encrypt”:{“files”:[[“.contact”, “.dbx”, “.doc”, “.docx”, “.jnt”, “.jpg”, “.mapimail”, “.msg”, “.oab”, “.ods”, “.pdf”, “.pps”, “.ppsm”, “.ppt”, “.pptm”, “.prf”, “.pst”, “.rar”, “.rtf”, “.txt”, “.wab”, “.xls”, “.xlsx”, “.xml”, “.zip”, “.1cd”, “.3ds”, “.3g2”, “.3gp”, “.7z”, “.7zip”, “.accdb”, “.aoi”, “.asf”, “.asp”, “.aspx”, “.asx”, “.avi”, “.bak”, “.cer”, “.cfg”, “.class”, “.config”, “.css”, “.csv”, “.db”, “.dds”, “.dwg”, “.dxf”, “.flf”, “.flv”, “.html”, “.idx”, “.js”, “.key”, “.kwm”, “.laccdb”, “.ldf”, “.lit”, “.m3u”, “.mbx”, “.md”, “.mdf”, “.mid”, “.mlb”, “.mov”, “.mp3”, “.mp4”, “.mpg”, “.obj”, “.odt”, “.pages”, “.php”, “.psd”, “.pwm”, “.rm”, “.safe”, “.sav”, “.save”, “.sql”, “.srt”, “.swf”, “.thm”, “.vob”, “.wav”, “.wma”, “.wmv”, “.xlsb”, “.3dm”, “.aac”, “.ai”, “.arw”, “.c”, “.cdr”, “.cls”, “.cpi”, “.cpp”, “.cs”, “.db3”, “.docm”, “.dot”, “.dotm”, “.dotx”, “.drw”, “.dxb”, “.eps”, “.fla”, “.flac”, “.fxg”, “.java”, “.m”, “.m4v”, “.max”, “.mdb”, “.pcd”, “.pct”, “.pl”, “.potm”, “.potx”, “.ppam”, “.ppsm”, “.ppsx”, “.pptm”, “.ps”, “.pspimage”, “.r3d”, “.rw2”, “.sldm”, “.sldx”, “.svg”, “.tga”, “.wps”, “.xla”, “.xlam”, “.xlm”, “.xlr”, “.xlsm”, “.xlt”, “.xltm”, “.xltx”, “.xlw”, “.act”, “.adp”, “.al”, “.bkp”, “.blend”, “.cdf”, “.cdx”, “.cgm”, “.cr2”, “.crt”, “.dac”, “.dbf”, “.dcr”, “.ddd”, “.design”, “.dtd”, “.fdb”, “.fff”, “.fpx”, “.h”, “.iif”, “.indd”, “.jpeg”, “.mos”, “.nd”, “.nsd”, “.nsf”, “.nsg”, “.nsh”, “.odc”, “.odp”, “.oil”, “.pas”, “.pat”, “.pef”, “.pfx”, “.ptx”, “.qbb”, “.qbm”, “.sas7bdat”, “.say”, “.st4”, “.st6”, “.stc”, “.sxc”, “.sxw”, “.tlg”, “.wad”, “.xlk”, “.aiff”, “.bin”, “.bmp”, “.cmt”, “.dat”, “.dit”, “.edb”, “.flvv”, “.gif”, “.groups”, “.hdd”, “.hpp”, “.log”, “.m2ts”, “.m4p”, “.mkv”, “.mpeg”, “.ndf”, “.nvram”, “.ogg”, “.ost”, “.pab”, “.pdb”, “.pif”, “.png”, “.qed”, “.qcow”, “.qcow2”, “.rvt”, “.st7”, “.stm”, “.vbox”, “.vdi”, “.vhd”, “.vhdx”, “.vmdk”, “.vmsd”, “.vmx”, “.vmxf”, “.3fr”, “.3pr”, “.ab4”, “.accde”, “.accdr”, “.accdt”, “.ach”, “.acr”, “.adb”, “.ads”, “.agdl”, “.ait”, “.apj”, “.asm”, “.awg”, “.back”, “.backup”, “.backupdb”, “.bank”, “.bay”, “.bdb”, “.bgt”, “.bik”, “.bpw”, “.cdr3”, “.cdr4”, “.cdr5”, “.cdr6”, “.cdrw”, “.ce1”, “.ce2”, “.cib”, “.craw”, “.crw”, “.csh”, “.csl”, “.db_journal”, “.dc2”, “.dcs”, “.ddoc”, “.ddrw”, “.der”, “.des”, “.dgc”, “.djvu”, “.dng”, “.drf”, “.dxg”, “.eml”, “.erbsql”, “.erf”, “.exf”, “.ffd”, “.fh”, “.fhd”, “.gray”, “.grey”, “.gry”, “.hbk”, “.ibank”, “.ibd”, “.ibz”, “.iiq”, “.incpas”, “.jpe”, “.kc2”, “.kdbx”, “.kdc”, “.kpdx”, “.lua”, “.mdc”, “.mef”, “.mfw”, “.mmw”, “.mny”, “.moneywell”, “.mrw”, “.myd”, “.ndd”, “.nef”, “.nk2”, “.nop”, “.nrw”, “.ns2”, “.ns3”, “.ns4”, “.nwb”, “.nx2”, “.nxl”, “.nyf”, “.odb”, “.odf”, “.odg”, “.odm”, “.orf”, “.otg”, “.oth”, “.otp”, “.ots”, “.ott”, “.p12”, “.p7b”, “.p7c”, “.pdd”, “.pem”, “.plus_muhd”, “.plc”, “.pot”, “.pptx”, “.psafe3”, “.py”, “.qba”, “.qbr”, “.qbw”, “.qbx”, “.qby”, “.raf”, “.rat”, “.raw”, “.rdb”, “.rwl”, “.rwz”, “.s3db”, “.sd0”, “.sda”, “.sdf”, “.sqlite”, “.sqlite3”, “.sqlitedb”, “.sr2”, “.srf”, “.srw”, “.st5”, “.st8”, “.std”, “.sti”, “.stw”, “.stx”, “.sxd”, “.sxg”, “.sxi”, “.sxm”, “.tex”, “.wallet”, “.wb2”, “.wpd”, “.x11”, “.x3f”, “.xis”, “.ycbcra”, “.yuv”, “.mab”, “.json”, “.ini”, “.sdb”, “.sqlite-shm”, “.sqlite-wal”, “.msf”, “.jar”, “.cdb”, “.srb”, “.abd”, “.qtb”, “.cfn”, “.info”, “.info_”, “.flb”, “.def”, “.atb”, “.tbn”, “.tbb”, “.tlx”, “.pml”, “.pmo”, “.pnx”, “.pnc”, “.pmi”, “.pmm”, “.lck”, “.pm!”, “.pmr”, “.usr”, “.pnd”, “.pmj”, “.pm”, “.lock”, “.srs”, “.pbf”, “.omg”, “.wmf”, “.sh”, “.war”, “.ascx”, “.tif”, “.k2p”, “.apk”, “.asset”, “.bsa”, “.d3dbsp”, “.das”, “.forge”, “.iwi”, “.lbf”, “.litemod”, “.litesql”, “.ltx”, “.m4a”, “.re4”, “.slm”, “.tiff”, “.upk”, “.xxx”, “.money”, “.cash”, “.private”]]
```
Encrypted files will have a .cerber extension." - We can perform a simple SPL search to confirm that information:
```sql
index=botsv1 sourcetype=stream:smb 192.168.250.20 AND 192.168.250.100 .cerber
|table filename
|stats values(filename)
```
![pic43](/assets/images/botsv1/pic43.png)
_wa_

> ANSWER: 192.168.250.20
{: .prompt-info }

#### Question 27 (207): How many distinct PDFs did the ransomeware encrypt on the remote file server?


```sql
index=botsv1 sourcetype="wineventlog"  *.pdf Share_Path="\\??\\C:\\fileshare"
|table Relative_Target_Name
|sort - count
|stats values(Relative_Target_Name) distinct_count

result:
distinct_count(Relative_Target_Name): 257
```
> ANSWER: 257
{: .prompt-info }

#### Question 28 (208): The VBscript found in question 204 launches 121214.tmp. What is the ParentProcessId of this initial launch?
"121214.tmp" as the keyword and "initial launch" is the keytime for this question, we knew how to perform SPL search to find the correct answer.

```sql
index=botsv1 sourcetype="xmlwineventlog" 121214.tmp
|reverse
```
This the first process creation when that 4490 VBscript launches 121214.tmp

```xml
<Event
	xmlns='http://schemas.microsoft.com/win/2004/08/events/event'>
	<System>
		<Provider Name='Microsoft-Windows-Sysmon' Guid='{5770385F-C22A-43E0-BF4C-06F5698FFBD9}'/>
		<EventID>1</EventID>
		<Version>5</Version>
		<Level>4</Level>
		<Task>1</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000000000000000</Keywords>
		<TimeCreated SystemTime='2016-08-24T16:48:21.552726900Z'/>
		<EventRecordID>364394</EventRecordID>
		<Correlation/>
		<Execution ProcessID='1216' ThreadID='1768'/>
		<Channel>Microsoft-Windows-Sysmon/Operational</Channel>
		<Computer>we8105desk.waynecorpinc.local</Computer>
		<Security UserID='S-1-5-18'/>
	</System>
	<EventData>
		<Data Name='UtcTime'>2016-08-24 16:48:21.537</Data>
		<Data Name='ProcessGuid'>{0F2D76F0-CFD5-57BD-0000-0010E3AC3400}</Data>
		<Data Name='ProcessId'>1476</Data>
		<Data Name='Image'>C:\Windows\SysWOW64\cmd.exe</Data>
		<Data Name='CommandLine'>"C:\Windows\System32\cmd.exe" /C START "" "C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\121214.tmp"</Data>
		<Data Name='CurrentDirectory'>D:\</Data>
		<Data Name='User'>WAYNECORPINC\bob.smith</Data>
		<Data Name='LogonGuid'>{0F2D76F0-C612-57BD-0000-002015F80600}</Data>
		<Data Name='LogonId'>0x6f815</Data>
		<Data Name='TerminalSessionId'>1</Data>
		<Data Name='IntegrityLevel'>Medium</Data>
		<Data Name='Hashes'>SHA1=EE8CBF12D87C4D388F09B4F69BED2E91682920B5,MD5=AD7B9C14083B52BC532FBA5948342B98,SHA256=17F746D82695FA9B35493B41859D39D786D32B23A9D2E00F4011DEC7A02402AE,IMPHASH=CEEFB55F764020CC5C5F8F23349AB163</Data>
		<Data Name='ParentProcessGuid'>{0F2D76F0-CEA9-57BD-0000-0010C8133100}</Data>
		<Data Name='ParentProcessId'>3968</Data>
		<Data Name='ParentImage'>C:\Windows\SysWOW64\wscript.exe</Data>
		<Data Name='ParentCommandLine'>"C:\Windows\System32\WScript.exe" "C:\Users\bob.smith.WAYNECORPINC\AppData\Roaming\20429.vbs" </Data>
	</EventData>
</Event>
```

> ANSWER: 3968
{: .prompt-info }

#### Question 29 (209): The Cerber ransomware encrypts files located in Bob Smith's Windows profile. How many .txt files does it encrypt?

If you are familiar with both Windows OS and sysmon, it should be easy to determind the Desktop path, and based on ".txt" as keyword, we will perform a simple SPL search to get the overview of event data.
```sql
index=botsv1 sourcetype="xmlwineventlog" bob.smith "C:\\Users\\bob.smith.WAYNECORPINC\\Desktop\\" .txt 
```
![pic46](/assets/images/botsv1/pic46.png)
We got only 2 Sysmon EventID:
- 1 for Process Creation 
- [2 for A process changed a file creation time](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90002)

Now we know, what's the EventID should we looking into, right ?

```sql
index=botsv1  sourcetype="xmlwinevent" bob.smith "C:\\Users\\bob.smith.WAYNECORPINC\\Desktop\\" .txt EventID!=1
|table file_path
|stats values(file_path)
```

![pic44](/assets/images/botsv1/pic44.png)
_Bob is so done now, lmao_

> ANSWER: 406
{: .prompt-info }

#### Question 30 (210): The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file?
This question ! first seen difficult, but...because we knew TTPs and technical procedures of Cerber ransomware, it just so easy to find the answer without touch your keyboard.

> ANSWER: mhtr.jpg
{: .prompt-info }


#### Question 31 (211): Now that you know the name of the ransomeware's encryptor file, what obfucation technique does it likely use?
This is the end game! Once we know the name of the file `mhtr.jpg`, we can deduce the obfuscation technique from Cerber's documented behavior.

> ANSWER: steganography
{: .prompt-info }

*For those unfamiliar with [steganography](https://en.wikipedia.org/wiki/Steganography#Computer_malware), it's a technique that hides malicious data within another file type—such as text, images, or videos—making it harder to detect. In this case, Cerber likely embedded its ransomware encryptor within the `mhtr.jpg` image file.*

### Conclusion and What's Next 
![pic45](/assets/images/botsv1/pic45.png)
_My honest CTF Dashboard view, there is so much thing that i've to learn_

Wow, what a memorable journey this has been! We’ve explored a variety of adversarial tactics, techniques, and procedures used to compromise the Wayne Enterprise network. Each challenge pushed us to think critically and sharpen our investigative skills.

From mastering SIEM searches to analyzing logs and uncovering root causes, we’ve tackled real-world problems that SOC analysts face every day. These exercises weren’t just about technical skills - they were about fostering a structured, methodical approach to cybersecurity analysis.

#### What's next
Guess what? This is only the beginning. My next blog will dive into **BOTS Version 2**, and let me just say… things are about to get *real*! Expect to tackle more sophisticated APTs and explore a wide range of technologies, including Linux, EDR, Firewalls, Active Directory, Databases, MS365, and so much more.

Thank you for joining me on this journey. Let’s continue growing together as defenders and pushing the boundaries of our skills!
