---
title: Boss of the SOC version 2 Write-ups
date: 2025-1-18 16:00:00 + 0700
categories: [siem, blue-teaming, soc, ctf-challenge]
tags: [splunk, threat-hunting, log-analysis, write-ups]  
author: <author_id>   
description: Become Alice Bluebird - a cybersecurity analyst to help Frothly - A beer company investigate anomalous activities within their operations 
# toc: false - uncomment to turn off Table of Contents which is use for display content in right-panel 
comments: false # uncomment to turn on comment 
image: /assets/images/preview/botsv2.png
---
# Introduction  
Hi Splunkers! Welcome back to my **Boss of the SOC (BOTS)** series on my blog.

If you have'nt read my [BOTSv1 Write-ups](https://phamthanhsang-cs.github.io/posts/BOTSV1/) yet, please take a look to have a understand about [Boss of the SOC - Blue team CTF Challenge made by Splunk](https://www.splunk.com/en_us/blog/security/what-you-need-to-know-about-boss-of-the-soc.html), i appreciate that a lot !

### About Boss of the SOC version 2
In [BOTSv1 Write-ups](https://phamthanhsang-cs.github.io/posts/BOTSV1/), we stepped into the shoes of Alice Bluebird - a quirky cybersecurity analyst to help Wayne Enterprises uncover the root causes of their digital chaos. From website defacements to ransomware attacks on employee machines, we tackled it all!

Now, in Boss of the SOC Version 2, Alice Bluebird returns, this time to assist Frothly - a beer company, in detecting and identifying their security incidents.

This version introduces new challenges, featuring advanced technologies, platforms, and tools. We’ll uncover a sophisticated APT group orchestrating multi-stage attacks, dive into fraud investigations, and even tackle insider threats.

Stay tuned for an exciting journey into the next level of cyber defense!

# Enviroment setup
- **Pre-requisites:** Participating in Boss of the SOC (BOTS) is easier than ever, thanks to it's availability on various platforms:
  - [Splunk Officially](https://bots.splunk.com/login?redirect=/)
  - [TryHackMe](https://tryhackme.com/)
  - [CyberDefenders](https://cyberdefenders.org/)

*However, all the walkthroughs in this guide are based on **self-hosted setup**, including more or less what's CTF scoreboard look like. If you'd like to follow along or set up your own CTF environment, check out this [detailed post](https://phamthanhsang-cs.github.io/posts/BOTS-setup/) where we’ll walk through everything step-by-step together, thank you.*

- **Dataset Information:** For this walkthrough, I’m using the full dataset from BOTSv2, which is five times larger than BOTSv1 - approximately 16.4 GB and around **226 million events**! That’s an incredible amount of data, and we’re in for a thrilling deep dive to explore and analyze these logs together.
  
# Walkthrough 
### Let's Splunking !
Same as BOTsv1. before deep diving into answer BOTS questions, i would like to prepare some SPL searches to help us easier to hunting threats: 
- First is `|metadata index="botsv1" type=sourcetypes | stats values(sourcetype)`, the following SPL command helps me quickly identify the sourcetypes present in the dataset. This gives me a clear idea of the types of data we should focus on during investigation:
- The second one is `|metasearch index="botsv1" sourcetype=<specific_sourcetype> <keyword>`.
- The third one is `|fieldsummary` with [marcro](https://docs.splunk.com/Splexicon:Searchmacro) setup. My search will look like this:

```sql
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
```
*And i'd set this search with marcro named `spog` (single pane of glass), you will see why those searches helped me so much in this walkthrough.*

![pic1](/assets/images/botsv2/pic1.png)
_WELCOME BACK TO MY BOSS OF THE SOC SERIES_

**Boss of the SOC Version 2** is a massive upgrade compared to Version 1, featuring **50 questions**, over **200** million events, and numerous add-on apps. So... let the battle begin!

#### Question 1 (100): Amber Turing was hoping for Frothly to be acquired by a potential competitor which fell through, but visited their website to find contact information for their executive team. What is the website domain that she visited? Answer guidance: Do not provide the FQDN. Answer example: google.com

Before diving into hunting, I recommend starting with a bird's-eye view of the data. Using `|metadata`, we can quickly get an idea of which sourcetype to focus on.

![pic2](/assets/images/botsv2/pic2.png)
_Wow, 102 sourcetypes, insane number!_

Given the sheer number of sourcetypes to analyze, I used `|metasearch` to narrow the scope for hunting by using this SPL search:
```sql
|metasearch index=botsv2 sourcetype=* amber
```
This search returned approximately 700,000 events and provided the following insights:
- host(8)
- source(47)
- sourcetype(14)

List of sourcetypes included:

| sourcetype                | count  |
| ------------------------- | ------ |
| pan:traffic               | 588769 |
| xmlwineventlog            | 21358  |
| WinRegistry               | 18743  |
| symantec:ep:traffic:file  | 11699  |
| wineventlog               | 7522   |
| stream:smb                | 6756   |
| symantec:ep:agent:file    | 1560   |
| WinHostMon                | 477    |
| stream:smtp               | 430    |
| ps                        | 154    |
| stream:dns                | 10     |
| osquery_results           | 4      |
| symantec:ep:scan:file     | 1      |
| symantec:ep:security:file | 1      |

Because this question seems so broad to me, it took my time to think how can i approach with the question. Also, since we have a tons of event data which is made our journey much more challenges, we don't really want to dive into the large pool, right ? 

With such a broad question and a large dataset, it's critical to avoid jumping into the "deep end" without a strategy. My approach began by examining sourcetypes like `symantec:*`, `osquery_results`, `stream:dns`, and `ps`, but none yielded actionable insights.

Until, i found something in `stream:smtp`. For anyone who don't know what's smtp yet, SMTP stands for [Simple Mail Transfer Protocol](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol) which commonly use for send and receive mail messages.

`subject` is the most interested field for me because it gives you an overall idea of mail content. Twerking my SPL searche, and got this results.
```sql
index=botsv2 sourcetype=stream:smtp amber 
| spath subject 
| table subject 
|dedup subject
```
![pic3](/assets/images/botsv2/pic3.png)
_Two subjects seem highly relevant to the question_

To confirm their relevance, I investigated further with this SPL search:

```sql
index=botsv2 sourcetype=stream:smtp amber 
| spath subject 
| search subject="Heinz Bernhard Contact Information" OR subject="RE: Heinz Bernhard Contact Information"
```

```json
{
  "endtime": "2017-08-29T11:08:20.962615Z",
  "timestamp": "2017-08-29T11:08:20.926750Z",
  "ack_packets_in": 1,
  "ack_packets_out": 1,
  "bytes": 11577,
  "bytes_in": 11540,
  "bytes_out": 37,
  "capture_hostname": "matar",
  "client_rtt": 0,
  "client_rtt_packets": 0,
  "client_rtt_sum": 0,
  "content": [

  ],
  "content_body": [

  ],
  "content_transfer_encoding": [
    "quoted-printable",
    "quoted-printable"
  ],
  "content_type": " multipart/alternative;\r\n boundary=\"=_5527708fbc91bd8e7afe104d6c2147f8\"",
  "data_packets_in": 2,
  "data_packets_out": 1,
  "date": "Tue, 29 Aug 2017 04:08:14 -0700",
  "dest_ip": "172.31.38.181",
  "dest_mac": "06:6A:51:FA:0A:B0",
  "dest_port": 25,
  "duplicate_packets_in": 0,
  "duplicate_packets_out": 0,
  "flow_id": "39f7b3b5-aa7c-4e93-9574-d7611ecf489b",
  "mime_type": "multipart/alternative",
  "mime_version": " 1.0",
  "missing_packets_in": 0,
  "missing_packets_out": 0,
  "msg_id": "<5814aa43f21b630e9f3566c1c6d86ce24485b00c@webmail.berkbeer.com>",
  "network_interface": "eth0",
  "packets_in": 3,
  "packets_out": 2,
  "protocol_stack": "ip:tcp:smtp",
  "received_by_name": [
    "SN2PR18CA0006.outlook.office365.com",
    "homiemail-a66.g.dreamhost.com",
    "homiemail-a66.g.dreamhost.com"
  ],
  "received_date": [
    "Tue, 29 Aug 2017 11:08:17 +0000",
    "Tue, 29 Aug 2017 11:08:16 +0000",
    "Tue, 29 Aug 2017 11:08:16 +0000",
    "Tue, 29 Aug 2017 04:08:15 -0700 (PDT)",
    "Tue, 29 Aug 2017 04:08:15 -0700 (PDT)"
  ],
  "received_from_ip": [
    "127.0.0.1",
    "66.33.206.8"
  ],
  "received_from_name": [
    "BN3NAM01FT040.eop-nam01.prod.protection.outlook.com",
    "homiemail-a66.g.dreamhost.com",
    "localhost"
  ],
  "received_server_agent": [
    "2603:10b6:804:1b::16",
    "Postfix",
    "Postfix"
  ],
  "received_with": [
    "Microsoft",
    "ESMTP",
    "ESMTPSA"
  ],
  "receiver": [
    "aturing@froth.ly"
  ],
  "receiver_email": [
    "aturing@froth.ly"
  ],
  "receiver_type": [
    "TO"
  ],
  "reply_time": 3149,
  "request_ack_time": 16,
  "request_time": 32716,
  "response_ack_time": 42836,
  "response_code": 250,
  "response_time": 0,
  "sender": "hbernhard@berkbeer.com",
  "sender_email": "hbernhard@berkbeer.com",
  "server_response": "250 2.0.0 Ok: queued as BA452177593",
  "server_rtt": 15,
  "server_rtt_packets": 2,
  "server_rtt_sum": 31,
  "src_ip": "104.47.37.78",
  "src_mac": "06:E3:CC:18:AA:33",
  "src_port": 40304,
  "subject": "Heinz Bernhard Contact Information",
  "time_taken": 35865,
  "transport": "tcp",
  "xmailer": "Atmail 7.8.0.2"
}
```
`sender:hbernhard@berkbeer.com` seems like the key finding for me. To confirm if this was the website Amber interacted with, i used:
```sql
|metasearch index=botsv2 sourcetype=* berkbeer.com | fieldsummary
```
![pic4](/assets/images/botsv2/pic4.png)
_wala, Amber Turing actually did something with berkbeer.com_

```sql
index=botsv2 sourcetype=* berkbeer.com host=wrk-aturing
```

The last event confirmed that Amber actually visited berkbeer.com at 08/29/2017 03:39:59.983
```text
08/29/2017 03:39:59.983
event_status="(0)The operation completed successfully."
pid=4576
process_image="c:\Program Files (x86)\Internet Explorer\iexplore.exe"
registry_type="SetValue"
key_path="HKU\s-1-5-21-3348076501-352378380-2991248034-1118\software\microsoft\internet explorer\typedurls\url1"
data_type="REG_SZ"
data="http://www.berkbeer.com/"
```

> ANSWER: berkbeer.com
{: .prompt-info }
